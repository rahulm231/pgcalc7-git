(function(window,document,$,undef){var RCO=window.RCO||{},Modernizr=window.Modernizr,FORMALIZE=window.FORMALIZE;Modernizr.addTest("firefox",function(){return !!navigator.userAgent.match(/firefox/i);});$.noConflict();var stepTwoButtonClicked=false;$("#donateStepTwoButton").click(function(){if(stepTwoButtonClicked){return false;}stepTwoButtonClicked=true;});$(".show-date-range").click(function(){var link=$(this);var content=$(this).next();content.addClass("show");content.removeClass("hide");link.remove();return false;});if(!Object.keys){Object.keys=function(o){if(o!==Object(o)){throw new TypeError("Object.keys called on non-object");}var ret=[],p;for(p in o){if(Object.prototype.hasOwnProperty.call(o,p)){ret.push(p);}}return ret;};}window.log=function(){};RCO.util=(function(){var B,context,debug,cardInfo,getKeyCode,calendar,formatMoney,loadMapApi,sleep;B={};B.isIE9=(window.addEventListener&&window.attachEvent);B.isIE9compat8=(B.isIE9&&document.documentMode&&document.documentMode===8);B.isIE9compat7=(B.isIE9&&document.documentMode&&document.documentMode===7);B.isIElt9=(window.addEventListener===undef);B.isIE8=(B.isIElt9&&document.documentMode&&document.documentMode===8);B.isIE8compat=(B.isIElt9&&document.documentMode&&document.documentMode===7);B.isIElt8=(B.isIElt9&&document.documentMode===undef);B.isIE7=(B.isIElt8&&document.body.style.minWidth!==undef);B.isIE6=(B.isIElt8&&document.body.style.minWidth===undef);context=document.body.getAttribute("data-context")||"";formatMoney=function(number){var n=number,c=2,d=".",t=",",s=n<0?"-":"",i=parseInt(n=Math.abs(+n||0).toFixed(c),10)+"",j=(j=i.length)>3?j%3:0;return s+(j?i.substr(0,j)+t:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+t)+(c?d+Math.abs(n-i).toFixed(c).slice(2):"");};getKeyCode=function(evt){var keyCode;if(evt.which!==undef){keyCode=evt.which;}else{if(evt.keyCode!==undef){keyCode=evt.keyCode;}else{if(window.event.keyCode!==undef){keyCode=window.event.keyCode;}else{if(window.event.which!==undef){keyCode=evt.which;}else{}}}}return keyCode;};sleep=function(millisec){var start=new Date().getTime();while((new Date().getTime()-start)<millisec){}};Modernizr.addTest("css",function(){var test=document.createElement("div"),ctrl=test.cloneNode(false),fake=false,testStyle=null,ctrlStyle=null,root=document.body||(function(){fake=true;return document.documentElement.appendChild(document.createElement("body"));}()),oldCssText=root.style.cssText,ret=false;root.style.cssText="padding:0;margin:0";test.style.cssText="color:fuchsia";root.appendChild(test);root.appendChild(ctrl);if(test.currentStyle){testStyle=test.currentStyle.color;ctrlStyle=ctrl.currentStyle.color;}else{if(window.getComputedStyle){testStyle=document.defaultView.getComputedStyle(test,null).getPropertyValue("color");ctrlStyle=document.defaultView.getComputedStyle(ctrl,null).getPropertyValue("color");}}ret=testStyle!==ctrlStyle;root.removeChild(test);root.removeChild(ctrl);root.style.cssText=oldCssText;if(fake){document.documentElement.removeChild(root);}return ret;});Modernizr.addTest("ie8compat",function(){return B.isIE8compat;});calendar={weekdays:[{name:"Sunday",abbr:"Sun"},{name:"Monday",abbr:"Mon"},{name:"Tuesday",abbr:"Tue"},{name:"Wednesday",abbr:"Wed"},{name:"Thursday",abbr:"Thu"},{name:"Friday",abbr:"Fri"},{name:"Saturday",abbr:"Sat"}],months:[{name:"January",days:31},{name:"February",days:28},{name:"March",days:31},{name:"April",days:30},{name:"May",days:31},{name:"June",days:30},{name:"July",days:31},{name:"August",days:31},{name:"September",days:30},{name:"October",days:31},{name:"November",days:30},{name:"December",days:31}]};loadMapApi={isLoading:false,isReady:false,callbacks:[],apiTimer:null,load:function(callback){var loader=RCO.util.loadMapApi;loader.callbacks.push(callback);if(!loader.isLoading&&!loader.isReady){loader.isLoading=true;var script=document.createElement("script");script.type="text/javascript";script.src="http://maps.googleapis.com/maps/api/js?v=3.7&sensor=false&region=US&callback=RCO.util.loadMapApi.apiCallback"+(vClientId==undefined?"":("&client="+vClientId));document.body.appendChild(script);}else{if(loader.isReady){callback();}}},apiCallback:function(){var loader=RCO.util.loadMapApi;for(var i=0;i<loader.callbacks.length;i++){loader.callbacks[i]();}loader.callbacks=[];loader.isLoading=false;loader.isReady=true;}};return{browser:B,root:context,debug:debug,getKeyCode:getKeyCode,calendar:calendar,formatMoney:formatMoney,loadMapApi:loadMapApi,sleep:sleep};}());RCO.cookie={setCookie:function(c_name,value,exdays){var exdate=new Date();exdate.setDate(exdate.getDate()+exdays);var c_value=escape(value)+((exdays==null)?"":"; expires="+exdate.toUTCString())+"; path=/;";document.cookie=c_name+"="+c_value;},eraseCookie:function(c_name){setCookie(c_name,"",-1);},getCookie:function(c_name){var i,x,y,ARRcookies=document.cookie.split(";");for(i=0;i<ARRcookies.length;i++){x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x==c_name){return unescape(y);}}}};RCO.evt={cleanup:function(fn){$(document).bind("cleanup",fn);},preventDefault:function(){$('a[href="#"], form[action="#"] input[type="submit"]').live("click",function(e){e.preventDefault();});},catchTAB:function(evt){var TAB=9,keyCode=RCO.util.getKeyCode(evt);return(keyCode===TAB);}};RCO.url={modalParse:function(url){var splitHref=url.split("?"),qs=(splitHref.length>1)?splitHref[1]:null,params,newUrl=splitHref[0];newUrl+="?modal=true&";if(qs){params=qs.split("&");params=$.grep(params,function(n,i){return(!n.match(/^modal/));});newUrl+=params.join("&");}return newUrl;}};RCO.ui={modal:(function(){var callModal,trapFocus,baseModal,modalInitialized=false,currentModalData;function getCurrentModalData(){return currentModalData;}function colorboxCloseFix(e){if(typeof e!=="undefined"){e.preventDefault();}$.fn.colorbox.close();if(RCO.util.browser.isIE6){$("#colorbox, #cboxOverlay").remove();$.fn.colorbox.init();}}function modalCloseAttach(){var closeLink=$("<a />",{className:"close-modal",href:"#",tabindex:"0"});$("#cboxClose").wrapInner(closeLink);$(".close-modal","#colorbox").click(colorboxCloseFix);}function modalResizeIE7(){var cbox=$("#colorbox"),cboxWrapper=cbox.children("#cboxWrapper"),cboxContent=cboxWrapper.find("#cboxContent"),cboxLoaded=cboxContent.find("#cboxLoadedContent"),cboxArr=[cboxLoaded,cboxContent,cboxWrapper],pageHeight=$(document).height(),cboxPadding=parseInt(cbox.css("paddingTop"),10)+parseInt(cbox.css("paddingBottom"),10),cboxTop=cbox.offset().top,cboxBottom;$(cboxArr).each(function(){$(this).height("auto");$(this).height(function(index,value){return value;});});cbox.height(cboxWrapper.outerHeight()-cboxPadding);cboxBottom=cbox.outerHeight()+cboxTop;if(pageHeight<cboxBottom){cbox.offset(function(index,coords){return{top:coords.top-(cboxBottom-pageHeight),left:coords.left};});}}callModal=function(modalData){modalData.modalOpening=true;currentModalData=modalData;modalData.targetUrl=RCO.url.modalParse(modalData.targetUrl);RCO.ui.modal.clickedElement=modalData.elements;$("#cboxOverlay").unbind("click").bind("click",modalData,modalData.onOverlayClick);$.fn.colorbox({transition:modalData.transition,speed:modalData.speed,href:modalData.targetUrl,width:modalData.width,height:modalData.height,initialWidth:modalData.initialWidth,initialHeight:modalData.initialHeight,scrolling:modalData.scrolling,iframe:modalData.iframe,opacity:modalData.opacity,open:modalData.open,preloading:modalData.preloading,overlayClose:modalData.overlayClose,arrowKey:modalData.arrowKey,closeModal:modalData.closeModal,onOpen:modalData.onOpen,onLoad:modalData.onLoad,onComplete:function(){},onCleanup:modalData.onCleanup,onClosed:modalData.onClosed},function(){modalData.onComplete(modalData);modalData.modalOpening=false;FORMALIZE.go();});return false;};trapFocus=function(){var focusables=$("h1:first, a, input, select, textarea, button","#colorbox");focusables.first().focus().keydown(function(e){var newFocus=focusables.last();if(RCO.evt.catchTAB(e)&&e.shiftKey){e.preventDefault();newFocus.focus();}});focusables.last().keydown(function(e){var newFocus=focusables.first();if(this.id==="cboxClose"){$(this).keyup(function(e){if(e.which==="13"){$(this).click();}});}if(RCO.evt.catchTAB(e)&&!e.shiftKey){e.preventDefault();newFocus.focus();}});};baseModal={elements:"",transition:"elastic",speed:250,targetUrl:"#",width:600,height:false,initialWidth:600,initialHeight:100,scrolling:false,iframe:false,opacity:0.7,open:true,preloading:false,overlayClose:false,arrowKey:false,close:"Close",modalOpening:false,closeModal:function(e){colorboxCloseFix(e);},onOverlayClick:function(e){colorboxCloseFix(e);},onOpen:function(){},onLoad:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},clickEvent:function(e){e.preventDefault();if(!e.data.modalOpening&&Modernizr.css){var that=$(this);if(that.is("input")){e.data.targetUrl=that.closest("form").attr("action");}else{if(that.is("a")){e.data.targetUrl=that.attr("href");}}callModal(e.data);}},keyUpEvent:function(e){$(this).unbind("click");},keyDownEvent:function(e){$(this).bind("click",e.data,e.data.clickEvent);},blurEvent:function(e){$(this).unbind("click").bind("click",e.data,e.data.clickEvent);},callback:function(){}};return{getData:getCurrentModalData,addModal:function(settings){var that=settings.elements,modalData=$.extend({},baseModal,settings);modalData.targetUrl=RCO.url.modalParse(modalData.targetUrl);that.bind("keydown",modalData,modalData.keyDownEvent).bind("keyup",modalData,modalData.keyUpEvent).bind("blur",modalData,modalData.blurEvent).bind("click",modalData,modalData.clickEvent);},init:function(elements,settings){var _elements=elements||$(".open-modal"),_settings=settings||{};_elements.each(function(){var that=$(this),defaultSettings,mergedSettings,url;if(that.is("input")){url=that.closest("form").attr("action");}else{if(that.is("a")){url=that.attr("href");}}defaultSettings={elements:that,width:600,targetUrl:url};mergedSettings=$.extend({},defaultSettings,_settings);RCO.ui.modal.addModal(mergedSettings);});if(!modalInitialized){var $doc=$(document);$doc.bind("cbox_complete",function(){if($("#locator").length>0){$("#cboxClose").css("display","none");}var G="data-ga-",C=G+"category",A=G+"action",D=G+"change",M=G+"module";$("#colorbox ["+D+"]").unbind("change.ga").bind("change.ga",gaChangeValue);$("#colorbox ["+A+"]").unbind("click.ga").bind("click.ga",gaClick);modalCloseAttach();trapFocus();RCO.ui.modal.resize();});$doc.bind("cbox_closed",function(){var clicked=RCO.ui.modal.clickedElement;if(clicked&&clicked.length>0){clicked.focus();clicked=null;}});modalInitialized=true;}},resize:function(){if(RCO.util.browser.isIE7||RCO.util.browser.isIE9compat7||RCO.util.browser.isIE8compat){modalResizeIE7();}else{$.colorbox.resize();}}};}()),printerFriendly:function(elem){var printerFriendlyLink=$(elem);function handlers(){printerFriendlyLink.bind("click",printPage);}function printPage(e){e.preventDefault();window.print();}handlers();},printerFriendlyTranscript:function(elem){var printerFriendlyLink=$(elem);function handlers(){printerFriendlyLink.bind("click",printPage);}function printPage(e){e.preventDefault();window.print();}handlers();},accordion:function(container,options){var accordionWrap,accordions,defaults,headers,triggers,openedAccordion,collapsedClass="collapsed",accordionClass=".accordion",independentClass="independent",onClick,open,close,settings;defaults={start:0};open=function(element){element.removeClass(collapsedClass);openedAccordion=element;};close=function(){openedAccordion.addClass(collapsedClass);};onClick=function(e){var element=$(e.target),hElement,target=element.closest(accordionClass),targetCheck=target.hasClass(collapsedClass),header=element.closest("header");e.preventDefault();if(!header.hasClass(independentClass)){if(targetCheck){if(e.target.nodeName.toLowerCase()==="h1"){hElement=element;}else{hElement=element.closest("h1");}hElement.focus();close();open(target);}}else{if(targetCheck){target.removeClass(collapsedClass);}else{target.addClass(collapsedClass);}}};(function init(){accordionWrap=container;accordions=accordionWrap.find(accordionClass);headers=accordions.find(".accordion-header");triggers=headers.find("a");settings=$.extend(defaults,options);accordions.addClass(collapsedClass);openedAccordion=accordions.eq(settings.start).removeClass(collapsedClass);triggers.bind("click",onClick);}());},expandable:function(wrapper,opts){function createExpandables(element){var target=element,targetHeader=target.find(".accordion-header"),clickArea=targetHeader.find("a"),content=target.find(".accordion-content"),mOpts,_SHOW_="show",_HIDE_="hide",collapsedClass="collapsed";function refreshSettings(){if(mOpts.initial===undef){mOpts.initial=_SHOW_;}}function toggleElement(){target.toggleClass(collapsedClass);return false;}(function init(){mOpts=(opts!==undef)?opts:{initial:_SHOW_};refreshSettings();if(mOpts.initial===_HIDE_){target.addClass(collapsedClass);}if((window.location.href).indexOf("courseDetail")>-1){if(target.html().indexOf("Course Materials")>-1){target.toggleClass(collapsedClass);}}clickArea.bind("click.accordionHandler",toggleElement);}());}(function setup(){var expandableWrap=wrapper||$(".accordion-group"),expandables=expandableWrap.find(".accordion");expandables.each(function(index,value){var that=$(this),element;element=createExpandables(that);});}());},simpleDropDown:function(element){var wrap=element||$(".simple-dropdown"),toggle=element.children(".toggle"),menu=element.children(".menu"),focusTarget=element.find("h1, h2, .menu a").first(),hideClass="hide",activeClass="active",bdy=$("body");function hideMenu(evt){menu.addClass(hideClass);wrap.removeClass(activeClass);bdy.unbind("click.simpleDropdown");}function showMenu(evt){menu.removeClass(hideClass);wrap.addClass(activeClass);focusTarget.focus();bdy.bind("click.simpleDropdown",hideMenu);}function toggleMenu(evt){evt.preventDefault();evt.stopPropagation();if(menu.is(":visible")){hideMenu();}else{showMenu();}}function preserveMenu(evt){evt.stopPropagation();}toggle.click(toggleMenu);menu.click(preserveMenu);},donationTribute:function(_wrap){var wrapper=_wrap;(function tributeTypeToggle(){var cardPreview,cardWidth,hideClass="hide",activeClass="active",cardTypeWrap=wrapper.find(".card-type-wrap"),cardTypeField=cardTypeWrap.find(".sub-field-wrap"),typeToggle=cardTypeField.find('input[name="tributeType"]'),isModal=(wrapper.closest("#colorbox").length>0)?true:false,validatorObj=RCO.ui.validate.current;function switchFieldset(_target){var target=_target||wrapper.find('input[name="tributeType"]').filter(":checked"),targetWrap=target.closest(".sub-field-wrap"),mapping=target.attr("id");cardTypeField.removeClass(activeClass);targetWrap.addClass(activeClass);function resetForm(){var validator=validatorObj.validator;validator.resetForm();$(validator.currentForm).find(".invalid-field-wrap").removeClass("invalid-field-wrap");}if(validatorObj){resetForm();}wrapper.find(".tribute-type-fieldset").addClass(hideClass).filter("."+mapping+"-fieldset").removeClass(hideClass);if(!!isModal){RCO.ui.modal.resize();}}typeToggle.bind("click",function(){switchFieldset($(this));});switchFieldset();}());(function cardImageSelect(){var cardThumbList=wrapper.find(".card-thumbs-list"),tributeType=$("#tribute-type"),selectedClass="selected";function swapTributeName(){if(tributeType.prop("value")=="In Honor Of"){$("#ecardTypeDiv-InMemory").hide();$("#pcardTypeDiv-InMemory").hide();$("#ecardTypeDiv-InHonor").show();$("#pcardTypeDiv-InHonor").show();}if(tributeType.prop("value")=="In Memory Of"){$("#ecardTypeDiv-InHonor").hide();$("#pcardTypeDiv-InHonor").hide();$("#ecardTypeDiv-InMemory").show();$("#pcardTypeDiv-InMemory").show();}}swapTributeName();cardThumbList.each(function(){var cardThumb=$(this).children(".card-thumb"),cardToggle=cardThumb.children("a"),cardInput=cardThumb.children(".card-thumb-image");function toggleCard(_element){var elementWrap=_element||cardInput.filter(":checked").closest(".card-thumb"),inputElement=elementWrap.children(".card-thumb-image");cardThumb.removeClass(selectedClass);elementWrap.addClass(selectedClass);inputElement.prop("checked",true);}(function init(){toggleCard();cardToggle.bind("click",function(){toggleCard($(this).closest(".card-thumb"));return false;});}());});}());},addDonation:function(){var selectDonation=$(".select-donation-cause"),hideClass="hide";function donationCauseSelect(){var wrap=selectDonation,causeToggleWrap=wrap.find(".cause-toggle-wrap"),causeToggle=causeToggleWrap.children("input"),causeToggleLabel=causeToggleWrap.children("label"),donationCause=wrap.find(".cause-section"),subtotal=wrap.find(".subtotal").children(".amount"),donationAmount=wrap.find(".donation-amount"),donationAmountItem=donationAmount.find('input[name="donationAmount"]'),customWrap=donationAmount.find(".custom-amount-wrap"),customRadio=customWrap.find("#amount-custom"),customField=customWrap.find("#custom-amount"),recurringNote=wrap.find(".recurring-note"),recurringToggle=wrap.find("#toggle-recurring"),selectedClass="selected",customToggleClass="custom-only-toggle",customClass="custom-only",customOnly=false,initToggle=causeToggle.filter(":checked");function checkRecurring(element){var target=element||recurringToggle,recurring=target.prop("checked");if(!!recurring){recurringNote.removeClass(hideClass);}else{recurringNote.addClass(hideClass);}}function toggleCause(element){var toggle=element,key=toggle.attr("title"),toggleWrap=toggle.closest(".cause-toggle-wrap");customOnly=toggle.hasClass(customToggleClass);causeToggleWrap.removeClass(selectedClass);toggleWrap.addClass(selectedClass);donationCause.addClass(hideClass).filter("#"+key).removeClass(hideClass);if(!!customOnly){donationAmount.addClass(customClass);}else{donationAmount.removeClass(customClass);}updateSubtotal();}function updateSubtotal(){var field,value,amount;if(!!customOnly){field=customField;}else{field=donationAmountItem.filter(":checked");if(field.val()==="custom"){field=customField;}}value=parseFloat(field.val());amount=RCO.util.formatMoney(value);subtotal.text(amount);}causeToggleLabel.click(function(){var thisInput=$(this).siblings("input");thisInput.prop("checked","checked");toggleCause(thisInput);});donationAmountItem.click(updateSubtotal);customField.click(function(){customRadio.prop("checked","checked");updateSubtotal();});customField.blur(updateSubtotal);recurringToggle.click(function(){checkRecurring($(this));});toggleCause(initToggle);checkRecurring();}function init(){var toggle=$("#add-donation"),toggleSelection;toggleSelection=function(){var adding=toggle.prop("checked");if(!!adding){selectDonation.removeClass(hideClass);}else{selectDonation.addClass(hideClass);}};toggle.click(toggleSelection);toggleSelection();donationCauseSelect();}init();},tabs:(function(){var instance={};var delayHideUntilHandlers=[];function init(elements,settings){var _elements=elements||$(".tabs"),_settings=settings||{},defaultSettings,mergedSettings,check,i;defaultSettings={tabhead:_elements.children("h2"),fx:"show",fxspeed:0,wrapperClass:"tabs-content",autoAnchor:true};mergedSettings=$.extend({},defaultSettings,_settings);RCO.ui.tabs.instance=_elements.accessibleTabs(mergedSettings);_elements.removeClass("invisible");for(i=0;i<delayHideUntilHandlers.length;i++){check=delayHideUntilHandlers[i];if(_elements.find(check.selector).length>0&&!check.handler()){check.el=_elements.find(check.selector).parents(".tabbody");check.el.css("display","block");watchForTabHideReady.call(check);}}}function delayHideUntil(selector,waitUntilTrue){if(typeof(waitUntilTrue)==="function"){delayHideUntilHandlers.push({selector:selector,handler:waitUntilTrue});}}function watchForTabHideReady(){var check=this;if(!check.handler()){setTimeout($.proxy(watchForTabHideReady,check),200);return;}else{check.el.css("display","none");}}return{instance:instance,init:init,delayHideUntil:delayHideUntil};})(),form:{signUpForm:function(_form){var $form=_form,errorClass="invalid-message",invalidWrapClass="invalid-field-wrap";RCO.ui.validate.init($form,{showErrors:function(errorMap,errorList){var that=this,errors=errorList,errorsLength=errors.length,successes=that.successList,successesLength=successes.length;for(var i=0;i<errorsLength;i+=1){var curError=errors[i],errorElement=$form.find(curError.element),elemWrap=errorElement.closest(".field-wrap"),errorElem=elemWrap.children("."+errorClass);if(errorElem.length>0){errorElem.text(curError.message);}else{errorElem=$('<span class="'+errorClass+'"/>');errorElem.text(curError.message).appendTo(elemWrap);}elemWrap.addClass(invalidWrapClass);}for(i=0;i<successesLength;i+=1){var curSuccess=successes[i],successElement=$form.find(curSuccess),successFieldWrap=successElement.closest(".field-wrap");successFieldWrap.removeClass(invalidWrapClass);}},submitHandler:function(validForm){validForm.submit();return false;}});},matchCard:function(element){var trigger=element||$("#card-number"),cardImageWrap=trigger.closest(".field-wrap").find(".credit-cards"),cardImage=cardImageWrap.children("div"),activeClass="active",prefixesLength=0,valueLength=0,currentValLength=0,getCardInfo,cards,currentValue,checkValue,deactivateAll,activateAll,checkEachCardType,checkEachCardPrefix,target;getCardInfo=function(){var dfdCardInfo=$.Deferred(),jsonUrl=trigger.data("jsonurl");$.getJSON(jsonUrl,function(data,textStatus){cards=data;dfdCardInfo.resolve();});return dfdCardInfo.promise();};deactivateAll=function(){cardImage.children("span").removeClass(activeClass);};activateAll=function(){cardImage.children("span").addClass(activeClass);};checkEachCardPrefix=function(prx){var prefix=prx.val,prefixLength=prefix.length,target=prx.target,index=prx.index,tester=currentValue;if(valueLength>prefixLength){tester=currentValue.substring(0,prefixLength);}else{if(valueLength<prefixLength){prefix=prefix.substring(0,valueLength);}}if(tester===prefix){target.addClass(activeClass);return true;}else{if(index+1===prefixesLength&&target.hasClass(activeClass)){target.removeClass(activeClass);return false;}}};checkEachCardType=function(currentValue,val){var thisCard=val,currentVal=currentValue,cardClass=thisCard.cardClass.toLowerCase(),prefixes=thisCard.prefix,match,i,j;for(j=0,currentValLength=currentVal.length;j<currentValLength;j+=1){currentVal=currentVal.replace(" ","");}target=cardImageWrap.children("."+cardClass).children("span");for(i=0,prefixesLength=prefixes.length;i<prefixesLength;i+=1){match=checkEachCardPrefix({target:target,index:i,val:prefixes[i]});if(match){if(currentVal.length>thisCard.length){deactivateAll();}break;}}};checkValue=function(e){var val;currentValue=trigger.val();valueLength=currentValue.length;if(valueLength<1||!(currentValue.match(/\d*\s*/g))){deactivateAll();return;}for(val in cards){if(cards.hasOwnProperty(val)){checkEachCardType(currentValue,cards[val]);}}};(function(t){$.when(getCardInfo()).done(function(){t.bind("keyup",checkValue);t.bind("blur",checkValue);checkValue();});}(trigger));},paymentCreditCard:function(){var loggedIn=$(".logged-in");if(loggedIn.length>0){var cardWrap=$(".credit-card-wrap"),cardForm=cardWrap.find(".card-form"),editForm=cardWrap.find(".edit-form"),cardInfoList=cardWrap.find(".card-info-list"),cardInfo=cardInfoList.find(".card-info"),currentCardInfo,differentToggle=cardWrap.children(".different-card-link").children("a"),cardSelector=cardWrap.children(".card-selection"),setCardSelector,newCardToggle=cardSelector.find(".new-link a"),savedToggles=cardSelector.find(".use-link"),savedEditToggles=cardSelector.find(".edit-link"),editToggle=cardInfo.find(".edit-link"),hideClass="hide",formDisplay="true",toggleCardSelector,toggleNewCard,toggleSavedCard,toggleEditCard;cardInfo.each(function(index){var that=$(this);if(index==0){currentCardInfo=that;}if(!that.hasClass(hideClass)){currentCardInfo=that;formDisplay="false";return false;}});toggleCardSelector=(function(){function showSelector(evt){if(!currentCardInfo){return;}var editLink=currentCardInfo.find(".edit-link");differentToggle.add(cardForm).add(editForm).addClass(hideClass);editLink.removeClass(hideClass);cardSelector.removeClass(hideClass).find("span[tabindex]").focus();currentCardInfo.removeClass(hideClass);cardInfoList.removeClass(hideClass);formDisplay="false";return false;}differentToggle.click(showSelector);})();$.urlParam=function(name){var results=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(window.location.href);if(results==null){return false;}return results[1];};$.removeVariableFromURL=function(url_string,variable_name){var URL=String(url_string);var regex=new RegExp("\\?"+variable_name+"=[^&]*&?","gi");URL=URL.replace(regex,"?");regex=new RegExp("\\&"+variable_name+"=[^&]*&?","gi");URL=URL.replace(regex,"&");URL=URL.replace(/(\?|&)$/,"");regex=null;return URL;};toggleNewCard=(function(){function showForm(){if($.urlParam("edit")){var variable_name="edit";var stripped_url=$.removeVariableFromURL(top.location.href,variable_name);top.location.href=stripped_url;}else{cardForm.removeClass(hideClass);cardInfoList.addClass(hideClass);}return false;}newCardToggle.click(showForm);})();toggleSavedCard=function(element){var target=element,key,thisCardInfo,editLink;key=target.attr("value");thisCardInfo=cardInfo.filter("#"+key);editLink=thisCardInfo.find("edit-link");if(!currentCardInfo||formDisplay=="true"){return;}if(thisCardInfo!==currentCardInfo){currentCardInfo.addClass(hideClass);thisCardInfo.removeClass(hideClass);currentCardInfo=thisCardInfo;editLink.removeClass(hideClass);}cardInfoList.removeClass(hideClass);cardForm.addClass(hideClass);};savedToggles.click(function(){toggleSavedCard($(this));});setCardSelector=(function(){var currentInput=savedToggles.filter(":checked")||savedToggles.eq(0).attr("checked","checked");toggleSavedCard(currentInput);})();toggleEditCard={loadAjax:function(setting){var ajaxDefault={dataType:"html",type:"GET",data:{notForm:"true",noFormAction:"true",edit:"true",nickname:"off"}};$.ajax($.extend(ajaxDefault,setting));},showForm:function(data,textStatus,jqXHR){editForm.find(".payment-form").remove();editForm.append(data);differentToggle.add(editForm).removeClass(hideClass);var multisubmitPreventModule=RCO.exec.donate.paymentMultiSubmitHandler;$(editForm.find("#newCreditCardSubmit")).bind("click",multisubmitPreventModule.preventMultiSubmission);if(editForm.find("form").hasClass("cc-payment-form")){RCO.exec.donate.donateFormValidator.registerFormValidations(editForm.find("form").get(0));}if(editForm.find("input.attach-url-params").length>0){RCO.exec.donate.urlParamsUtil.init(editForm.find("form"));}RCO.exec.countryStateDropDown.init($(".payment-form"));},setupAjax:function(element){if(!currentCardInfo){return;}var target=element,ajaxUrl,setting,editLink;editLink=currentCardInfo.find(".edit-link");editLink.add(cardSelector).addClass(hideClass);ajaxUrl=target.attr("href");setting={url:ajaxUrl,cache:false,success:toggleEditCard.showForm};toggleEditCard.loadAjax(setting);return false;},init:function(){editToggle.click(function(){toggleEditCard.setupAjax($(this));return false;});}};toggleEditCard.init();savedEditToggles.click(function(){toggleSavedCard($(this));toggleEditCard.setupAjax($(this));return false;});}},paymentMethods:function(){var paymentOptions=$(".payment-options"),methodsList=paymentOptions.find(".methods-list"),methodsInputs=methodsList.find("input"),formsWrap=$("#payment-area"),forms=formsWrap.find(".payment-form-wrap"),hideClass="hide";if(forms.filter(".credit-card-wrap").length===1){RCO.ui.form.paymentCreditCard();RCO.ui.form.matchCard();}if(forms.length===1){forms.removeClass(hideClass);return false;}else{if(forms.length>1){paymentOptions.children(".methods-header").add(methodsList).removeClass(hideClass);}}function switchForm(){var target=methodsInputs.filter(":checked"),mapping;if(target.length!==1){target=methodsInputs.eq(0);target.prop("checked","checked");}mapping=target.attr("value");forms.addClass(hideClass);forms.filter("."+mapping+"-wrap").removeClass(hideClass);RCO.exec.donate.donateFormValidator.toggleCCValidations();}methodsInputs.click(switchForm);switchForm();},toggleActions:function(nextToggle){$("form").each(function(){var that=$(this),elements=that.find("input, select, textarea").not(":button, :submit, :reset, :hidden"),password=elements.find(":password"),actions=that.find(".form-action"),cancel=actions.find(".cancel"),hideClass="hide",show=function(e){actions.removeClass(hideClass);elements.unbind(showEvt);cancel.bind("click",hide);},showEvt={focus:show,click:show};function cacheVal(i,el){var $el=$(el);if($el.attr("type")!=undefined&&$el.attr("type")=="checkbox"){$el.data("cached-value",$el.prop("checked"));}else{$el.data("cached-value",$el.val());}}function resetVal(i,el){var $el=$(el);if($el.attr("type")!=undefined&&$el.attr("type")=="checkbox"){$el.prop("checked",$el.data("cached-value"));}else{$el.val($el.data("cached-value"));}}function checkForOldSystem(){if($("#old-user").is(":checked")){$(".old-system").show();}else{$(".old-system").hide();}}function hide(e){e.preventDefault();actions.addClass(hideClass);if(nextToggle&&password.length>0){nextToggle.hide();}elements.bind(showEvt).each(resetVal);cancel.unbind("click",hide);checkForOldSystem();}elements.bind(showEvt).each(cacheVal);});},togglePassword:function(element){var tempVal,form,thisField,nextField,nextElement,allElement,hideClass,show,hide;if(element.length<1&&!element.is("input, select, textarea")){return;}tempVal=element.val();form=element.closest("form");thisField=element.closest(".field-wrap");nextField=thisField.next(".field-wrap");nextElement=nextField.find("input, select, textarea");allElement=form.find("input, select, textarea").not(element).not(nextElement).not(".button");hideClass="hide";show=function(e){if(element.val()===tempVal&&nextField.hasClass(hideClass)){element.add(nextElement).val("");nextField.removeClass(hideClass);element.unbind("focus",show);allElement.bind("focus",hide);}};hide=function(e){if(!nextField.hasClass(hideClass)){nextField.addClass(hideClass);element.add(nextElement).val(tempVal);allElement.unbind("focus",hide);element.bind("focus",show);}};element.bind("focus",show);return{show:show,hide:hide};},toggleCheckboxes:function(masterCheckbox,childCheckboxes){var isEnabled,enableCheckboxes,disableCheckboxes;if(masterCheckbox.length<1&&childCheckboxes.length<1&&!masterCheckbox.is(":checkbox")&&!childCheckboxes.is(":checkbox")){return;}isEnabled=masterCheckbox.prop("checked");enableCheckboxes=function(){masterCheckbox.prop("checked",true);childCheckboxes.prop("checked",true).prop("disabled",false);isEnabled=true;};disableCheckboxes=function(){childCheckboxes.prop("disabled",true).prop("checked",false);masterCheckbox.prop("checked",false);isEnabled=false;};if(!isEnabled){disableCheckboxes();}masterCheckbox.click(function(){if(isEnabled){disableCheckboxes();}else{enableCheckboxes();}return true;});},toggleSibling:function(element,newValue){var toggle=element,hideClass="hide",editFieldset=toggle.siblings("."+hideClass),editCancel=editFieldset.find(".cancel"),editField,originalValue,fieldWrap=editFieldset.hasClass("field-wrap"),showFieldset,hideFieldset;if(fieldWrap){editField=editFieldset.find("input");originalValue=toggle.text();}showFieldset=function(e){e.preventDefault();toggle.addClass(hideClass);editFieldset.removeClass(hideClass);if(fieldWrap){if(newValue){editField.val("");editField.focus();}else{editField.val(originalValue);editField.select();}}editCancel.one("click",hideFieldset);};hideFieldset=function(e){e.preventDefault();editFieldset.addClass(hideClass);toggle.removeClass(hideClass);toggle.one("click",showFieldset);};toggle.one("click",showFieldset);},datePicker:function(_wrap,showAllDates){var wrap=_wrap||$(".date-pickers-wrap"),triggers=wrap.find(".field"),today=new Date(),displayedClass="dp-displayed",viewport=$(window),options={createButton:false,clickInput:false,showYearNavigation:false,verticalOffset:22,verticalPosition:$.dpConst.POS_TOP},initialized=false,skip=false,isHistorical=showAllDates;function positionDatePicker(_element){var trigger=_element,viewportVertical=viewport.scrollTop()+viewport.height(),alignment,triggerHeight,datepickerVertical;trigger.dpDisplay();triggerHeight=trigger.height();datepickerVertical=$("#dp-popup").height()+trigger.offset().top+triggerHeight;if(viewportVertical>datepickerVertical){trigger.dpSetOffset(triggerHeight,0);trigger.dpSetPosition($.dpConst.POS_TOP);alignment="top";}else{trigger.dpSetOffset(-(triggerHeight+12),0);trigger.dpSetPosition($.dpConst.POS_BOTTOM);alignment="bottom";}return alignment;}triggers.each(function(){var opened=false,trigger=$(this),field=trigger.find("input"),fieldValue=field.val(),dateRx=/^(0[1-9]|1[012])[\- \/.]([1-9]|[12]\d|3[01])[\- \/.](19\d\d|20\d\d)$/,dateMatch=dateRx.exec(field.val()),alignment="top";field.attr("readonly","readonly");if(dateMatch){options.month=dateMatch[1]-1;options.year=dateMatch[3]-0;}trigger.datePicker(options).bind("mousedown",function(){if(opened===true){return false;}}).bind("click",function(){if(!opened){$(".quick-range-list li").removeClass("selected");var selectedDate=trigger.dpGetSelected();alignment=positionDatePicker(trigger);if(selectedDate.length>0){trigger.dpSetDisplayedMonth(selectedDate[0].getMonth(),selectedDate[0].getFullYear());}trigger.dpDisplay();$("#dp-popup").show();opened=true;}return false;}).bind("dateSelected",function(event,date,$td,status){var selectedDate=date.asString();field.val(selectedDate);if(initialized===true){var toField,toDate,fromField,fromDate;if(trigger.hasClass("from-date-field")){toField=trigger.closest("fieldset").find(".to-date-field");toDate=(toField.dpGetSelected())[0];fromDate=date;if(toDate&&fromDate.getTime()>toDate.getTime()){skip=true;var tmpDate=new Date();tmpDate.setTime(fromDate.valueOf());toField.dpSetSelected(tmpDate.addDays(30).asString("mm/dd/yy"));}}else{if(trigger.hasClass("to-date-field")){fromField=trigger.closest("fieldset").find(".from-date-field");fromDate=(fromField.dpGetSelected())[0];toDate=date;if(fromDate&&fromDate.getTime()>toDate.getTime()){var newFromDate=toDate.addDays(-30);if(newFromDate.getTime()<today.getTime()){newFromDate=today;}skip=true;fromField.dpSetSelected(newFromDate.asString("mm/dd/yy"));}}}if(skip===false){if($td!=undef){field.trigger("dateChanged");if($("#to-date").length>0&&$("#from-date").length>0){if($("#to-date").val().length>0&&$("#from-date").val().length>0){$("#catalogList-filter").submit();}}}}trigger.dpClose();skip=false;}}).bind("dpMonthChanged",function(){if(alignment==="bottom"){trigger.dpSetOffset(-(trigger.height()+12),0);trigger.dpSetPosition($.dpConst.POS_BOTTOM);trigger.dpDisplay();$("#dp-popup").show();}}).bind("dpDisplayed",function(){field.focus();trigger.addClass(displayedClass);}).bind("dpClosed",function(){opened=false;field.blur();trigger.removeClass(displayedClass);});if(isHistorical){trigger.dpSetStartDate("01/01/00");}if(fieldValue!==undef){trigger.dpSetSelected(fieldValue);}});initialized=true;}},ajax:{listManager:function(listOpts){var formSelector=(listOpts.form!==undef)?listOpts.form:$($("form.list-filter-tool")[0]),eventNamespace=listOpts.namespace,eventString="click."+eventNamespace,submitString="submit."+eventNamespace,nextPage=$(".next-link"),prevPage=$(".prev-link"),pagesSelector=$(".pagination"),pageCount=$(".show-count"),templateSelector=listOpts.template,targetSelector=(listOpts.target!==undef)?listOpts.target:$(".pagination-section"),dataSelectors=listOpts.data,ellipsesSymbol=(listOpts.ellipsis&&listOpts.ellipsis.symbol)?listOpts.ellipsis.symbol:"&#8230;",pageState={},initCallbackFunc=listOpts.initCallback,callbackFunc=listOpts.callback,hasQuery=(listOpts.query!==undef)?listOpts.query:false,queryField=(hasQuery)?$(".list-query-field"):null,queryButton=(hasQuery)?$(".list-query-button"):null,queryString,currentShowCount;function getParams(){var returnObj={},items={},inputItem,inputObj,dataName;for(dataName in dataSelectors){if(dataSelectors.hasOwnProperty(dataName)){if(dataName==="filter"){for(inputItem in dataSelectors[dataName]){inputObj=dataSelectors[dataName][inputItem];if(inputObj.value!==undef&&inputObj.type!==undef&&inputObj.name!==""){if($("#"+inputObj.id).is(":checkbox")){returnObj[inputObj.name]=$("#"+inputObj.id).is(":checked");}else{if($("#"+inputObj.id).is("select")||$("#"+inputObj.id).is("input")){returnObj[inputObj.name]=$("#"+inputObj.id).val();}}}}returnObj.quickrange=$(".quick-range-list").children(".selected").children("a").text();returnObj.count=$("#list-show-count .active span").first().text();}else{returnObj[dataName]=dataSelectors[dataName].val();}}}returnObj.sort=$(".sort-by").val();return returnObj;}function applyFilter(evt,opts){var mOpts=(opts!==undef)?opts:{},callback,params,templateTarget,domTarget,fresh,dataUrl;function setEllipses(data){}function filterSuccess(data,textStatus,jqXHR){var courseItems;data.currentShowCount=currentShowCount;try{if($(data.users).length>0){$(data.users).each(function(i,user){user.fresh=fresh;});}else{data.fresh=fresh;}courseItems=templateTarget.tmpl(data);if(courseItems.length>0){var oCourseItem=null;for(var cnt=0;cnt<courseItems.length;cnt++){oCourseItem=courseItems[cnt];if(oCourseItem.innerHTML!==undefined){oCourseItem.innerHTML=oCourseItem.innerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">");courseItems[cnt]=oCourseItem;}}domTarget.empty();domTarget.append(courseItems);$(document).trigger("shareBar:render");}callback(data);}catch(err){}}function filterError(jqXHR,textStatus,errorThrown){}function internalCallback(data){if(callbackFunc!==undef){callbackFunc(data);}}function refreshSettings(){if(mOpts.callback!==undef){callback=mOpts.callback;}else{callback=internalCallback;}if(mOpts.params!==undef){params=mOpts.params;}else{throw"no params given for filter";}if(mOpts.templateTarget!==undef){templateTarget=mOpts.templateTarget;}else{throw"no templateTarget, cannot make template";}if(mOpts.domTarget!==undef){domTarget=mOpts.domTarget;}else{throw"no domTarget, cannot show template";}if(mOpts.fresh!==undef){fresh=mOpts.fresh;}else{fresh=true;}if(mOpts.dataUrl!==undef){dataUrl=mOpts.dataUrl;}else{throw"no data url, should be in form action";}}(function init(){if(evt!==undef&&evt!==null){evt.preventDefault();}refreshSettings();$.ajax({url:dataUrl,data:params,success:filterSuccess,error:filterError});}());}function initLoadData(){var opts={dataUrl:formSelector.attr("action"),params:getParams(),templateTarget:templateSelector,domTarget:targetSelector,callback:initCallbackFunc};pageState={};applyFilter(null,opts);}(function bindAll(){if(listOpts.pagination!==undef){nextPage=(listOpts.pagination.next!==undef)?listOpts.pagination.next:nextPage;prevPage=(listOpts.pagination.prev!==undef)?listOpts.pagination.prev:prevPage;pagesSelector=(listOpts.pagination.pages!==undef)?listOpts.pagination.pages:pagesSelector;pageCount=(listOpts.pagination.count!==undef)?listOpts.pagination.count:pageCount;}if(hasQuery&&queryField!=null&&queryField.length>0){queryField.bind("keypress."+eventNamespace,function(evt){var code=(evt.keyCode)?evt.keyCode:evt.which;if(code===13){queryButton.trigger(eventString);}});queryButton.bind(eventString,function(evt){var urlParams=getParams(),opts={};queryString=queryField.val();urlParams.page=1;urlParams.query=queryString;urlParams.count=+$(pageCount[0]).find(".active span").text();opts={dataUrl:formSelector.attr("action"),params:urlParams,templateTarget:templateSelector,domTarget:targetSelector,fresh:false};pageState={};applyFilter(evt,opts);});targetSelector.delegate("a.clear-search",eventString,function(evt){queryField.val("");queryButton.trigger(eventString);});}nextPage.live(eventString,function(evt){var sectionTarget=targetSelector.has(evt.currentTarget),userId=sectionTarget.attr("id"),newPage;if(pageState[userId]!==undef){pageState[userId].current+=1;}else{newPage=+sectionTarget.find(".current-page:first").html()+1;pageState[userId]={current:newPage};}});prevPage.live(eventString,function(evt){var sectionTarget=targetSelector.has(evt.currentTarget),userId=sectionTarget.attr("id"),newPage;if(pageState[userId]!==undef){pageState[userId].current-=1;}else{newPage=+sectionTarget.find(".current-page:first").html()+1;pageState[userId]={current:newPage};}});pagesSelector.live(eventString,function(evt){var bubbleTarget=$(evt.target),currentTarget=$(evt.currentTarget),sectionTarget=targetSelector.has(currentTarget),opts={},userId=sectionTarget.attr("id"),newPage;if(!bubbleTarget.is(nextPage.selector)&&!bubbleTarget.is(prevPage.selector)){newPage=+bubbleTarget.text();if(pageState[userId]!==undef){pageState[userId].current=newPage;}else{pageState[userId]={current:newPage};}}var urlParams=getParams();urlParams.page=pageState[userId].current;urlParams.count=+$("#list-show-count:first .active span").text();currentShowCount=urlParams.count;if(queryString!==undef&&queryString!==""){urlParams.query=queryString;}pageState[userId].target=sectionTarget;opts={dataUrl:formSelector.attr("action"),params:urlParams,templateTarget:templateSelector,domTarget:pageState[userId].target,fresh:false};applyFilter(evt,opts);});pageCount.live(eventString,function(evt){var currentTarget=$(evt.currentTarget),sectionTarget=targetSelector.has(currentTarget),opts={},userId=sectionTarget.attr("id"),currentPage=1,newCount=+$(evt.target).text();currentShowCount=newCount;if(pageState[userId]!==undef){pageState[userId].count=newCount;pageState[userId].current=currentPage;}else{pageState[userId]={count:newCount,current:currentPage};}pageState[userId].target=sectionTarget;var urlParams=getParams();urlParams.count=newCount;if(queryString!==undef&&queryString!==""){urlParams.query=queryString;}opts={dataUrl:formSelector.attr("action"),params:urlParams,templateTarget:templateSelector,domTarget:pageState[userId].target,fresh:false};applyFilter(evt,opts);});}());return{initLoad:initLoadData};},courseManager:function(listOpts){var formSelector=listOpts.form,formSubmit=listOpts.submit,eventNamespace=listOpts.namespace,eventString="click."+eventNamespace,nextPage=listOpts.pagination.next,prevPage=listOpts.pagination.prev,pagesSelector=listOpts.pagination.pages,pageCount=listOpts.pagination.count,templateSelector=listOpts.template,targetSelector=listOpts.target,dataSelectors=listOpts.data,ellipsesMax=(listOpts.ellipsis&&listOpts.ellipsis.max)?listOpts.ellipsis.max:7,ellipsesSymbol=(listOpts.ellipsis&&listOpts.ellipsis.symbol)?listOpts.ellipsis.symbol:"&#8230;",pageState={},initCallbackFunc=listOpts.initCallback,callbackFunc=listOpts.callback,$loadingIcon=$('<img alt="loading-icon" src="'+RCO.util.root+'/images/modal/loading.gif" />');function getParams(){var returnObj={},inputItem,inputObj,dataName;for(dataName in dataSelectors){if(dataSelectors.hasOwnProperty(dataName)){if(dataName==="filter"){for(inputItem in dataSelectors[dataName]){inputObj=dataSelectors[dataName][inputItem];if(inputObj.value!==undef&&inputObj.type!==undef&&inputObj.name!==""){if($("#"+inputObj.id).is(":checkbox")){returnObj[inputObj.name]=$("#"+inputObj.id).is(":checked");}else{if($("#"+inputObj.id).is("select")||$("#"+inputObj.id).is("input")){returnObj[inputObj.name]=$("#"+inputObj.id).val();}}}}returnObj.quickrange=$(".quick-range-list").children(".selected").children("a").text();}else{returnObj[dataName]=dataSelectors[dataName].val();}}}returnObj.count=$("#list-show-count .active span").first().text();returnObj.sort=$(".sort-by").val();return returnObj;}function applyFilter(evt,opts){var mOpts=(opts!==undef)?opts:{},callback,params,templateTarget,domTarget,fresh,dataUrl;function setEllipses(data){var pageCount=data.pages.length,currentPage=+data.pageNum,surroundCount=ellipsesMax-2,pageId=currentPage-1,eLeft=false,leftCount=0,eRight=false,rightCount=0,newPageArray=[],i;leftCount=pageId-Math.floor(surroundCount/2);rightCount=pageId+Math.floor(surroundCount/2);if(pageId<surroundCount-leftCount){leftCount=0;rightCount=surroundCount;}else{if(rightCount>=pageCount-1){rightCount=pageCount;leftCount=pageCount-surroundCount-1;}}for(i=0;i<pageCount;i+=1){if(i===0||(i>=leftCount&&i<=rightCount)||i===pageCount-1){data.pages[i].ellipsis=false;newPageArray.push(data.pages[i]);}else{if(i<leftCount){if(!eLeft){eLeft=true;newPageArray.push({ellipsis:true,ellipsisSymbol:ellipsesSymbol});}}else{if(i>rightCount){if(!eRight){eRight=true;newPageArray.push({ellipsis:true,ellipsisSymbol:ellipsesSymbol});}}}}}data.pages=newPageArray;}function filterSuccess(data,textStatus,jqXHR){var courseItems;try{if($(data.users).length>0){$(data.users).each(function(i,user){user.fresh=fresh;if(user.pages.length>ellipsesMax){setEllipses(user);}});}else{data.fresh=fresh;}if(dataSelectors!==undef){dataSelectors.sort=$(".sort-by");}courseItems=templateTarget.tmpl(data);if(courseItems.length>0){domTarget.empty();domTarget.append(courseItems);}$(document).trigger("CourseListRendered");var expandedMiles=data.exdMiles;if(expandedMiles>0&&expandedMiles<=250){var event=jQuery.Event("customRadiusX");event.radiusX=expandedMiles;event.type="customRadiusX";setTimeout(function(){$("#radius-slider-bar").trigger(event);},1000);}}catch(err){}finally{callback(data);}}function filterError(jqXHR,textStatus,errorThrown){}function internalCallback(data){if(callbackFunc!==undef){callbackFunc(data);}}function refreshSettings(){if(mOpts.callback!==undef){callback=mOpts.callback;}else{callback=internalCallback;}if(mOpts.params!==undef){params=mOpts.params;}else{throw"no params given for filter";}if(mOpts.templateTarget!==undef){templateTarget=mOpts.templateTarget;}else{throw"no templateTarget, cannot make template";}if(mOpts.domTarget!==undef){domTarget=mOpts.domTarget;}else{throw"no domTarget, cannot show template";}if(mOpts.fresh!==undef){fresh=mOpts.fresh;}else{fresh=true;}if(mOpts.dataUrl!==undef){dataUrl=mOpts.dataUrl;}else{throw"no data url, should be in form action";}}(function init(){if(evt!==undef&&evt!==null){evt.preventDefault();}refreshSettings();params.timestamp=new Date().getTime();$.ajax({url:dataUrl,data:params,success:filterSuccess,error:filterError});}());}(function bindAll(){formSelector.live("submit",function(evt){var opts={dataUrl:formSelector.attr("action"),params:getParams(),templateTarget:templateSelector,domTarget:targetSelector,callback:callbackFunc};pageState={};opts.params.page=1;applyFilter(evt,opts);});(function(){var returnObj={},dataName,items={},inputObj,inputItem;function submitForm(){$(formSelector).submit();}for(dataName in dataSelectors){if(dataSelectors.hasOwnProperty(dataName)&&dataName==="filter"){for(inputItem in dataSelectors[dataName]){if(dataSelectors.hasOwnProperty(inputItem)){inputObj=dataSelectors[dataName][inputItem];if(inputObj.value!==undef&&inputObj.id!==""){$("#"+inputObj.id).live("change",submitForm());}}}}}})();nextPage.live(eventString,function(evt){var sectionTarget=targetSelector.children().has(evt.currentTarget),userId=sectionTarget.attr("id"),newPage;if(pageState[userId]!==undef){pageState[userId].current+=1;}else{newPage=+sectionTarget.find(".current-page:first").html()+1;pageState[userId]={current:newPage};}});prevPage.live(eventString,function(evt){var sectionTarget=targetSelector.children().has(evt.currentTarget),userId=sectionTarget.attr("id"),newPage;if(pageState[userId]!==undef){pageState[userId].current-=1;}else{newPage=+sectionTarget.find(".current-page:first").html()+1;pageState[userId]={current:newPage};}});pagesSelector.live(eventString,function(evt){var currentTarget=$(evt.currentTarget),sectionTarget=targetSelector.children().has(currentTarget),opts={},userId=sectionTarget.attr("id"),newPage;if(!currentTarget.is(nextPage.selector)&&!currentTarget.is(prevPage.selector)){newPage=+currentTarget.text();if(pageState[userId]!==undef){pageState[userId].current=newPage;}else{pageState[userId]={current:newPage};}}var urlParams=getParams();urlParams.page=pageState[userId].current;urlParams.count=+$("#list-show-count:first .active span").text();urlParams.user=userId;pageState[userId].target=sectionTarget;opts={dataUrl:formSelector.attr("action"),params:urlParams,templateTarget:templateSelector,domTarget:pageState[userId].target,fresh:false};applyFilter(evt,opts);});pageCount.live(eventString,function(evt){var currentTarget=$(evt.currentTarget),sectionTarget=targetSelector.children().has(currentTarget),opts={},userId=sectionTarget.attr("id"),currentPage=1,newCount=+currentTarget.text();if(pageState[userId]!==undef){pageState[userId].count=newCount;pageState[userId].current=currentPage;}else{pageState[userId]={count:newCount,current:currentPage};}pageState[userId].target=sectionTarget;var urlParams=getParams();urlParams.count=newCount;opts={dataUrl:formSelector.attr("action"),params:urlParams,templateTarget:templateSelector,domTarget:pageState[userId].target,fresh:false};applyFilter(evt,opts);});}());(function initLoadData(){var opts={dataUrl:formSelector.attr("action"),params:getParams(),templateTarget:templateSelector,domTarget:targetSelector,callback:initCallbackFunc};pageState={};opts.params.page=1;if(window.vPage!=undefined&&vPage!=""){opts.params.page=parseFloat(vPage);}if(window.vCount!=undefined&&vCount!=""){opts.params.count=parseFloat(vCount);}applyFilter(null,opts);}());return{getParams:getParams()};},calendarManager:function(){var templateTarget=$("#calendar-tmpl"),domTarget=$("#calendar-container"),dataUrl=$("#calendar-filter").attr("action"),calendarData,today=new Date(),params={},pageMonth=today.getMonth();function Calendar(month,year){this.month=(isNaN(month)||month===null)?today.getMonth():month;this.year=(isNaN(year)||year===null)?today.getFullYear():year;this.data={};}Calendar.prototype.buildData=function(){var firstDay=new Date(this.year,this.month,1),startingDate=firstDay.getDay(),monthLength=RCO.util.calendar.months[this.month].days,lastMonthLength,currentMonth,currentYear=this.year,prevMonthId,nextMonthId,usePrevYear=false,useNextYear=false,data,dayData,day,i,n,x;if(this.month===0){usePrevYear=true;prevMonthId=11;lastMonthLength=RCO.util.calendar.months[prevMonthId].days;}else{prevMonthId=this.month-1;lastMonthLength=RCO.util.calendar.months[prevMonthId].days;}if(this.month===11){useNextYear=true;nextMonthId=0;}else{nextMonthId=this.month+1;}if(this.month===1){if((this.year%4===0&&this.year%100!==0)||this.year%400===0){monthLength=29;}}data={head:[],dates:{}};if(prevMonthId<today.getMonth()&&this.year===today.getFullYear()){data.disablePrev=true;}else{data.disablePrev=false;}data.dates[this.year]={};if(usePrevYear){currentYear=this.year-1;data.dates[this.year-1]={};data.dates[this.year-1][prevMonthId]={};}else{data.dates[this.year][prevMonthId]={};}data.dates[this.year][this.month]={};if(useNextYear){data.dates[this.year+1]={};data.dates[this.year+1][nextMonthId]={};}else{data.dates[this.year][nextMonthId]={};}for(i=0;i<7;i+=1){dayData=RCO.util.calendar.weekdays[i];data.head[i]={};data.head[i][dayData.name]=dayData.abbr;}x=0;day=lastMonthLength-startingDate+1;currentMonth=prevMonthId;for(i=0;i<9;i+=1){for(n=0;n<7;n+=1){if((day>lastMonthLength&&currentMonth<this.month)||(day>monthLength&&currentMonth>=this.month)){day=1;currentMonth+=1;if(usePrevYear){currentYear+=1;usePrevYear=false;}}if(currentMonth===12){currentMonth=0;if(useNextYear){currentYear+=1;useNextYear=false;}}data.dates[currentYear][currentMonth][day]={};if(currentMonth!==this.month){data.dates[currentYear][currentMonth][day].notCurrentMonth=true;}if(n===0){data.dates[currentYear][currentMonth][day].startWeek=true;if(day+6>=monthLength&&currentMonth===this.month){data.dates[currentYear][currentMonth][day].lastWeek=true;}}else{if(n===6){data.dates[currentYear][currentMonth][day].endWeek=true;}}if(data.dates[today.getFullYear()]!==undef&&data.dates[today.getFullYear()][today.getMonth()]!==undef&&data.dates[today.getFullYear()][today.getMonth()][today.getDate()]!==undef){if(day===today.getDate()&&currentMonth===today.getMonth()){data.dates[currentYear][currentMonth][day].isToday=true;}}if(day<=lastMonthLength||day<=monthLength){day+=1;}x+=1;}if((x+1)-day>=monthLength||day>monthLength){break;}}this.data=data;};function updateCalendar(data,textStatus,jqXHR){var calendarItems;calendarData=new Calendar(data.month,data.year);calendarData.buildData();$.each(data.days,function(i,value){calendarData.data.dates[data.year][data.month][value.day].classes=value.classes;});calendarData.data.month=data.month;calendarData.data.year=data.year;calendarData.data.userId=data.userId;calendarData.data.userName=data.userName;calendarData.data.todayHref=data.todayHref;calendarData.data.prevMonthHref=data.prevMonthHref;calendarData.data.nextMonthHref=data.nextMonthHref;try{calendarItems=templateTarget.tmpl(calendarData.data);if(calendarItems.length>0){domTarget.empty();domTarget.append(calendarItems);}}catch(err){}}function updateError(jqXHR,textStatus,errorThrown){}$("#calendar-filter-submit").live("click.myCourses",function(evt){evt.preventDefault();params[$("#calendar-users").attr("name")]=$("#calendar-users").val();$.ajax({url:dataUrl,data:params,success:updateCalendar,error:updateError});});$(".controller a").live("click.myCourses",function(evt){var nextUrl=$(evt.currentTarget).attr("href");evt.preventDefault();if(domTarget.find(".cal-table").attr("id")!==undef){params[$("#calendar-users").attr("name")]=domTarget.find(".cal-table").attr("id");}$.ajax({url:nextUrl,data:params,success:updateCalendar,error:updateError});});},CourseListWithMap:function(){var courses,selectedFilterList=$(".active-filter-list"),contactLocal=$(".contact-local"),tabWrap=$(".course-catalog-tab"),tc,catalogMapArticle,addOnline=true,currentTab,MAP_TAB="mapTab",LIST_TAB="listTab",CALENDAR_TAB="calendarTab",datepickerInitialized=false,eventsThisMonth,radiusLimit={handleLeft:8,handleRight:136,increment:16,steps:8,distancePerStep:5},toolTipShown=false,toolTipTimer,dateRangeText;function updateMap(data){if(data===undef||data.users===undef){data=RCO.courseData;}var latlngbounds=new google.maps.LatLngBounds(RCO.GeocodeRequest.userLatLng);var i=0,j=0;catalogMapArticle.publish();if(!!data.users[0].facilities.length){for(i=0,j=data.users[0].facilities.length;i<j;i++){var latlng=new google.maps.LatLng(data.users[0].facilities[i]._location[0].lat,data.users[0].facilities[i]._location[0].lng);catalogMapArticle.addMarker({position:latlng},data.users[0].facilities[i]);latlngbounds.extend(latlng);catalogMapArticle.map.fitBounds(latlngbounds);}}else{google.maps.event.trigger(catalogMapArticle.map,"resize");catalogMapArticle.map.setCenter(RCO.GeocodeRequest.userLatLng);log("WARN: could not plot chapter marker because chapter results were undefined.");}}function prepareQuickDateRange(){var wrap=$(".quick-range-list"),triggerWrap=wrap.find("li"),triggers=triggerWrap.children("a"),selectClass="selected";triggers.bind("click",function(){var that=$(this),thisWrap=that.closest("li");triggerWrap.not(thisWrap).removeClass(selectClass);thisWrap.addClass(selectClass);$("#catalogList-filter").submit();return false;});}function prepareRadiusSlider(){var radius=$("#miles").val();var slider=$("#radius-slider");var highlight=$("#radius-slider-highlight");var handle=$("#radius-slider-handle");var radiusLabel=$(".radius-miles");var radiusData=slider.data("radius");var radiusMin=slider.data("radius-min");var radiusMax=slider.data("radius-max");var stepSize=10;var step;var tempRadius=radius;var left;slider.data("radius",radius);radiusLabel.text(radius);while(tempRadius>50){radiusMin=radiusMin+10;tempRadius=tempRadius-10;}step=(radius-radiusMin)/radiusLimit.distancePerStep;left=(step*radiusLimit.increment)+radiusLimit.handleLeft;handle.css({left:left});highlight.css({width:step*radiusLimit.increment});slider.data("radius-min",radiusMin);slider.find("li").each(function(idx,elem){$(elem).text((idx*stepSize)+slider.data("radius-min"));});}function updateMapRadius(){var filterMap=RCO.Map.subscribers.filterMap,radius=$("#radius-slider").data("radius"),$radius=$(".radius-miles");filterMap.setRadius(null,radius);$radius.text(radius);$("#miles").val(radius);updateFilter();}function updateRadiusSlider(e){var highlight=$("#radius-slider-highlight"),handle=$("#radius-slider-handle"),slider=$("#radius-slider"),offset=Math.round(e.clientX-$("#radius-slider").offset().left),radiusMin=$("#radius-slider").data("radius-min"),step=Math.round(offset/radiusLimit.increment)-1,left;$("#chkExdMiles").val("false");if(e.type==="click"){if(offset<radiusLimit.handleLeft){updateRange($("#radius-slider-minus"));return;}else{if(offset>radiusLimit.handleRight){updateRange($("#radius-slider-plus"));return;}else{left=(step*radiusLimit.increment)+radiusLimit.handleLeft;}}}else{if(offset<radiusLimit.handleLeft){left=radiusLimit.handleLeft;step=0;}else{if(offset>radiusLimit.handleRight){left=radiusLimit.handleRight;step=radiusLimit.steps;}else{left=(step*radiusLimit.increment)+radiusLimit.handleLeft;}}}handle.css({left:left});highlight.css({width:step*radiusLimit.increment});slider.data("radius",(radiusLimit.distancePerStep*step)+radiusMin);if(e.type==="click"){updateMapRadius();}}function updateRange(element){var $elem=element,stepSize=10,stepDistance=$elem.is("#radius-slider-minus")?-stepSize:stepSize,slider=$("#radius-slider"),radius=slider.data("radius"),radiusMin=slider.data("radius-min"),radiusMax=slider.data("radius-max");if(radiusMin+stepDistance<stepSize||radiusMin+stepDistance+(stepSize*4)>radiusMax){return;}slider.data("radius",parseFloat(radius)+parseFloat(stepDistance));slider.data("radius-min",parseFloat(radiusMin)+parseFloat(stepDistance));slider.find("li").each(function(idx,elem){$(elem).text((idx*stepSize)+slider.data("radius-min"));});updateMapRadius();}function updateExpandRadius(e){var radius=e.radiusX;$("#miles").val(radius);prepareRadiusSlider();setTimeout(function(){updateExpandMapRadius(radius);},2000);}function updateExpandMapRadius(radius){var filterMap=RCO.Map.subscribers.filterMap;try{var tries=0;while(filterMap==undefined&&tries++<5){RCO.util.sleep(1000);filterMap=RCO.Map.subscribers.filterMap;}filterMap.setRadius(null,radius);}catch(err){}}function addSelectedFilter(elem,isSearch){var elemName=$(elem).attr("name"),dispName=$(elem).next().text(),li=$("<li/>"),a=$("<a/>");a.addClass("remove-filter").html("x&nbsp;");if(selectedFilterList.find("[data-filter="+elemName+"]").length>0){removeSelectedFilter(elemName);}if(isSearch){dispName="Search: "+$(elem).val();}if($(elem).parents("fieldset").hasClass("category-filters")){li.attr("data-catFilter","true");}li.attr("data-filter",elemName).text(dispName).prepend(a);selectedFilterList.append(li);}function removeSelectedFilter(elemName){selectedFilterList.find("[data-filter="+elemName+"]").fadeOut("fast").remove();}function removeAllFilter(){$("#all-categories").removeAttr("checked").parent().removeClass("selected");$(".active-filter-list li[data-filter=allCategories]").fadeOut("fast").remove();}function removeAllCatFilters(){$(".active-filter-list li[data-catFilter=true]").fadeOut("fast").remove();checkContactLocal();}function unselectCatBoxes(){var checkboxes=$(".category-filters").find("input[type=checkbox]");checkboxes.removeAttr("checked").parent().removeClass("selected");}function setAllCatFilters(){var catFilters=$(".category-filters").find("input[type=checkbox]");for(var i=0;i<catFilters.length;i++){addSelectedFilter(catFilters[i],false);}checkContactLocal();}function setSelectedFilters(data){var catFilters=$(".checkbox-filters"),elem;catFilters.find("input[type=checkbox]").each(function(i,e){elem=$(e);if(elem.is(":checked")){addSelectedFilter(elem);}});}function updateContactLocal(){var $tmpl=$("#contactLocal-event-tmpl");if($tmpl.length>0){var $tmplTarget=$(".tabbody .contact-local");var name;var phone;if(RCO.courseData.users[0].facilities.length>0&&RCO.courseData.users[0].facilities[0].hasOwnProperty("name")&&RCO.courseData.users[0].facilities[0].hasOwnProperty("phone")){name=RCO.courseData.users[0].facilities[0].name;phone=RCO.courseData.users[0].facilities[0].phone;}else{name="no facility name or phone given";phone="no facility name or phone given";}var cleanData={currentCity:RCO.GeocodeRequest.userLocation.city,currentState:RCO.GeocodeRequest.userLocation.state,chapterName:name,chapterPhone:phone,currentZip:RCO.GeocodeRequest.userLocation.zip};var tmplResult=$.tmpl($tmpl,cleanData);$tmplTarget.empty().append(tmplResult);var $mapLocator=$tmplTarget.find(".locator-modal");RCO.ui.modal.init($mapLocator,{width:992,onLoad:function(){$("#cboxClose").hide();},onComplete:RCO.exec.common.locatorModal});}}function checkContactLocal(){var i,newHeight,currentIndex,show=RCO.courseData.users[0].showLocalChapter;if(show){updateContactLocal();if(!contactLocal.hasClass("show")){currentIndex=tabWrap.children(".tabs-list").children(".current").index();newHeight=contactLocal.eq(currentIndex).children(".contact-local-inner").outerHeight();contactLocal.addClass("show").height(newHeight);}}else{contactLocal.removeClass("show").height("0px");}}function prepareFilterCheckboxes(){var sidebar=$(".filter-sidebar"),checkboxFilterSet=sidebar.find(".checkbox-filters"),categoryFilterSet=sidebar.find(".category-filters"),allFilter=$("#all-categories"),selectedClass="selected",checkboxes=checkboxFilterSet.find("input[type=checkbox]"),categoryCheckboxes=categoryFilterSet.find("input[type=checkbox]");function onCheckboxClick(evt){$("#selected-course-product").val("");var wrap=$(evt.target).closest(".form-row"),input=wrap.find("input[type=checkbox]");wrap.toggleClass(selectedClass);if(wrap.hasClass(selectedClass)){input.prop("checked",true);addSelectedFilter(input);}else{input.prop("checked",false);removeSelectedFilter(input.attr("name"));}}(function(){allFilter.live("click",function(e){if($(e.target).is(":checked")){categoryCheckboxes.prop("checked",true);categoryCheckboxes.parent().addClass(selectedClass);setAllCatFilters();}else{categoryCheckboxes.prop("checked",false);categoryCheckboxes.parent().removeClass(selectedClass);removeAllCatFilters();}});checkboxFilterSet.delegate("input[type=checkbox]","click",function(evt){if(!$(this).closest(".category-filters").length){return;}if($(evt.target).attr("id")!==allFilter.attr("id")){if(categoryFilterSet.find("input[type=checkbox]:checked").not(allFilter).length===categoryFilterSet.find("input[type=checkbox]").not(allFilter).length){allFilter.prop("checked",true);allFilter.parent().addClass("selected");addSelectedFilter(allFilter);}else{allFilter.prop("checked",false);allFilter.parent().removeClass("selected");removeSelectedFilter(allFilter.attr("name"));}}});checkboxes.each(function(){var $this=$(this),check=$this.prop("checked"),wrap=$this.parent(".form-row");if(check){wrap.addClass(selectedClass);}else{wrap.removeClass(selectedClass);}});checkboxes.bind("click",onCheckboxClick);})();}function maintainSortFilter(data){$(".sort-by").val(data.users[0].sortCoursesBy);}function setSortArrow(sortFilter){var catalogList=$("#catalog-list"),courseTable=catalogList.find(".course-table"),tableHeads=courseTable.find("th");switch(sortFilter){case"distanceAsc":tableHeads.filter(".distance").addClass("sorted-asc");break;case"distanceDesc":tableHeads.filter(".distance").addClass("sorted-desc");break;case"titleAtoZ":tableHeads.filter(".title").addClass("sorted-asc");break;case"titleZtoA":tableHeads.filter(".title").addClass("sorted-desc");break;case"dateAsc":tableHeads.filter(".dates-and-times").addClass("sorted-asc");break;case"dateDesc":tableHeads.filter(".dates-and-times").addClass("sorted-desc");break;case"languageAsc":tableHeads.filter(".lang").addClass("sorted-asc");break;case"languageDesc":tableHeads.filter(".lang").addClass("sorted-desc");break;case"priceLowHigh":tableHeads.filter(".price").addClass("sorted-asc");break;case"priceHighLow":tableHeads.filter(".price").addClass("sorted-desc");break;}}function updateResultDesc(data){updateDateDisplay();var tmplData={resultsShown:data.users[0].coursesShown,showTotal:true,totalResults:data.users[0].coursesTotal,distance:$("#miles").val(),address:$("#edit-location .current-address").text(),dateString:dateRangeText,useMonth:false,monthName:"temp month name"};RCO.ui.form.datePicker();var $tmplTarget=$(".displaying-results");var tmplHtml='<span class="results-count">Displaying ';tmplHtml+='<span class="results-shown">{{= resultsShown}}</span>';tmplHtml+='{{if showTotal}} of <span class="results-total">{{= totalResults}}</span>{{/if}}';tmplHtml+="&nbsp;results</span>";var $classroom=$("#Classroom");var classroomChecked=$classroom.is(":checked");var $blended=$("#Blended");var blendedChecked=$blended.is(":checked");var $narrowSearch=$("#course-filters .narrow-search");var $locFilterTarget=$narrowSearch.find(".filter-group");var $dateFilterTarget=$narrowSearch.find(".calendarDetails");if(blendedChecked||classroomChecked){tmplHtml+=' within <span class="radius-miles">{{= distance}}</span>';tmplHtml+=' miles of <span class="current-address">{{= address}}</span>&nbsp;';tmplHtml+='for {{if useMonth}}{{= monthName}} {{/if}}<span class="date-range">{{= dateString}}</span>';$locFilterTarget.find(".miles-count").show();$locFilterTarget.find(".current-location").show();$locFilterTarget.find("#radius-slider").show();$dateFilterTarget.children().not(".time-range-picker").show();}else{$locFilterTarget.find(".miles-count").hide();$locFilterTarget.find(".current-location").hide();$locFilterTarget.find("#radius-slider").hide();$dateFilterTarget.children().not(".time-range-picker").hide();}switch(currentTab){case MAP_TAB:var courseCount=0;for(var i=0;i<data.users[0].facilities.length;i++){courseCount+=data.users[0].facilities[i].courseList.length;}tmplData.showTotal=false;tmplData.resultsShown=courseCount;break;case LIST_TAB:case undef:var evtCount=$("tr.vevent").length;if(evtCount<tmplData.resultsShown){tmplData.resultsShown=evtCount;}break;case CALENDAR_TAB:var $cal=$("#course-calendar");var calDate=$cal.fullCalendar("getDate");var calView=$cal.fullCalendar("getView");var monthName=calDate.getMonthName();tmplData.useMonth=true;tmplData.monthName=monthName;var firstOfMonth=calView.start.asString("mm/dd/yy");var endDate=new Date(calView.end);endDate.setDate(endDate.getDate()-1);var lastOfMonth=endDate.asString("mm/dd/yy");tmplData.dateString="("+firstOfMonth+" - "+lastOfMonth+")";tmplData.showTotal=false;tmplData.resultsShown=$(".fc-event").length;break;}var tmplResults=$.tmpl(tmplHtml,tmplData);$tmplTarget.empty().append(tmplResults);}function updateDateDisplay(){var qFilter=$(".quick-range-list .selected a"),fromDate=new Date(),toDate=new Date(fromDate),datePickers=$(".date-pickers-wrap"),fromDateField=datePickers.find(".from-date-field"),fromDateInput=fromDateField.find("#from-date"),toDateField=datePickers.find(".to-date-field"),toDateInput=toDateField.find("#to-date"),fromDateTxt,toDateTxt,dateTxt,daysToAdd;if(fromDateField.length>0&&toDateField.length>0){if($(".quick-range-list li.selected").length>0){dateTxt=qFilter.text();switch(qFilter.text()){case"Next 31 Days":daysToAdd=31;break;case"Tomorrow":daysToAdd=1;fromDate.addDays(1);break;case"This Week":daysToAdd=6-fromDate.getDay();break;case"Next Week":var remaining=7-fromDate.getDay();fromDate.addDays(remaining);daysToAdd=remaining+6;break;default:break;}toDate.addDays(daysToAdd);fromDateTxt=writeDate(fromDate);toDateTxt=writeDate(toDate);dateTxt+=" ("+fromDateTxt+" - "+toDateTxt+")";fromDateInput.val(fromDateTxt);toDateInput.val(toDateTxt);fromDateField.dpSetSelected(fromDate.asString());toDateField.dpSetSelected(toDate.asString());}else{fromDateTxt=writeDate(fromDate);toDateTxt=writeDate(toDate);dateTxt=fromDateInput.val()+" - "+toDateInput.val();fromDateField.dpSetSelected(fromDateInput.val());toDateField.dpSetSelected(toDateInput.val());$("span.date-range").text(dateTxt);fromDate=fromDateInput.val();toDate=toDateInput.val();}if(!datepickerInitialized){RCO.ui.form.datePicker();datepickerInitialized=true;}dateRangeText=dateTxt;}}function writeDate(dateObj){var month=dateObj.getMonth()+1,date=dateObj.getDate(),year=dateObj.getFullYear();if(month<10){month="0"+month;}if(date<10){date="0"+date;}return month+"/"+date+"/"+year.toString().slice(2);}function updateCallback(data){var $calendar;RCO.courseData=data;if(catalogMapArticle&&currentTab==MAP_TAB){updateMap(RCO.courseData);}checkContactLocal();$calendar=$("#course-calendar");$calendar.fullCalendar("removeEvents");checkCalendarExceptions(data.users[0]);if(data.users[0].courseCal){$calendar.fullCalendar("addEventSource",convertToEvent(data.users[0].courseCal));updateResultDesc(RCO.courseData);}updateResultDesc(data);maintainSortFilter(data);setSortArrow(RCO.courseData.users[0].sortCoursesBy);}function initCallback(data){setSortArrow(data.users[0].sortCoursesBy);updateResultDesc(data);setSelectedFilters(data);maintainSortFilter(data);RCO.courseData=data;checkContactLocal();}function catalogList(){var pointer=new RCO.ui.ajax.courseManager({form:$("#catalogList-filter"),submit:$("#catalogList-filter-submit"),namespace:"coursesLanding",pagination:{next:$(".catalogList-next"),prev:$(".catalogList-prev"),pages:$(".catalogList-page"),count:$(".catalogList-show")},template:$("#catalogList-wrapper-tmpl"),target:$(".catalogList-container","#catalog-list"),data:{user:$("#course-users"),sort:$(".sort-by"),searchText:$("#course-search"),filter:$(".accordion-content").find(":input")},initCallback:initCallback,callback:updateCallback});}function checkCalendarExceptions(calData){var errorOverlay=$("#calendar-error-overlay"),errorSet=errorOverlay.find(".errorset"),emptyErr=errorSet.filter("[data-exception=noResults]"),limitErr=errorSet.filter("[data-exception=dailyLimit]"),courseCal=calData.courseCal;if(courseCal!==undef){if(courseCal.length<1){errorOverlay.add(emptyErr).show();return;}if(!calData.allowCalendar){errorOverlay.add(limitErr).show();return;}errorOverlay.add(errorSet).hide();}else{errorOverlay.add(emptyErr).show();}}function onViewDisplay(view){checkCalendarExceptions(RCO.courseData.users[0]);updateResultDesc(RCO.courseData);if(RCO.util.browser.isIE7||RCO.util.browser.isIE9compat7||RCO.util.browser.isIE8compat){window.setTimeout(function(){$(".fc-button-prev, .fc-header-title, .fc-button-next").css({display:"block","float":"left","z-index":"999"});},1000);}RCO.exec.courses.loadLTPClassRegisterModal();}function renderEvent(event,element,view){var $details=$("<div/>"),$titleLink=$("<a/>"),$tooltip=event.tooltip;element.html("");$titleLink.attr("href",event.courseHref||"#");$titleLink.addClass("open-tooltip").text(event.title).wrap("<h3/>").appendTo(element);$details.text(event.format).appendTo(element);$tooltip.appendTo(element);}function afterRender(event,element,view){var $tooltip=element.find(".rco-tooltip-cal"),leftVal=+element.find(".open-tooltip").width()+20;if(+element.css("left")>350){leftVal=-340;$tooltip.find(".bg-arrow").addClass("bg-arrow-right").removeClass("bg-arrow");}$tooltip.css("left",leftVal).css("top","-60px");}function convertToEvent(courseData){var courses=courseData,events=[],coursesLen,event,i;if(courses){for(i=0,coursesLen=courses.length;i<coursesLen;i+=1){if(courses[i].datesAndTimes!=null){event={allDay:false,title:courses[i].courseTitle,courseHref:courses[i].courseHref,format:courses[i].formatType,start:courses[i].datesAndTimes.datesRange.startDate,end:courses[i].datesAndTimes.datesRange.startDate,facility:null,city:null,state:null,language:courses[i].courseLanguage,price:courses[i].price,latlng:null,sessions:[{sessionDate:null,startTime:null,endTime:null},{sessionDate:null,startTime:null,endTime:null}],tooltip:$.tmpl($("#event-tooltip-tmpl"),courses[i])};events.push(event);}}}else{}return events;}function enableOnlineFilter(bool,complete){var $dataFilter=$('.active-filter-list li[data-filter="online"]'),$online=$("#online");var $wrap=$online.closest(".form-row");if(bool){$dataFilter.css("opacity",1);$online.removeAttr("disabled").next().css("opacity",1);if(addOnline){$online.attr("checked","checked");if(!$wrap.is(".selected")){$wrap.toggleClass("selected");}updateFilter();}try{$('li[data-filter="online"]')[0].style.removeAttribute("filter");}catch(err){}}else{if(complete){$dataFilter.fadeOut("fast").remove();addOnline=$online.is(":checked");$online.removeAttr("checked");}else{$dataFilter.css("opacity",0.4);addOnline=$online.is(":checked");if($wrap.is(".selected")){$wrap.toggleClass("selected");}$online.attr("disabled","disabled").removeAttr("checked").next().css("opacity",0.4);}}}function showTooltip(_elem){var elem=_elem,viewport=$(window),viewportWidth=viewport.width(),viewportHeight=viewport.height(),tooltip=elem.children(".rco-tooltip"),tooltipWidth,tooltipHeight,scrollTop,scrollLeft,elemOffset,elemWidth,elemHeight,spaceOnLeft;function showIt(){toolTipTimer=setTimeout(function(){toolTipShown=true;tooltipWidth=tooltip.outerWidth(true);tooltipHeight=tooltip.outerHeight(true);scrollTop=viewport.scrollTop();scrollLeft=viewport.scrollLeft();elemOffset=elem.offset();elemWidth=elem.outerWidth(true);elemHeight=elem.outerHeight(true);spaceOnLeft=elemOffset.left-scrollLeft;if(viewportWidth-spaceOnLeft-elemWidth-13<tooltipWidth&&spaceOnLeft>tooltipWidth){tooltip.css("left","-"+(tooltipWidth+15)+"px");tooltip.addClass("align-right");}else{tooltip.css("left",(elemWidth+15)+"px");tooltip.removeClass("align-right");}if(viewportHeight-(elemOffset.top-scrollTop)+22<tooltipHeight){tooltip.css({top:"-"+(tooltipHeight-50)+"px"});tooltip.addClass("align-bottom");}else{tooltip.css({top:"-20px"});tooltip.removeClass("align-bottom");}elem.css("z-index",100);tooltip.addClass("shown").fadeIn(500);},300);}clearTimeout(toolTipTimer);if(!toolTipShown){showIt();}else{if(!tooltip.hasClass("shown")){$(".rco-tooltip").filter(".shown").removeClass("shown").hide().parent().css("z-index",8);showIt();}}}function hideTooltip(element){clearTimeout(toolTipTimer);if(!!toolTipShown){toolTipTimer=setTimeout(function(){toolTipShown=false;element.children(".rco-tooltip").removeClass("shown").fadeOut(500,function(){element.css("z-index",8);});},300);}}function calInit(){$("#course-calendar").fullCalendar({events:convertToEvent(RCO.courseData.users[0].courseCal),eventMouseover:function(){showTooltip($(this));},eventMouseout:function(){hideTooltip($(this));},header:{left:"prev title next",center:"",right:""},contentHeight:1115,theme:false,titleFormat:{month:"MMMM"},columnFormat:{month:"dddd"},weekMode:"variable",eventRender:renderEvent,eventAfterRender:afterRender,viewDisplay:onViewDisplay});}function setPageCountActive(){}function hideRecentlyViewed(elemId){var recView=$(elemId).children();if(recView.length>3){for(var i=3;i<recView.length;i++){$(recView[i]).addClass("hide-course");}}}function showRecentLink(e){var el=$(e.target);if(el.text().trim()==="Show more"){$("#recently-viewed").find(".hide-course").removeClass("hide-course").addClass("show-course").slideDown("fast",function(e){$(this).fadeIn("fast");});el.text("Show less");}else{$("#recently-viewed").find(".show-course").removeClass("show-course").fadeOut("fast",function(e){$(this).slideUp("fast");}).addClass("hide-course");hideRecentlyViewed("#recently-viewed");el.text("Show more");}}function showRecommendedLink(e){var el=$(e.target);if(el.text()==="Show more"){$("#recommended-courses").find(".hide-course").removeClass("hide-course").addClass("show-course").slideDown("fast",function(e){$(this).fadeIn("fast");});el.text("Show less");}else{$("#recommended-courses").find(".show-course").removeClass("show-course").fadeOut("fast",function(e){$(this).slideUp("fast");}).addClass("hide-course");hideRecentlyViewed("#recommended-courses");el.text("Show more");}}function onDateChanged(e){e.preventDefault();if($(this).length>0){$(".quick-range-list").children().removeClass("selected");}}function onQuickRangeSelect(e){e.preventDefault();if($(this).find(".selected").length>0){$(".date-pickers-wrap input").val("");}}function onSearchSubmit(e){e.preventDefault();var search=$("#course-search");if(search.val().length<0||search.val()===search.attr("placeholder")){return false;}else{if(search.val().length==0||search.val()===search.attr("placeholder")){removeSelectedFilter("courseSearch");updateFilter();}else{addSelectedFilter(search,true);updateFilter();}}}function updateFilter(e){var search=$("#course-search");if(search.val()===search.attr("placeholder")){search.val("").attr("placeholder",null);}$("#catalogList-filter").submit();}function updateSortParam(e){$("#sort-by").val($(this).val());}function onRemoveFilter(e){var elemName=$(e.target).closest("[data-filter]").attr("data-filter"),$element=$("input[name="+elemName+"]");if($element.attr("name")==="courseSearch"){$("#course-search").val("").prev().fadeIn("100");}else{if(elemName==="allCategories"){$("#all-categories").trigger("click").prop("checked",false);return false;}else{if($element.is(":disabled")){return false;}else{$element.parent().removeClass("selected");if($element.parents(".category-filters").length>0){removeAllFilter();}}}}$(".active-filter-list li[data-filter="+elemName+"]").fadeOut("fast").remove();$element.prop("checked",false);updateFilter();checkContactLocal();}function addMaps(){var filterMapOptions={zoom:7,zoomControl:false};var filterMap=new RCO.Map("filterMap",{containerId:"filterMapContainer",height:136,width:145,mapPreview:true,showRadius:true,mapOptions:filterMapOptions});}function init(){var selectedCategoryId;var zipcode=jQuery("#current-location").attr("data-zipcode");var gcRequest=new RCO.GeocodeRequest(zipcode,addMaps);var search=$("#course-search");Modernizr.load({load:[RCO.util.root+"/js/plugins/infowindow.min.js"]});if(search.val()===search.attr("placeholder")){search.val("").attr("placeholder",null);}RCO.ui.accordion($(".accordion-group"));RCO.ui.tabs.init(tabWrap);prepareQuickDateRange();prepareFilterCheckboxes();prepareRadiusSlider();hideRecentlyViewed("#recently-viewed");hideRecentlyViewed("#recommended-courses");$(".placeholder").live("click",function(){$("#course-search").trigger("focus");});$("#course-search").live("focus blur",function(e){var $this=$(e.target);if(e.type==="focusin"){$this.prev().fadeOut("100");$this.keyup(function(el){if(el.keyCode===13){onSearchSubmit(el);$this.blur();}});}else{if($this.val()<=0){$this.prev().fadeIn("100");$this.unbind("keyup");}else{}}});$("#course-filters").delegate("#show-recent-link","click",showRecentLink).delegate("#show-recommended-link","click",showRecommendedLink).delegate("#radius-slider-handle","drag",updateRadiusSlider).delegate("#radius-slider-bar","click",updateRadiusSlider).delegate("#radius-slider-bar","customRadiusX",updateExpandRadius).delegate("#radius-slider-handle","dragend",updateMapRadius).delegate("#from-date, #to-date","dateChanged",onDateChanged).delegate(".quick-range-list","click",onQuickRangeSelect);$("#submit-search").bind("click",onSearchSubmit);$(".filter-sidebar input:checkbox").live("click",updateFilter);$("#sort-course").live("change",updateSortParam);$(".active-filter-list").delegate("li[data-filter]","click",onRemoveFilter);$(".scrollbar").scrollbar();$(".summary").live("mouseover mouseout",function(e){if(e.type==="mouseout"){hideTooltip($(this));}else{showTooltip($(this));}});$("#accessibletabsnavigation0-0").live("click",function(){currentTab=LIST_TAB;updateResultDesc(RCO.courseData);enableOnlineFilter(true);});$("#accessibletabsnavigation0-1").live("click",function(){currentTab=CALENDAR_TAB;if($("#course-calendar").find("table").length===0){calInit();}else{$("#course-calendar").fullCalendar("refetchEvents");}updateResultDesc(RCO.courseData);enableOnlineFilter(false);});$("#accessibletabsnavigation0-2").live("click",function(){currentTab=MAP_TAB;enableOnlineFilter(false);if(!catalogMapArticle){catalogMapArticle=new RCO.Map("catalogMapArticle",{containerId:"catalog-map-article",height:770,width:770,userInfoBox:true});$(catalogMapArticle).bind("onIbDomReady",function(evt,data){var $mapLocator=$(".map-infobox .locator-modal");if($mapLocator.length>0){RCO.ui.modal.init($mapLocator,{width:992,onLoad:function(){$("#cboxClose").hide();},onComplete:RCO.exec.common.locatorModal});}});$(catalogMapArticle).bind("onIbClick",function(evt,data){var $dataTarget=$(data.target);if($dataTarget.is(".list-view")){evt.preventDefault();var $search=$("#course-search");$search.prev().fadeOut("100");$search.val($dataTarget.attr("data-search"));addSelectedFilter($search,true);updateFilter();RCO.ui.tabs.instance.showAccessibleTabSelector("a[href=#accessibletabscontent0-0]");enableOnlineFilter(false,true);}if($dataTarget.is(".locator-modal")){data.preventDefault();$(".placeholder").prev().fadeOut("100");$dataTarget.trigger("click");}});}updateResultDesc(RCO.courseData);updateMap(RCO.courseData);});$("div.tabs-content").delegate("a.list-view","click",function(evt){evt.preventDefault();RCO.ui.tabs.instance.showAccessibleTabSelector("a[href=#accessibletabscontent0-0]");});catalogList();}init();}},notify:function(messages){var close,hasMessages;if(messages!==undef){hasMessages=(messages.length>0);}if(hasMessages){close=messages.find(".close-link");close.click(function(e){e.preventDefault();$(e.target).closest(messages).hide();});}},progress:{init:function(options){var self=this;self.options=$.extend({container:".donations",showBar:true,barContainer:".donation-goal",showOverlay:true,overlayContainer:".donations-received",showBubble:true,bubbleContainer:".donation-total-wrapper"},options||{});self.getData();},getData:function(){var self=this;var $container=$(self.options.container);var jsonUrl=$container.data("jsonurl");$.getJSON(jsonUrl,function(data,msg){self.progress=data.progress;self.currentAmt="$"+self.progress.current.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");self.percent=(self.progress.current>self.progress.max)?100:self.progress.current/self.progress.max*100;self.percentRemain=100-self.percent;$.each($container,function(idx,progressBar){var alignment=$(progressBar).data("alignment")||"horizontal";var spaceProperty=alignment==="vertical"?"height":"width";var offsetProperty=alignment==="vertical"?"top":"left";if(self.options.showBar&&alignment==="vertical"){self.buildVerticalBar(progressBar);}else{if(self.options.showBar){self.buildHorizontalBar(progressBar);}}if(self.options.showOverlay){self.buildOverlay(progressBar,spaceProperty);}if(self.options.showBubble){self.buildBubble(progressBar,offsetProperty);}});});},buildHorizontalBar:function(context){var self=this;var $container=$(self.options.barContainer,context);var containerWidth=$container.width();var labelList="";var labelWidth1=0;var labelWidthAll=Math.floor(containerWidth/(self.progress.labels.length-1));var labels=self.progress.labels;$.each(labels,function(idx,label){label=label.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");labelList+="<li>$"+label+"</li>";});$container.append(labelList).find("li").css("width",labelWidthAll+"px").end().find("li:first-child").css("width",labelWidth1+"px");},buildVerticalBar:function(context){var self=this;var $container=$(self.options.barContainer,context);var containerHeight=$container.height();var labelList="";var labelHeight=Math.floor(containerHeight/self.progress.labels.length);var labels=[];for(var i=(self.progress.labels.length-1);i>=0;i--){labels.push(self.progress.labels[i]);}$.each(labels,function(idx,label){label=label.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");labelList+="<li>$"+label+"</li>";});$container.append(labelList).find("li").css({height:labelHeight+"px","line-height":labelHeight/10});},buildOverlay:function(context,spaceProperty){var self=this;var $container=$(self.options.barContainer,context);var containerWidth=$container.width();var gutterLeft=parseInt($container.css("paddingLeft"));var gutterRight=parseInt($container.css("paddingRight"));var $bar=$(self.options.overlayContainer,context);var barWidth=containerWidth*self.percent/100;self.trackerWidth=barWidth+gutterLeft;self.trackerRemain=containerWidth-barWidth+gutterRight;$bar.css(spaceProperty,self.trackerWidth+"px").text(self.currentAmt);},buildBubble:function(context,offsetProperty){var self=this;var $container=$(self.options.bubbleContainer,context);$container.css(offsetProperty,self.trackerWidth+"px").show().find(".donation-total p span").text(self.currentAmt);}},slider:function(opts){var $sel=opts.selector?$(opts.selector):$(".slides"),_delay=opts.delay||8200,_anim=opts.animationTime||800,_auto=opts.autoPlay||true;if($sel.find(".panel").length>1){$sel.anythingSlider({autoPlay:_auto,delay:_delay,animationTime:_anim,easing:"easeOutQuart",onInitialized:function(evt,slider){slider.$el.css({overflow:"visible"});}});}},validate:{data:{password:{rules:{required:true,minlength:6},messages:{required:"Password is required.",minlength:"Passwords must contain at least 6 characters, including 1 number."}},passwordConfirm:{rules:{required:true,passwordConfirm:true},messages:{required:"Confirm password is required.",passwordConfirm:"Confirm password must match password."}},email:{rules:{required:true,email:true},messages:{required:"Email is required.",email:"Email must be in email format."}},cons_email:{rules:{required:true,email:true},messages:{required:"Email is required.",email:"Email must be in email format."}},recipientEmail:{rules:{required:true,multipleEmail:true,maxlength:250},messages:{required:"Recipient Email is required.",multipleEmail:"Email must be in email format.",maxlength:"Recipient Email field cannot have more than 250 characters"}},ecardSubject:{rules:{required:true},messages:{required:"E-Card Subject is required."}},ecardMessage:{rules:{required:true},messages:{required:"E-Card Message is required."}},fromDate:{rules:{required:true,date:true},messages:{required:"Send Date is required.",date:'Date must be in "mm/dd/yy" format.'}},recipientName:{rules:{required:true},messages:{required:"Recipient name is required."}},addressLine1:{rules:{required:true},messages:{required:"Address is required."}},city:{rules:{required:true},messages:{required:"City is required."}},state:{rules:{required:true},messages:{required:"State is required."}},postalCode:{rules:{required:true,digits:true},messages:{required:"Postal code is required.",digits:"Postal code must only contain digits."}},country:{rules:{required:true},messages:{required:"Country is required."}},printMessage:{rules:{required:true},messages:{required:"Print Message is required."}},recipientFirstName:{rules:{required:true},messages:{required:"Recipient First Name is required."}},recipientLastName:{rules:{required:true},messages:{required:"Recipient Last Name is required."}},fromDatePrintCard:{rules:{required:true,date:true},messages:{required:"Send Date is required.",date:'Date must be in "mm/dd/yy" format.'}},personalMessage:{rules:{required:true,maxlength:80},messages:{required:"Personal Message is required.",maxlength:"Personal Message field cannot have more than 80 characters"}},closing:{rules:{required:true},messages:{required:"Closing is required."}},donorFirstName:{rules:{required:true},messages:{required:"Donor First Name is required."}},donorLastName:{rules:{required:true},messages:{required:"Donor Last Name is required."}},messageSignature:{rules:{required:true},messages:{required:"Signature is required."}},donationTributeName:{rules:{required:true},messages:{required:"Honoree or Event Name is required."}},tributeName:{rules:{required:"#donation-tribute:checked"},messages:{required:"Honoree or Event Name is required."}}},methods:(function(){$.validator.addMethod("passwordConfirm",function(value,element){var form=$(element).closest("form"),password=form.find('input[name="password"]'),passwordValue=password.val(),check=false;if(value===passwordValue){check=true;}return this.optional(element)||check;},"Confirm Password must match Password.");$.validator.addMethod("cardNumber",function(value,element){return this.optional(element)||/^5[1-5][0-9]{14}$||^3[47][0-9]{13}$||^4[0-9]{12}(?:[0-9]{3})?$||^6(?:011|5[0-9]{2})[0-9]{12}$/.test(value);},"Please recheck your credit card number.");$.validator.addMethod("multipleEmail",function(value,element){var emailArr=value.split(","),valid=true,i;for(i=0;i<emailArr.length;i++){var emailItem=emailArr[i].replace(/^\s+/,"").replace(/\s+$/,"");if(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(emailItem)===false){valid=false;break;}}return this.optional(element)||valid;},"Please recheck your credit card number.");}()),init:function(form,options){var allFields=form.find("input, select, textarea"),defaultOptions,errorHandler,hideClass="hide",invalidWrapClass="invalid-field-wrap",messages={},inlineClass="invalid-message",inlineElement=$("<span/>",{"class":inlineClass}),parentModal=form.closest("#colorbox"),inModal=parentModal.length>0,rules={},validator;(function buildData(){var allData=RCO.ui.validate.data;allFields.each(function(){var field=$(this),fieldName=field.attr("name"),data=allData[fieldName],thisRules={},thisMessages={};if(data===undef){return true;}thisRules=data.rules;thisMessages=data.messages;if(thisRules!==undef){rules[fieldName]=thisRules;}if(thisMessages!==undef){messages[fieldName]=thisMessages;}});}());errorHandler=function(errorMap,errorList){var that=this,errors=errorList,errorsLength=errors.length,successes=that.successList,successesLength=successes.length,curError,errorElement,errorId,errorFieldWrap,label,errorMessage,curSuccess,successElement,successFieldWrap,i;for(i=0;i<errorsLength;i+=1){curError=errors[i];errorElement=form.find(curError.element);errorId=errorElement.attr("id");errorFieldWrap=errorElement.closest(".field-wrap");label=errorFieldWrap.find('label[for="'+errorId+'"]');errorMessage=label.find("."+inlineClass);if(errorMessage.length>0){errorMessage.text(curError.message);}else{errorMessage=inlineElement.clone();errorMessage.text(curError.message).appendTo(label);}errorFieldWrap.addClass(invalidWrapClass);}for(i=0;i<successesLength;i+=1){curSuccess=successes[i];successElement=form.find(curSuccess);successFieldWrap=successElement.closest(".field-wrap");successFieldWrap.removeClass(invalidWrapClass);}this.defaultShowErrors();if(inModal){RCO.ui.modal.resize();}};defaultOptions={debug:false,errorClass:"invalid",errorContainer:".invalid-box",errorLabelContainer:".invalid-box ul",errorElement:"span",ignore:".hide input, .hide select, .hide textarea",messages:messages,rules:rules,showErrors:errorHandler,submitHandler:function(thisForm){thisForm.submit();return false;},validClass:"valid",wrapper:"li"};if(inModal){defaultOptions.onkeyup=false;defaultOptions.onfocusout=false;}validator=form.validate($.extend(defaultOptions,options));return{validator:validator};}},polyfill:{fluidimages:function(){},json:function(){}},geolocator:{updateLocation:function(zip){$.ajax({type:"POST",url:RCO.util.root+"/ajax/updateLocation.jsp",data:"zipcode="+zip,success:function(data){if($("#colorbox").is(":visible")){$("#cboxClose").trigger("click");}$("#current-location").attr("data-ziperror","false");}});},updateLocalChapter:function(localChapterInfo){var requiredProps,localChapter,chapterName,chapterStreet1,chapterStreet2,chapterMergedStreet,chapterCity,chapterState,chapterZip,chapterPhone;if(localChapterInfo&&localChapterInfo.hasOwnProperty("localChapter")){requiredProps=["name","href","address","chapterLinks"];var hasRequiredFields=true;$.each(requiredProps,function(i,prop){if(!localChapterInfo.localChapter[prop]){hasRequiredFields=false;return false;}});if(!hasRequiredFields){return;}localChapter=localChapterInfo.localChapter;chapterName=localChapter.name;chapterStreet1=localChapter.address.street1;chapterStreet2=localChapter.address.street2;chapterMergedStreet=chapterStreet1;chapterCity=localChapter.address.city;chapterState=localChapter.address.state;chapterZip=localChapter.address.zip;chapterPhone=localChapter.address.phone;if(chapterStreet2){chapterMergedStreet=chapterStreet1+"<br/ >"+chapterStreet2;}$(".contact-local").each(function(){var element=$(this),localInfo=element.find(".local-contact-info"),chapterText=localInfo.find("h1"),localPhone=localInfo.children(".local-phone");chapterText.html(chapterName);localPhone.html(chapterPhone);});$('[data-action="locationUpdate"]').each(function(){var element=$(this);element.find(".chapter-name").html(chapterName);element.find(".chapter-street").html(chapterMergedStreet);element.find(".chapter-city").html(chapterCity);element.find(".chapter-state").html(chapterState);element.find(".chapter-zip").html(chapterZip);element.find(".chapter-phone").html(chapterPhone);});$('[data-action="contactLocation"]').each(function(){var element=$(this),mapLink=element.find(".map-link"),linkNode=mapLink.get(0).nodeName,newLink="<"+linkNode+' class="'+mapLink.attr("class")+'">'+mapLink.html()+"</"+linkNode+">";element.html("American Red Cross<br/>"+chapterName+"<br/>"+chapterMergedStreet+"<br/>"+chapterCity+", "+chapterState+" "+chapterZip+"<br/>"+newLink);});}}},social:{init:function(){var social=this;social.providers=["facebook","twitter","email"];social.flickrFeed=$("#flickr-feed");social.youtubeFeed=$("#youtube-feed");social.defaults={flickr:RCO.socialConfig.flickr,youtube:RCO.socialConfig.youtube};social.confs=RCO.socialConfig.gigya;social.handlers();social.configureShareBar();if(social.flickrFeed.length){social.showFlickrFeed();}if(social.youtubeFeed.length){social.configureYoutubeFeed();}},handlers:function(){var social=this;$("a.social-share").live("click",function(event){social.showSocialShare(event);});$(document).bind("shareBar:render",function(){social.configureShareBar();});},showSocialShare:function(e){e.preventDefault();var social=this,$elem=$(e.target).closest("a"),detail=new gigya.socialize.UserAction(),params={};if($elem.data("image-src")){detail.addMediaItem({type:"image",src:$elem.data("image-src"),href:$elem.data("image-href")});}if($elem.data("action-link-title")&&$elem.data("action-link-href")){detail.addActionLink($elem.data("action-link-title"),$elem.data("action-link-href"));}if($elem.parent().prop("class")==="content-box-inner"){detail.setTitle($elem.data("title")||"");}else{detail.setTitle($('meta[property="og:title"]').prop("content")||$elem.data("title"));}detail.setSubtitle($elem.data("subtitle")||"");detail.setDescription($elem.data("description")||"");if($elem.data("link-back-href")){detail.setLinkBack($elem.data("link-back-href"));}params={cid:$elem.data("cid")||"",userAction:detail,grayedOutScreenOpacity:35,showMoreButton:$elem.data("show-more-button")||false,showEmailButton:$elem.data("show-email-button")||true,facebookDialogType:"share"};gigya.socialize.showShareUI(social.confs,params);},configureShareBar:function(){var social=this,shareBars=$(".social-bar[data-providers]:not([id])"),params={};shareBars.each(function(idx,shareBar){params=social.setShareParams(idx,$(shareBar));gigya.socialize.showShareBarUI(social.confs,params);$(shareBar).css("visibility","visible");});},setShareParams:function(idx,shareBar){var social=this,detail=new gigya.socialize.UserAction(),params={};shareBar.attr("id","share-bar-"+idx);if(shareBar.data("image-src")){detail.addMediaItem({type:"image",src:shareBar.data("image-src"),href:shareBar.data("image-href")});}if(shareBar.data("action-link-title")&&shareBar.data("action-link-href")){detail.addActionLink(shareBar.data("action-link-title"),shareBar.data("action-link-href"));}if(shareBar.parent().prop("class")==="content-box-inner"){detail.setTitle(shareBar.data("title")||"");}else{detail.setTitle($('meta[property="og:title"]').prop("content")||shareBar.data("title"));}detail.setSubtitle(shareBar.data("subtitle")||"");detail.setDescription(shareBar.data("description")||"");if(shareBar.data("link-back-href")){detail.setLinkBack(shareBar.data("link-back-href"));}params={shareButtons:[],containerID:shareBar.attr("id"),cid:shareBar.data("cid")||"",userAction:detail,noButtonBorders:true,iconsOnly:shareBar.data("labels").length?false:true,grayedOutScreenOpacity:35,facebookDialogType:"share"};params.onLoad=params.iconsOnly?$.noop:function(){social.updateShareLabels(shareBar,idx);};$.each(social.providers,function(idxBtn,provider){var icons=shareBar.data("type")==="circle-social"?{up:"circle-"+provider,over:"circle-"+provider+"-hover"}:{up:"social-"+provider+"-gray",over:"social-"+provider+"-color"};if(shareBar.data("providers").indexOf(provider)>-1){params.shareButtons.push({provider:provider,iconImgUp:RCO.util.root+"/images/sprite/icon/"+icons.up+".png",iconImgOver:RCO.util.root+"/images/sprite/icon/"+icons.over+".png",enableCount:false});}});return params;},updateShareLabels:function(shareBar,idx){var social=this;$(".gig-button-container",shareBar).each(function(idxBtn,button){$("#share-bar-"+idx+"-reaction"+idxBtn+"-text .gig-button-text",button).text(shareBar.data("labels")[idxBtn]);});},showFlickrFeed:function(){var social=this,account=social.flickrFeed.data("account")||social.defaults.flickr.account,count=social.flickrFeed.data("count")||social.defaults.flickr.count;social.flickrFeed.jflickrfeed({limit:count,qstrings:{id:account},itemTemplate:'<li><a href="{{image_b}}" title="{{title}}"><img src="{{image_s}}" alt="{{title}}" /></a></li>'},function(){RCO.ui.modal.init($("a","#flickr-feed"),{hideClose:false});});},configureYoutubeFeed:function(){var social=this,account=social.youtubeFeed.data("account")||social.defaults.youtube.account,count=social.youtubeFeed.data("count")||social.defaults.youtube.count;$.getJSON("https://gdata.youtube.com/feeds/api/users/"+account+"/uploads?callback=?&v=2&max-results="+count+"&alt=json",function(data){social.buildYoutubeFeed(data);});},buildYoutubeFeed:function(data){var social=this,elem="";$.each(data.feed.entry,function(idx,video){var className=idx===0?"first":"";elem+='<li class="'+className+'"><div class="box-image"><a href="'+video.media$group.media$player.url+'"><img alt="" src="'+video.media$group.media$thumbnail[0].url+'" width="94" /></a></div><div class="title"><a href="'+video.media$group.media$player.url+'">'+video.media$group.media$title.$t+"</a></div></li>";});social.youtubeFeed.append(elem);}},confirmNavHandler:{currentElement:null,popup:function(evt,source){if(!this.isAllowedNavigation(source)){this.currentElement=source;evt.preventDefault();var modalErrorObj=jQuery("#qdCancelDialogTrigger");if(modalErrorObj.length>0){modalErrorObj[0].click();}}},isAllowedNavigation:function(clickSource){if($(clickSource).is("form")){return false;}var isAQDElement=jQuery.contains(jQuery(".quickdonate-layout").get(0),jQuery(clickSource).get(0))||$(clickSource).attr("class").indexOf("qdLink")>=0;if(isAQDElement){return true;}var hrefOfAnchor=jQuery(clickSource).attr("href");if(hrefOfAnchor&&hrefOfAnchor=="#"){return true;}var styleOfAnchor=jQuery(clickSource).attr("class");if(styleOfAnchor&&styleOfAnchor.indexOf("modal")>=0){return true;}return false;},registerNavigatableElements:function(){var anchorFields=jQuery("a");anchorFields.bind("click",null,function(evt){RCO.ui.confirmNavHandler.popup(evt,this);});var seacrhFormEl=$("form.search-form");if(seacrhFormEl){seacrhFormEl.bind("submit",null,function(evt){RCO.ui.confirmNavHandler.popup(evt,this);});}RCO.ui.modal.init($("#qdCancelDialogTrigger"),{width:650});},init:function(){if(window.isQuickDonateContext){this.registerNavigatableElements();}},continueNavigation:function(){var sourceElement=$(this.currentElement);if(sourceElement.is("a")){window.location.href=sourceElement.attr("href");}else{if(sourceElement.is("form")){sourceElement.get(0).submit();}}this.currentElement=null;}}};RCO.load=(function(){var B=RCO.util.browser,r=RCO.util.root,js=r+"/js/",css=r+"/css/",tests=[{test:B.isIElt8||B.isIE8compat||B.isIE9compat7,yep:js+"polyfills/fluidimages.js",callback:RCO.ui.polyfill.fluidimages},{test:window.JSON,nope:js+"polyfills/json2.js",callback:RCO.ui.polyfill.json}];return tests;}());RCO.Map=function(id,opts){var self=this;var _subscribers=this.constructor.subscribers;var subscribe=function(){_subscribers[id]=self;self.options.mapId=id;self.map=self.render(self.options);self.publish();};self.publish=function(){self.clearMarkers();self.setCenter(RCO.GeocodeRequest.userLatLng);if(self.options.showRadius){self.setRadius({center:RCO.GeocodeRequest.userLatLng});}var image=new google.maps.MarkerImage("//maps.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(15,32));var shadow=new google.maps.MarkerImage("//maps.google.com/mapfiles/shadow50.png",new google.maps.Size(37,34),new google.maps.Point(0,0),new google.maps.Point(10,34));var shape={type:"poly",coord:[6,0,24,0,24,32,6,32,6,0]};if(this.options.userInfoBox){var data={isUser:true};var ibOpts={pixelOffset:new google.maps.Size(-35,-130),infoBoxClearance:new google.maps.Size(1,1),boxStyle:{opacity:1,width:"110px",height:"50px",padding:"10px 10px 20px 20px"}};self.addMarker({position:RCO.GeocodeRequest.userLatLng,shadow:shadow,icon:image,shape:shape},data,ibOpts);}else{self.addMarker({position:RCO.GeocodeRequest.userLatLng,shadow:shadow,icon:image,shape:shape});}return self;};self.revoke=function(){delete _subscribers[id];self=null;return self;};self.id=id;self.options=new RCO.Map.Options(opts);self.markers=[];self.infoBoxes=[];RCO.util.loadMapApi.load(subscribe);};RCO.Map.subscribers={};RCO.Map.Options=function(opts){var defaults={mapId:"mapcanvas",containerId:"map",mapPreview:false,height:500,width:500,mapOptions:{center:RCO.GeocodeRequest.userLatLng,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,mapTypeOptions:{style:google.maps.MapTypeControlStyle.DEFAULT},scaleControl:false,streetViewControl:false,panControl:false,zoom:13,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE}},showRadius:false,radiusOptions:{map:null,center:RCO.GeocodeRequest.userLatLng,fillColor:"#ED1B2E",fillOpacity:0.6,radius:16093.44,strokeWeight:0},customMarker:false,markerOptions:{map:null,position:RCO.GeocodeRequest.userLatLng,visible:true},userInfoBox:false};var mOpts=$.extend(true,defaults,opts);return mOpts;};RCO.Map.prototype.render=function(opts){var map;var mapContainer=$("#"+opts.containerId);var mapcanvas=$("<div>",{id:opts.mapId,css:{height:opts.height,width:opts.width}});mapContainer.append(mapcanvas);map=new google.maps.Map(document.getElementById(opts.mapId),opts.mapOptions);return map;};RCO.Map.prototype.update=function(opts,publish){var self=this;var subscribers=RCO.Map.subscribers;var id;self.options=$.extend(true,self.options,opts);if(publish){for(id in subscribers){if(subscribers.hasOwnProperty(id)){subscribers[id].publish();}}}return this;};RCO.Map.prototype.setCenter=function(latLng,latLngBounds){if(RCO.GeocodeRequest.userLatLng!==undef){var map=this.map;if(latLngBounds){latLngBounds.extend(latLng);map.setCenter(latLngBounds.getCenter());map.fitBounds(latLngBounds);}else{map.setCenter(latLng);}}};RCO.Map.prototype.addMarker=function(opts,data,ibOpts){var markerOptions=this.options.markerOptions;var map=this.map;opts.map=map;var marker=new google.maps.Marker(opts);this.markers.push(marker);if(data){if(ibOpts){this.attachInfoBox(marker,data,ibOpts);}else{this.attachInfoBox(marker,data);}}return self.markers;};RCO.Map.prototype.attachInfoBox=function(marker,data,ibOpts){var self=this;var defaultIbOpts={content:"boxContainer",disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-170,-320),zIndex:null,boxClass:"map-infobox",boxStyle:{opacity:1,height:"auto",width:"335px"},closeBoxMargin:"2px",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};if(ibOpts){$.extend(true,defaultIbOpts,ibOpts);}$.ajax({url:RCO.util.root+"/ajax/course-infobox-tmpl.jsp",dataType:"html",cache:false,success:function(template){var tmplHtml=$.tmpl(template,data),boxText=document.createElement("div"),boxContainer=document.createElement("div"),ib,modalLink,modalHref;boxText.innerHTML=tmplHtml.html();modalLink=$(boxText).find(".locator-modal");modalHref=RCO.util.root+modalLink.attr("href");modalLink.attr("href",modalHref);boxContainer.appendChild(boxText);defaultIbOpts.content=boxContainer;ib=new InfoBox(defaultIbOpts);self.infoBoxes.push(ib);google.maps.event.addListener(ib,"domready",function(evt){$(self).trigger("onIbDomReady");$(".map-infobox").one("click",function(evt){$(self).trigger("onIbClick",evt);});});google.maps.event.addListener(marker,"click",function(e){ib.open(self.map,this);});}});};RCO.Map.prototype.clearMarkers=function(){var markers=this.markers;while(markers.length>0){markers.pop().setMap(null);}this.clearInfoBoxes();return markers;};RCO.Map.prototype.clearInfoBoxes=function(){var infoBoxes=this.infoBoxes;while(infoBoxes.length>0){infoBoxes.pop().setMap(null);}return infoBoxes;};RCO.Map.prototype.setRadius=function(opts,radiusInMiles){var radiusOptions=this.options.radiusOptions;var map=this.map;var bounds;radiusOptions.map=map;radiusOptions=$.extend(radiusOptions,opts);if(!radiusInMiles){radiusInMiles=$("#radius-slider").data("radius");}radiusOptions.radius=radiusInMiles*1609.344;this.circle=this.circle||new google.maps.Circle(radiusOptions);this.circle.setCenter(RCO.GeocodeRequest.userLatLng);this.circle.setRadius(radiusOptions.radius);bounds=this.circle.getBounds();map.fitBounds(bounds);return this.circle;};RCO.Map.prototype.isVisible=function(){return($("#"+this.id).is(":visible"));};RCO.GeocodeRequest=function(address,callback,save,force){var _save=typeof save==="boolean"?save:true;var _force=typeof force==="boolean"?force:false;var self=this;var callbackQueue=this.constructor.callbackQueue;var status=this.constructor.currentStatus;var geocoder=this.constructor.geocoder;var history=this.constructor.history;function makeRequest(){if(address&&!address.match(/[\d]{5}/)){invalidZIPCode();return;}if(typeof callback==="function"){callbackQueue.push(callback);}if(status==RCO.GeocodeRequest.READY){if(history.hasOwnProperty(address)&&!_force){receiveRequest(history[address].results,google.maps.GeocoderStatus.OK,false);}else{if(typeof geocoder.geocode==="undefined"){geocoder=new google.maps.Geocoder();}status=RCO.GeocodeRequest.LOADING;geocoder.geocode({address:address},receiveRequest);}}}function receiveRequest(results,status,isGoogle){if(status===google.maps.GeocoderStatus.OK){if(typeof isGoogle==="undefined"){history[address]={};history[address].results=results;history[address].userLocation=setUserLocation(results);history[address].userLatLng=setUserLatLng(results);}if(_save){RCO.GeocodeRequest.userLocation=history[address].userLocation;RCO.GeocodeRequest.userLatLng=history[address].userLatLng;}while(callbackQueue.length>0){callbackQueue.pop()();}status=RCO.GeocodeRequest.READY;}else{}}function invalidZIPCode(){if(jQuery(".address-info > p.modalerror").length==0){jQuery(".address-info").append('<p class="modalerror">'+jQuery("#invalidZipMessageHiddenDiv").html()+"</p>");jQuery.fn.colorbox.resize();}}function setUserLocation(geocoderResult){var location;var cityPossibleKeys=["locality","sublocality","administrative_area_level_3","political"];location={latitude:geocoderResult[0].geometry.location.lat(),longitude:geocoderResult[0].geometry.location.lng(),zip:self.parseGeocoderResults("postal_code",geocoderResult[0].address_components,true),city:"",state:self.parseGeocoderResults("administrative_area_level_1",geocoderResult[0].address_components,false)};for(var i=0,len=cityPossibleKeys.length;i<len;i++){if(location.city.length>0){break;}else{location.city=self.parseGeocoderResults(cityPossibleKeys[i],geocoderResult[0].address_components,true);}}return location;}function setUserLatLng(geocoderResult){return geocoderResult[0].geometry.location;}RCO.util.loadMapApi.load(makeRequest);};RCO.GeocodeRequest.callbackQueue=[];RCO.GeocodeRequest.geocoder={};RCO.GeocodeRequest.READY="ready";RCO.GeocodeRequest.LOADING="loading";RCO.GeocodeRequest.currentStatus=RCO.GeocodeRequest.READY;RCO.GeocodeRequest.history={};RCO.GeocodeRequest.userLocation={};RCO.GeocodeRequest.userLatLng={};RCO.GeocodeRequest.prototype.parseGeocoderResults=function(type,results,useLongName){var i,l,j,l2;for(i=0,l=results.length;i<l;i+=1){for(j=0,l2=results[i].types.length;j<l2;j+=1){if(results[i].types[j]===type){if(useLongName){return results[i].long_name;}else{return results[i].short_name;}}}}return"";};RCO.GeocodeRequest.prototype.updateProfileLocationLinks=function(){var userLocation=RCO.GeocodeRequest.userLocation,locatorLink=$("#current-location"),coursesLocation=$(".current-address"),coursesEditLocation=$("#edit-location"),mapLink=$("a",".course-catalog-tab .map-link"),locationFilter=$(".location-filter-2"),aspotLocation=$(".offered-location"),newsEventsLocation=$(".module-content",".location-filter"),localLocation=$('.local-location, [data-action="locationUpdate"]'),contactLocation=$('[data-action="contactLocation"]');function appendNewZip(element,zip){var href,hrefSplit,params="";if(element){if(element.length>0){href=element.attr("href");hrefSplit=href.split("?");href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){if(key!=="zipcode"){params=params+"&"+key+"="+value;}});return element.attr("href",hrefSplit[0]+"?zipcode="+zip+params);}}}locatorLink.text(userLocation.city+", "+userLocation.state+" ("+userLocation.zip+")");coursesLocation.text(userLocation.city+", "+userLocation.state+" "+userLocation.zip);$("#user-location").val(userLocation.zip);appendNewZip(locatorLink,userLocation.zip);appendNewZip(coursesEditLocation,userLocation.zip);mapLink.each(function(){var self=$(this);self.text("Edit");appendNewZip(self,userLocation.zip);});locationFilter.each(function(){var self=$(this),link=self.children(".map-link").clone(true,true);self.html("Your location: "+userLocation.city+", "+userLocation.state).append(link);appendNewZip(self.find(".locator-modal"),userLocation.zip);});aspotLocation.each(function(){var self=$(this);self.find("> location").text(userLocation.city+", "+userLocation.state);appendNewZip(self.find("> a"),userLocation.zip);});newsEventsLocation.each(function(){var self=$(this);self.find("p").text(userLocation.city+", "+userLocation.state+" "+userLocation.zip);appendNewZip(self.find("a"),userLocation.zip);});localLocation.each(function(){var self=$(this);self.find(".city").text(userLocation.city);self.find(".state").text(userLocation.state);self.find(".zip").text(userLocation.zip);appendNewZip(self.find(".locator-modal"),userLocation.zip);});contactLocation.each(function(){appendNewZip($(this).find(".locator-modal"),userLocation.zip);});};RCO.Geocode=function(zipcode,callback){var Geocode=this;Geocode.location={};Geocode.lat="";Geocode.lng="";Geocode.city="";Geocode.state="";Geocode.valid=false;function makeRequest(){if(zipcode&&zipcode.match(/[\d]{5}/)){$.ajax({method:"POST",url:RCO.util.root+"/ajax/geocodeZip.jsp",data:"zipcode="+zipcode,success:function(data){processRequest(data);}});}else{invalidZIPCode();return;}}function processRequest(data){var requiredProps,geocodeData,address,loc;Geocode.valid=data.zipCode.valid;if(Geocode.valid=="true"){requiredProps=["valid"];$.each(requiredProps,function(i,prop){if(!data.zipCode[prop]){return;}});geocodeData=data.zipCode;address=geocodeData.address;Geocode.state=geocodeData.address.state;Geocode.city=geocodeData.address.city;loc=geocodeData.location;Geocode.lat=loc.lat;Geocode.lng=loc.lng;Geocode.location={latitude:Geocode.lat,longitude:Geocode.lng,zip:zipcode,city:Geocode.city,state:Geocode.state};updateProfileLocationLinks();RCO.cookie.setCookie("locality",zipcode,30);}else{invalidZIPCode();}callback(Geocode.valid);}function invalidZIPCode(){if(jQuery(".address-info > p.modalerror").length==0){jQuery(".address-info").append('<p class="modalerror">'+jQuery("#invalidZipMessageHiddenDiv").html()+"</p>");jQuery.fn.colorbox.resize();}}function updateProfileLocationLinks(){var userLocation=Geocode.location,locatorLink=$("#current-location"),coursesLocation=$(".current-address"),coursesEditLocation=$("#edit-location"),mapLink=$("a",".course-catalog-tab .map-link"),locationFilter=$(".location-filter-2"),aspotLocation=$(".offered-location"),newsEventsLocation=$(".module-content",".location-filter"),localLocation=$('.local-location, [data-action="locationUpdate"]'),contactLocation=$('[data-action="contactLocation"]');locatorLink.text(userLocation.city+", "+userLocation.state+" ("+userLocation.zip+")");coursesLocation.text(userLocation.city+", "+userLocation.state+" "+userLocation.zip);$("#user-location").val(userLocation.zip);var $chkExdMiles=$("#chkExdMiles"),$miles=$("#miles");if($chkExdMiles!=undefined&&$miles!=undefined&&$chkExdMiles.val()==="true"){$("#miles").val("25");}appendNewZip(locatorLink,userLocation.zip);appendNewZip(coursesEditLocation,userLocation.zip);mapLink.each(function(){var self=$(this);self.text("Edit");appendNewZip(self,userLocation.zip);});locationFilter.each(function(){var self=$(this),link=self.children(".map-link").clone(true,true);self.html("Your location: "+userLocation.city+", "+userLocation.state).append(link);appendNewZip(self.find(".locator-modal"),userLocation.zip);});aspotLocation.each(function(){var self=$(this);self.find("> location").text(userLocation.city+", "+userLocation.state);appendNewZip(self.find("> a"),userLocation.zip);});newsEventsLocation.each(function(){var self=$(this);self.find("p").text(userLocation.city+", "+userLocation.state+" "+userLocation.zip);appendNewZip(self.find("a"),userLocation.zip);});localLocation.each(function(){var self=$(this);self.find(".city").text(userLocation.city);self.find(".state").text(userLocation.state);self.find(".zip").text(userLocation.zip);appendNewZip(self.find(".locator-modal"),userLocation.zip);});contactLocation.each(function(){appendNewZip($(this).find(".locator-modal"),userLocation.zip);});}function appendNewZip(element,zip){var href,hrefSplit,params="";if(element){if(element.length>0){href=element.attr("href");hrefSplit=href.split("?");href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){if(key!=="zipcode"){params=params+"&"+key+"="+value;}});return element.attr("href",hrefSplit[0]+"?zipcode="+zip+params);}}}makeRequest();};RCO.gMap=function(canvasID,opts){var gMap=this;gMap.map="";function initialize(){gMap.map=new google.maps.Map(document.getElementById(canvasID),opts);}RCO.util.loadMapApi.load(initialize);};RCO.gMap.prototype.addMarker=function(lat,lng,title,icon){var latlng=new google.maps.LatLng(lat,lng);var iconUrl=(icon.substr(0,4)==="http")?icon:"http://www.google.com/mapfiles/marker"+icon+".png";var marker=new google.maps.Marker({position:latlng,map:this.map,title:title,icon:iconUrl});};return(window.RCO=RCO);})(this,this.document,this.jQuery);