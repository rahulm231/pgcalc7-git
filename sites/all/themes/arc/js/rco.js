(function(window,document,$,undef){var RCO=window.RCO||{},Modernizr=window.Modernizr,swfobject=window.swfobject,FORMALIZE=window.FORMALIZE,courseData=RCO.courseData;ko.o=ko.observable;ko.c=ko.computed;ko.oa=ko.observableArray;ko.bindingHandlers.valueWithInit={init:function(element,valueAccessor,allBindingsAccessor,data,context){var property=valueAccessor(),value=element.value;if(!ko.isWriteableObservable(data[property])){data[property]=ko.observable();}data[property](value);ko.applyBindingsToNode(element,{value:data[property]},context);}};$.noConflict();if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0),j=this.length;i<j;i++){if(this[i]===obj){return i;}}return -1;};}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}if(!Modernizr.input.placeholder){$(window).load(function(){$("[placeholder]").focus(function(){var input=$(this);if(input.val()==input.attr("placeholder")){input.val("");input.removeClass("placeholder");}}).blur(function(){var input=$(this);if(input.val()==""||input.val()==input.attr("placeholder")){input.addClass("placeholder");input.val(input.attr("placeholder"));}}).blur();$("[placeholder]").parents("form").submit(function(){$(this).find("[placeholder]").each(function(){var input=$(this);if(input.val()==input.attr("placeholder")){input.val("");}});});});}RCO.exec={common:{init:function(){var actionShadow,actionWidth,gcObj,gcRequest,hdr=$("#hdr"),zipcode=$("#current-location").attr("data-zipcode");function hideClose(){$("#cboxClose").hide();}var savedZipcode;if(isAnonymousUser){if(varProfileZipChanged==false){savedZipcode=RCO.cookie.getCookie("locality");}if(savedZipcode===undef){gcRequest=new RCO.Geocode(zipcode,function(){});}else{gcRequest=new RCO.Geocode(savedZipcode,function(){});}}else{gcRequest=new RCO.Geocode(zipcode,function(){});}var signInForm=$("#newsletter-signup, .sign-up-bspot form, .email-signup form");FORMALIZE.go();RCO.ui.tabs.init();RCO.ui.modal.init($(".locator-modal"),{width:992,onLoad:hideClose,onComplete:RCO.exec.common.locatorModal});RCO.ui.modal.init($(".overlayImage"),{width:false,onComplete:function(){RCO.ui.modal.resize();}});RCO.ui.modal.init($(".signin-modal"),{width:430,onComplete:RCO.exec.common.signInModal.init});RCO.exec.common.clickToChatCall.init();RCO.ui.social.init();RCO.ui.simpleDropDown(hdr.find(".logout"));RCO.ui.simpleDropDown(hdr.find(".filter-events"));signInForm.each(function(){RCO.ui.form.signUpForm($(this));});actionShadow=$(".action-shadow");if(actionShadow.length>0){actionShadow.each(function(){$(this).width($(this).children("action").width());});}$.ajaxSetup({dataType:"json",error:function(jqXHR,textStatus,errorThrown){},type:"GET"});RCO.evt.preventDefault();RCO.evt.cleanup(function(){if($("#current-location").attr("data-ziperror")==="true"){$("#current-location").click();}});RCO.ui.modal.init($(".tribute-error-modal"),{width:430,onComplete:RCO.exec.common.tributeErrorModal.init});if($("[testModal]").length>0){$(".tribute-error-modal").click();}RCO.exec.countryStateDropDown.init();RCO.exec.common.ajaxSnapshotForm.init();RCO.exec.donate.donationLightBox.init();RCO.exec.donate.donateFormValidator.init();RCO.exec.donate.urlParamsUtil.init();$(".primary-nav-link").click(function(){var gaCat=$(this).attr("data-ga-category");var gaAction=$(this).attr("data-ga-action");gaEvent(gaCat,gaAction);});RCO.exec.common.clickToChatPrompt.init();},locatorModal:function(){var map;var markerLabels=["A","B","C","D","E","F","G","H","I","J"];var zipCodeField=$("input#zipcode");function requestChapter(){var zipcode=$("#zipcode").val(),chapters;if($("#zipcode-error").length>0){return;}$.ajax({method:"POST",url:RCO.util.root+"/ajax/chapterLocator.jsp",data:"zipcode="+zipcode,success:function(data){processLocalData(data);var $chapterInfoTmpl=$("#chapter-info-tmpl");try{chapters=$.tmpl($chapterInfoTmpl,data);}catch(err){data.localChapter=false;chapters=$.tmpl($chapterInfoTmpl,data);}$(".right-content").find("#chapter-locations").remove().end().append(chapters);var i=0;$("#chapter-locations ul li.arrow-bg").each(function(){var markerURL="http://www.google.com/mapfiles/marker"+markerLabels[i]+".png";$(this).css("background-image","url("+markerURL+")");i++;});$.colorbox.resize();}});}function processLocalData(localData){var userLocation,userLat,userLng,markers=[],localChapter,localChapterMarker,bloodRegion,bloodRegionMarker,safLocations;userLocation=localData.zipCode;userLat=userLocation.location.lat;userLng=userLocation.location.lng;localChapter=localData.localChapter;if(localChapter.location&&localChapter.name){localChapterMarker=[localChapter.location.lat,localChapter.location.lng,localChapter.name];markers.push(localChapterMarker);}if(localData.safLocations.length>0){safLocations=localData.safLocations;for(var i=0;i<safLocations.length;i++){var safLocation=safLocations[i];var safLocationMarker=[safLocation.location.lat,safLocation.location.lng,safLocation.name];markers.push(safLocationMarker);}}bloodRegion=localData.bloodRegion;if(bloodRegion.location&&bloodRegion.name){bloodRegionMarker=[bloodRegion.location.lat,bloodRegion.location.lng,bloodRegion.name];markers.push(bloodRegionMarker);}RCO.ui.geolocator.updateLocalChapter(localData);$("#modal .local-address").html(userLocation.address.city+", "+userLocation.address.state);var mapOptions={center:new google.maps.LatLng(userLat,userLng),zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,mapTypeOptions:{style:google.maps.MapTypeControlStyle.DEFAULT},scaleControl:false,streetViewControl:false,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE}};map=new RCO.gMap("map",mapOptions);var bounds=new google.maps.LatLngBounds();var userLoc=new google.maps.LatLng(userLat,userLng);bounds.extend(userLoc);for(var i=0;i<markers.length;i++){var marker=markers[i];map.addMarker(marker[0],marker[1],marker[2],markerLabels[i]);bounds.extend(new google.maps.LatLng(marker[0],marker[1]));}map.addMarker(userLat,userLng,userLocation.address.city+", "+userLocation.address.state,"http://maps.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png");map.map.fitBounds(bounds);var listener=google.maps.event.addListener(map.map,"idle",function(){map.map.setCenter(userLoc);map.map.setZoom(map.map.getZoom()-1);google.maps.event.removeListener(listener);});}function updateLocation(zip){$.ajax({type:"POST",url:RCO.util.root+"/ajax/updateLocation.jsp",data:"zipcode="+zip,success:function(data){var link=$("#current-location");if(data&&data.notifications&&data.notifications.errors&&data.notifications.errors.length>0){link.attr("data-ziperror","true");link.click();}else{link.attr("data-ziperror","false");$("#cboxClose").trigger("click");document.location.reload();}}});}function bindAll(){var showLoc=$("#show-chapters"),cancelLoc=$("#cancel-location"),saveLoc=$("#save-location"),saveLocForm=$("#saveLocation"),postalCode=$("#zipcode");showLoc.die("click").live("click",function(e){e.preventDefault();$(e.target).toggleClass("open").next().slideToggle(null,$.colorbox.resize);});cancelLoc.die("click").live("click",function(e){e.preventDefault();$("#cboxClose").trigger("click");});saveLocForm.die("submit").live("submit",function(e,data){e.preventDefault();var zip=(data&&data.zip)||zipCodeField.val();var gcRequest=new RCO.Geocode(zip,function(valid){if(valid=="true"){updateLocation(zip);var $catalogListFilter=$("#catalogList-filter");if($catalogListFilter.length>0){$catalogListFilter.submit();}}else{e.preventDefault();}});});if(!!postalCode.val()){RCO.util.loadMapApi.load(requestChapter);}}Modernizr.load({load:RCO.util.root+"/js/plugins/infowindow.min.js",complete:function(){}});bindAll();},signInModal:{count:0,init:function(){var signIn=RCO.exec.common.signInModal;signIn.handlers();},handlers:function(){var signIn=this;$("#modal form").bind("submit",function(e){signIn.validateForm(e);});},showCaptcha:function(e){signIn.captcha=signIn.$form.find(".captcha-box");signIn.captcha.show();RCO.ui.modal.resize();},validateForm:function(e){e.preventDefault();var signIn=this;signIn.$form=$(e.target);signIn.data={};signIn.data.signinEmail=signIn.$form.find("#signin-email").val();signIn.data.signinPassword=signIn.$form.find("#signin-password").val();if(signIn.data.signinEmail===""||signIn.data.signinPassword===""){signIn.data.fakeError=true;}signIn.submitForm();},submitForm:function(){var signIn=this;var signInfields=signIn.$form.find("input");$.post(signIn.$form.attr("action"),signInfields,function(response){if(response.notifications.errors){signIn.errors=signIn.$form.find(".invalid-box").hide();if(response.notifications.errors[0].messages[0]=="[showCaptcha]"){$(".captcha-box").show();$(".signin-standard").hide();$("#recaptcha_reload").trigger("click");RCO.ui.modal.resize();}else{if(response.notifications.errors[0].messages[0]=="[showSignIn]"){$(".captcha-box").hide();$(".signin-standard").show();RCO.ui.modal.resize();}else{signIn.showErrors(response.notifications.errors);$("#recaptcha_reload").trigger("click");}}}else{var dataRepopulateIdentfierParam="";if($(".retain-data-on-modal-login").length>0){dataRepopulateIdentfierParam="retrieveData=1";if(window.location.href.match("\\?")){dataRepopulateIdentfierParam="&"+dataRepopulateIdentfierParam;}else{dataRepopulateIdentfierParam="?"+dataRepopulateIdentfierParam;}}var refreshUrl=window.location.href.replace("showLogin=1","showLogin=0").replace("parentPageStep=2","parentPageStep=1")+dataRepopulateIdentfierParam;if(response.savedCC){if(refreshUrl.indexOf("flow=")!=-1){refreshUrl=refreshUrl.replace("flow=oc3","flow=oc1");}else{if(refreshUrl.indexOf("?")!=-1){refreshUrl=refreshUrl+"&flow=oc1";}else{refreshUrl=refreshUrl+"?flow=oc1";}}}if(refreshUrl.indexOf("loggedIn=")!=-1){refreshUrl=refreshUrl.replace("loggedIn=false","loggedIn=true");}else{if(refreshUrl.indexOf("?")!=-1){refreshUrl=refreshUrl+"&loggedIn=true";}else{refreshUrl=refreshUrl+"?loggedIn=true";}}if(refreshUrl.substr(refreshUrl.length-1)=="#"){refreshUrl=refreshUrl.substr(0,refreshUrl.length-1);}window.open(refreshUrl,"_self");}});},showErrors:function(errors){var signIn=this;signIn.errors=signIn.$form.find(".invalid-box");signIn.errors.find(".error-list").empty();$.each(errors[0].messages,function(idx,error){signIn.errors.find(".error-list").append("<li>"+error+"</li>");});signIn.errors.show();RCO.ui.modal.resize();}},clickToChatCall:{init:function(){var deploymentID="573d0000000PEc5";var btnOnline="liveagent_button_online_"+deploymentID;var btnOffline="liveagent_button_offline_"+deploymentID;var urlCase="http://arcliveagent.force.com/WebToCasePage";var urlDeployment="https://c.la1w1.salesforceliveagent.com/content/g/deployment.js";var urlChat="https://d.la1w1.salesforceliveagent.com/chat";var chatID="572d0000000PEcA";var chatID2="00Dd0000000bxKz";if($("a.click-to-chat").length>0){$("a.click-to-chat").attr("id",btnOnline);var $v_ga_Category_Name=$("a.click-to-chat").attr("ga_Category_Name");var $v_ga_Action_Name=$("a.click-to-chat").attr("ga_Action_Name");$("ul.chat-call").append('<li><a id="'+btnOffline+'" class="click-to-chat" href="'+urlCase+'" target="_blank" ga_Category_Name="'+$v_ga_Category_Name+'" ga_Action_Name="'+$v_ga_Action_Name+'">Submit an Inquiry</a></li>');$("a.click-to-chat").click(function(){$v_ga_Category_Name=$(this).attr("ga_Category_Name");$v_ga_Action_Name=$(this).attr("ga_Action_Name");if($v_ga_Category_Name&&$v_ga_Action_Name){gaEvent($v_ga_Category_Name,$v_ga_Action_Name);}});$.getScript(urlDeployment,function(){liveagent.init(urlChat,chatID,chatID2);if(!window._laq){window._laq=[];}window._laq.push(function(){liveagent.showWhenOnline(deploymentID,document.getElementById(btnOnline));liveagent.showWhenOffline(deploymentID,document.getElementById(btnOffline));$("ul.chat-call").delay(3000).show(1);});});$("#"+btnOnline).click(function(e){e.preventDefault();liveagent.startChat(deploymentID);});}}},clickToChatPrompt:{promptTimerHandle:null,onlineBtnObj:null,init:function(){if(typeof(Storage)!=="undefined"){if(sessionStorage.ctcp_isEnabled=="false"||sessionStorage.ctcp_status=="close"){return;}if(!loadData()){return;}if(sessionStorage.ctcp_isEnabled=="false"||sessionStorage.ctcp_status=="close"){return;}sessionStorage.ctcp_currentView=$("#ctcp_currentView").val();sessionStorage.ctcp_hasCourse=$("#ctcp_hasCourse").val();sessionStorage.ctcp_courseCount=$("#ctcp_courseCount").val();initLiveAgent();if(sessionStorage.ctcp_status=="ready"&&sessionStorage.ctcp_currentView!="undefined"){if(sessionStorage.ctcp_currentView=="index"){RCO.exec.common.clickToChatPrompt.startPromptTimer();$("body").click(function(event){var nodeName=event.target.nodeName;if(nodeName=="INPUT"||nodeName=="A"||nodeName=="SELECT"||nodeName=="LI"){RCO.exec.common.clickToChatPrompt.stopPromptTimer();}});}else{if(sessionStorage.ctcp_currentView=="detail"){var detailVisitTimesAction=Number(sessionStorage.ctcp_courseDetailVisitedTimes)+1;sessionStorage.ctcp_courseDetailVisitedTimes=detailVisitTimesAction;if(detailVisitTimesAction>sessionStorage.ctcp_courseDetailVisitTimes){RCO.exec.common.clickToChatPrompt.showPrompt();}else{RCO.exec.common.clickToChatPrompt.startPromptTimer();$("body").click(function(event){var nodeName=event.target.nodeName;if(nodeName=="INPUT"||nodeName=="A"){RCO.exec.common.clickToChatPrompt.stopPromptTimer();}});}}else{if(sessionStorage.ctcp_currentView=="cart"){if(sessionStorage.ctcp_lastView=="review"&&Number(sessionStorage.ctcp_courseCountPrev)>Number(sessionStorage.ctcp_courseCount)){RCO.exec.common.clickToChatPrompt.showPrompt();}}else{if(sessionStorage.ctcp_currentView=="review"){sessionStorage.ctcp_showNoPrompt="false";RCO.exec.common.clickToChatPrompt.startPromptTimer();}else{if(sessionStorage.ctcp_currentView=="signIn"){sessionStorage.ctcp_showNoPrompt="false";RCO.exec.common.clickToChatPrompt.startPromptTimer();$(".no-prompt, .button").bind("click",function(){sessionStorage.ctcp_showNoPrompt="true";});}}}}}}else{if(sessionStorage.ctcp_status=="ready"&&sessionStorage.ctcp_currentView=="undefined"){if((sessionStorage.ctcp_lastView=="review"||sessionStorage.ctcp_lastView=="signIn")&&sessionStorage.ctcp_showNoPrompt=="false"&&sessionStorage.ctcp_hasCourse=="true"){RCO.exec.common.clickToChatPrompt.showPrompt();}}}sessionStorage.ctcp_lastView=sessionStorage.ctcp_currentView;RCO.ui.modal.init($(".ctcPrompt-modal"),{width:400,onClosed:function(){var module=RCO.exec.common.clickToChatPrompt;module.onCloseCtcPrompt();}});$(window).bind("beforeunload",function(){$.ajax({type:"POST",cache:false,url:"/ajax/ctcTracking.jsp",data:getParam(),async:false});});}function loadData(){if(typeof(ctcData)!=="undefined"){sessionStorage.ctcp_isEnabled=(ctcData.ctcp_isEnabled=="")?"false":ctcData.ctcp_isEnabled;sessionStorage.ctcp_showPromptWaitTime=ctcData.ctcp_showPromptWaitTime;sessionStorage.ctcp_courseDetailVisitTimes=ctcData.ctcp_courseDetailVisitTimes;sessionStorage.ctcp_courseDetailVisitedTimes=ctcData.ctcp_courseDetailVisitedTimes;sessionStorage.ctcp_status=(ctcData.ctcp_status=="")?"ready":ctcData.ctcp_status;sessionStorage.ctcp_lastView=ctcData.ctcp_lastView;sessionStorage.ctcp_isOnline=ctcData.ctcp_isOnline;sessionStorage.ctcp_showNoPrompt=ctcData.ctcp_showNoPrompt;sessionStorage.ctcp_hasCourse=ctcData.ctcp_hasCourse;sessionStorage.ctcp_courseCountPrev=ctcData.ctcp_courseCountPrev;return true;}else{return false;}}function getParam(){var returnObj={};returnObj.ctcp_status=sessionStorage.ctcp_status;returnObj.ctcp_courseDetailVisitedTimes=sessionStorage.ctcp_courseDetailVisitedTimes;returnObj.ctcp_lastView=sessionStorage.ctcp_lastView;returnObj.ctcp_showNoPrompt=sessionStorage.ctcp_showNoPrompt;returnObj.ctcp_hasCourse=sessionStorage.ctcp_hasCourse;returnObj.ctcp_courseCountPrev=sessionStorage.ctcp_courseCount;if(RCO.exec.common.clickToChatPrompt.onlineBtnObj!=null&&RCO.exec.common.clickToChatPrompt.onlineBtnObj.length>0){returnObj.ctcp_isOnline=RCO.exec.common.clickToChatPrompt.onlineBtnObj.is(":visible");if(returnObj.ctcp_isOnline==false){returnObj.ctcp_status="close";}}return returnObj;}function initLiveAgent(){var deploymentID="573d0000000PEc5";var urlDeployment="https://c.la1w1.salesforceliveagent.com/content/g/deployment.js";var urlChat="https://d.la1w1.salesforceliveagent.com/chat";var chatID="572d0000000PEcA";var chatID2="00Dd0000000bxKz";var btnOnline="ctcpOnline";var ctcView=(sessionStorage.ctcp_currentView=="undefined")?sessionStorage.ctcp_lastView:sessionStorage.ctcp_currentView;$("#ftr").append('<a id="'+btnOnline+'" href="#" target="_blank">&nbsp;</a>');$("#ftr").append('<a href="/modal/ctcPrompt.jsp?ctcView='+ctcView+'" class="ctcPrompt-modal hide"  />&nbsp;</a>');sessionStorage.ctcp_onlineButtonId=btnOnline;$.getScript(urlDeployment,function(){liveagent.init(urlChat,chatID,chatID2);if(!window._laq){window._laq=[];}window._laq.push(function(){liveagent.showWhenOnline(deploymentID,document.getElementById(btnOnline));});});RCO.exec.common.clickToChatPrompt.onlineBtnObj=$("#"+btnOnline);RCO.exec.common.clickToChatPrompt.onlineBtnObj.click(function(e){e.preventDefault();liveagent.startChat(deploymentID);});}},showPrompt:function(){if(sessionStorage.ctcp_isOnline=="true"){setTimeout(function(){$(".ctcPrompt-modal").click();},2000);RCO.exec.common.clickToChatPrompt.stopPromptTimer();$("#idCtcPromptButton").live("click",function(){$("#cboxClose").click();$("#"+sessionStorage.ctcp_onlineButtonId).click();});}else{if(sessionStorage.ctcp_isOnline=="false"){sessionStorage.ctcp_status="close";}}},startPromptTimer:function(){var numTime=Number(sessionStorage.ctcp_showPromptWaitTime)*1000*60;RCO.exec.common.clickToChatPrompt.promptTimerHandle=setTimeout(function(){RCO.exec.common.clickToChatPrompt.showPrompt();},numTime);},stopPromptTimer:function(){if(RCO.exec.common.clickToChatPrompt.promptTimerHandle!=null){clearTimeout(RCO.exec.common.clickToChatPrompt.promptTimerHandle);}RCO.exec.common.clickToChatPrompt.promptTimerHandle=null;},onCloseCtcPrompt:function(){sessionStorage.ctcp_status="close";}},tributeErrorModal:{init:function(){var errorValue=$("[testMessage]").attr("testMessage");$("#errorDiv").text(errorValue);$.colorbox.resize();$("#cboxClose").click(function(){window.location.href="/donate/shoppingCart.jsp";});}},ajaxSnapshotForm:{postDataBindScript:null,postDataPopulateScript:null,init:function(){if($(".ajaxSnapshotForm").length>0){this.bindSubmitPoints();if($(".ajaxSnapshotForm-postDataBindScript").length>0){this.postDataBindScript=eval($(".ajaxSnapshotForm-postDataBindScript").attr("value"));}}if($(".ajaxSnapshotRetrievedData").length>0){if($(".ajaxSnapshotForm-postDataPopulateScript").length>0){this.postDataPopulateScript=eval($(".ajaxSnapshotForm-postDataPopulateScript").attr("value"));}this.repopulateFields();}},bindSubmitPoints:function(){var submitLinks=$(".ajaxFormSnapshotTrigger");submitLinks.live("click",function(event){var fieldsToBeCopied=$(".ajaxSnapshotForm").find("input[key-field=1]");for(var cnt=0;cnt<fieldsToBeCopied.length;++cnt){var proxyField=$(fieldsToBeCopied.get(cnt));var actualFieldId=proxyField.attr("id").replace("_snapshotProxy","");var actualField=$("#"+actualFieldId);if(actualField.length>0&&proxyField.length>0){var actualFieldVal;if(actualField.is("input:radio")){actualFieldVal=$("#"+actualFieldId+":checked").attr("value");}else{if(actualField.is("input:checkbox")){actualFieldVal=$("#"+actualFieldId).is(":checked");}else{actualFieldVal=actualField.attr("value");}}if(actualFieldVal!=undefined){proxyField.attr("value",actualFieldVal);}}}if(RCO.exec.common.ajaxSnapshotForm.postDataBindScript){RCO.exec.common.ajaxSnapshotForm.postDataBindScript($(".ajaxSnapshotForm"));}var asynch=!$(this).hasClass("synchronous");var fieldEls=$(".ajaxSnapshotForm").find("input");$.ajax({type:"POST",url:$(".ajaxSnapshotForm").attr("action"),data:fieldEls,async:asynch});});},repopulateFields:function(){var fieldsToBeCopied=$(".ajaxSnapshotRetrievedData").find("input");for(var cnt=0;cnt<fieldsToBeCopied.length;++cnt){var proxyField=$(fieldsToBeCopied.get(cnt));var actualFieldId=proxyField.attr("id").replace("_retrieveProxy","");var actualField=$("#"+actualFieldId);if(actualField.length>0&&proxyField.length>0){var retrievedVal=proxyField.attr("value");if(actualField.is("input:radio")){var eleToBeSelected=$("#"+actualFieldId+"[value="+retrievedVal+"]");eleToBeSelected.prop("checked","true");}else{if(actualField.is("input:checkbox")){actualField.prop("checked",retrievedVal=="true"?true:false);}else{actualField.attr("value",retrievedVal);}}}}if(RCO.exec.common.ajaxSnapshotForm.postDataPopulateScript){RCO.exec.common.ajaxSnapshotForm.postDataPopulateScript($(".ajaxSnapshotRetrievedData"));}}}},account:{init:function(){var notification=$(".notification");RCO.ui.notify(notification);},accountLanding:function(){RCO.ui.modal.init($(".add-phone-modal"),{width:430,onComplete:function(){},onClosed:function(){}});$(".tooltip-summary").live("mouseover mouseout",function(evt){var $target=$(evt.target),$objToolTipPos=$(this).find(".tooltipdrop").position(),leftPos=$objToolTipPos.left+$(this).find(".tooltipdrop").width()+20,topPos=$objToolTipPos.top-62;if($(window).scrollTop()+$(window).height()<$objToolTipPos.top+$(this).find(".tooltip-body").height()+200){topPos=topPos-$(this).find(".tooltip-body").height()+104;$(this).find(".bg-arrow").css("top","auto").css("bottom",60);}else{$(this).find(".bg-arrow").css("top",60).css("bottom","auto");}if(evt.type==="mouseout"){$(this).children(".tooltip-body").hide();}else{$(this).children(".tooltip-body").show().css({left:leftPos,top:topPos});}});$(".quick-donate-info").live("mouseover mouseout",function(evt){var $target=$(evt.target),leftPos=$(this).parent("h5").width()-20;if(evt.type==="mouseout"){$(this).parent("h5").find(".rco-tooltip").hide();}else{$(this).parent("h5").find(".rco-tooltip").show().css({left:-leftPos,top:-20});}});},createAccount:function(){var form=$("form",".create-account-form");RCO.ui.validate.init(form);RCO.exec.account.loadGigysSignButtons();},personalInfo:function(){var passwordField=$("#password"),initialPass,passwordObj;if(passwordField.length>0){initialPass=passwordField.val();passwordObj=RCO.ui.form.togglePassword(passwordField);}RCO.ui.form.toggleActions(passwordObj);RCO.ui.modal.init(null,{close:""});var oldUserCheckbox=$("#old-user");$(".old-system").hide();var toggleOldFields=function(){oldUserCheckbox.bind("click",function(){$(".old-system").toggle();});};function save(settings){var defaults={type:"POST"};$.ajax($.extend(settings,defaults));}function setupFormAjax(element,msgTemplate){var section=element,form=section.find("form"),submitBtn=form.find(".button[type=submit]"),fields=form.find("input, select, textarea"),formParams={},saveURL=form.attr("action"),template=$("#notificationTemplate"),clearMsg;clearMsg=function(){var message=form.find(".notification");if(message.length>0){message.remove();}};function afterSave(data,textStatus,jqXHR){var notificationTemplate;function updateForm(){var i,fields=data.formData;if($("a:hidden").hasClass("sms-link")){var phNumber=fields[0].daytimeTelephoneNumber.value;var modifiedPhoneNo="(".concat(phNumber.substr(0,3)).concat(") ").concat(phNumber.substr(3,3)).concat("-").concat(phNumber.substr(6,4));form.find(":hidden").find("a").text(modifiedPhoneNo);var optInFlag=fields[1].receivePhoneUpdates.value;if(optInFlag=="false"){$(".sms-field").addClass("hide");}}for(i in fields){if(fields.hasOwnProperty(i)){form.find("input[name="+i+"]").val(fields[i].value);}}}function cacheVal(i,el){var $el=$(el);if($el.attr("type")!=undefined&&$el.attr("type")=="checkbox"){$el.data("cached-value",$el.prop("checked"));}else{$el.data("cached-value",$el.val());}}try{notificationTemplate=template.tmpl(data.notifications);if(notificationTemplate.length>0){clearMsg();RCO.ui.notify(notificationTemplate);form.prepend(notificationTemplate);form.find(".notification-header").find("h1:first").focus();}if(data.formData){updateForm();}if(!data.notifications.alerts){section.find(".cancel").click();}else{var elements=form.find("input, select, textarea").not(":button, :submit, :reset, :hidden");elements.each(cacheVal);}}catch(e){}}function onSave(e){e.preventDefault();fields.each(function(i){var name=this.name,value=this.value;if(name.match(/^password/)&&(value===""||value===initialPass)){return true;}formParams[this.name]=this.type=="checkbox"?this.checked:this.value;});save({url:saveURL,data:formParams,success:afterSave});}submitBtn.click(onSave);}(function setupLoginInfo(){var section=$("#login-info");setupFormAjax(section);})();(function setupPersonalInfo(){var section=$("#personal-info");setupFormAjax(section);})();(function setupProfileInfo(){var section=$("#profile-info"),checkboxes=section.find("input:checkbox"),masterCheckbox=checkboxes.first(),childCheckboxes=checkboxes.not(masterCheckbox);RCO.ui.form.toggleCheckboxes(masterCheckbox,childCheckboxes);setupFormAjax(section);})();(function setupSMS(){var section=$("#notification-settings").find(".receiver-info"),emailLink=section.find(".edit-email"),emailField=$("#email"),smsFieldToggle=$(".sms-link"),newSMS=smsFieldToggle.next().hasClass("add-sms");function onEmailClick(e){e.preventDefault();$("html").animate({scrollTop:$("#login-info").offset().top});emailField.select();}if(newSMS){RCO.ui.form.toggleSibling(smsFieldToggle,true);}else{RCO.ui.form.toggleSibling(smsFieldToggle);}emailLink.click(onEmailClick);setupFormAjax(section);})();(function setupNotificationSettings(){var section=$("#notification-settings").find(".receiver-pref");setupFormAjax(section);})();var getTimeZoneForUser=function(){var date=new Date();var timezoneval=-date.getTimezoneOffset()/60;$("#timezonetextID").prop("value",timezoneval);$("#timezonetextIDVal").prop("value",timezoneval);};var getEmailPreferenceVal=$("#receive-email");var emailPreference=function(){getEmailPreferenceVal.bind("click",function(){var emailPref=$("#receive-email").prop("checked");if(emailPref){$("#receive-email").prop("value",true);}else{$("#receive-email").prop("value",false);}});};var getOptInPhoneNumber=$("#personal-info-phone-link");var optInPhoneNumber=function(){getOptInPhoneNumber.bind("click",function(){var optIn=$("#personal-info-phone-link").prop("checked");if(optIn){$("#personal-info-phone-link").prop("value",true);}else{$("#personal-info-phone-link").prop("value",false);}});};getTimeZoneForUser();emailPreference();optInPhoneNumber();toggleOldFields();},signIn:function(){$("#btnSignIn").addClass("disabled");$("#btnSignIn").attr("disabled",true);$("#btnSignIn").parent().removeClass("bw");var email=$("#signInUsername").val();var password=$("#signInPassword").val();validateSignIn(email,password);$("#signInUsername").keydown(function(){var email=$("#signInUsername").val();var password=$("#signInPassword").val();validateSignIn(email,password);});$("#signInUsername").blur(function(){var email=$("#signInUsername").val();var password=$("#signInPassword").val();validateSignIn(email,password);});$("#signInUsername").focusout(function(){var email=$("#signInUsername").val();var password=$("#signInPassword").val();validateSignIn(email,password);});$("#signInUsername").change(function(){var email=$("#signInUsername").val();var password=$("#signInPassword").val();validateSignIn(email,password);});$("#signInPassword").keyup(function(){var email=$("#signInUsername").val();var password=$("#signInPassword").val();validateSignIn(email,password);});function validateSignIn(email,password){if(email!==""){if(isValidEmailAddress(email)){$("#signInUsername").addClass("email_verified");if(password!==""){$("#btnSignIn").removeClass("disabled");$("#btnSignIn").addClass("enabled");$("#btnSignIn").attr("disabled",false);$("#btnSignIn").parent().addClass("bw");}else{$("#btnSignIn").removeClass("enabled");$("#btnSignIn").addClass("disabled");$("#btnSignIn").attr("disabled",true);$("#btnSignIn").parent().removeClass("bw");}}else{$("#btnSignIn").removeClass("enabled");$("#btnSignIn").addClass("disabled");$("#btnSignIn").attr("disabled",true);$("#btnSignIn").parent().removeClass("bw");$("#signInUsername").removeClass("email_verified");}}}function isValidEmailAddress(emailAddress){var pattern=new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);return pattern.test(emailAddress);}},forgotPassword:function(){$("#forgotPwdSubmit").addClass("disabled");$("#forgotPwdSubmit").attr("disabled",true);$("#forgotPwdSubmit").parent().removeClass("bw");var email=$("#forgotPwdUsername").val();validateSignInPwd(email);$("#forgotPwdUsername").keydown(function(){var email=$("#forgotPwdUsername").val();validateSignInPwd(email);});$("#forgotPwdUsername").blur(function(){var email=$("#forgotPwdUsername").val();validateSignInPwd(email);});$("#forgotPwdUsername").focusout(function(){var email=$("#forgotPwdUsername").val();validateSignInPwd(email);});$("#forgotPwdUsername").change(function(){var email=$("#forgotPwdUsername").val();validateSignInPwd(email);});function validateSignInPwd(email){if(email!==""){if(isValidEmailAddressPwd(email)){$("#forgotPwdSubmit").removeClass("disabled");$("#forgotPwdSubmit").addClass("enabled");$("#forgotPwdSubmit").attr("disabled",false);$("#forgotPwdSubmit").parent().addClass("bw");$("#forgotPwdUsername").addClass("email_verified");}else{$("#forgotPwdSubmit").removeClass("enabled");$("#forgotPwdSubmit").addClass("disabled");$("#forgotPwdSubmit").attr("disabled",true);$("#forgotPwdSubmit").parent().removeClass("bw");$("#forgotPwdUsername").removeClass("email_verified");}}}function isValidEmailAddressPwd(emailAddress){var pattern=new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);return pattern.test(emailAddress);}},passwordReset:function(){$("#colorIndicatorWrapper").css("display","none");$("#passwordHint").css("display","none");$("#newPassword").keyup(function(){$("#passwordResult").html(checkStrength($("#newPassword").val()));if($("#newPassword").val()!==$("#confirmPassword").val()){$("#passwordReset").addClass("disabled");$("#passwordReset").attr("disabled",true);$("#passwordReset").parent().removeClass("bw");}});$("#confirmPassword").keyup(function(){$("#passwordResult").html(checkStrength($("#newPassword").val()));if($("#newPassword").val()!==$("#confirmPassword").val()){$("#passwordReset").addClass("disabled");$("#passwordReset").attr("disabled",true);$("#passwordReset").parent().removeClass("bw");}});function checkStrength(newPassword){var strength=0;if((newPassword.length>0)&&(newPassword.length<6)){$("#passwordResult").css("display","block");$("#passwordHint").css("display","block");$("#colorIndicator").css("display","block");$("#colorIndicatorWrapper").css("display","block");$("#colorIndicator").removeClass();return"Too short";}if(newPassword.length==0){$("#passwordResult").css("display","none");$("#passwordHint").css("display","none");$("#colorIndicatorWrapper").css("display","none");$("#colorIndicator").css("display","none");}if((newPassword.length>5)&&($("#newPassword").val()==$("#confirmPassword").val())){$("#passwordReset").removeClass("disabled");$("#passwordReset").attr("disabled",false);$("#passwordReset").parent().addClass("bw");}if(newPassword.length>5){strength+=1;}if(newPassword.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){strength+=1;}if(newPassword.match(/([a-zA-Z])/)&&newPassword.match(/([0-9])/)){strength+=1;}if(newPassword.match(/([!,%,&,@,#,$,^,*,?,_,~,`,/,?,<,>,;,:,{,},=,(,),',",|,])/)){strength+=1;}if(newPassword.match(/(.*[!,%,&,@,#,$,^,*,?,_,~,`,/,?,<,>,;,:,{,},=,(,),',",|,].*[!,%,&,@,#,$,^,*,?,_,~,`,/,?,<,>,;,:,{,},=,(,),',",|,])/)){strength+=1;}if(strength<2){$("#colorIndicator").removeClass();$("#colorIndicator").addClass("passVeryWeak");return"Very Weak";}else{if(strength==2){$("#colorIndicator").removeClass();$("#colorIndicator").addClass("passWeak");return"Weak";}else{if(strength==3){$("#colorIndicator").removeClass();$("#colorIndicator").addClass("passOk");return"Ok";}else{if(strength==4){$("#colorIndicator").removeClass();$("#colorIndicator").addClass("passGood");return"Good";}else{$("#colorIndicator").removeClass();$("#colorIndicator").addClass("passStrong");return"Strong";}}}}}$("#passwordReset").addClass("disabled");$("#passwordReset").attr("disabled",true);$("#passwordReset").parent().removeClass("bw");$(".secondary-content").validate({onkeyup:true,onclick:true,errorElement:"div",errorPlacement:function(error,element){error.appendTo("div#errorMessageList");},success:function(){if($("#newPassword").val()===$("#confirmPassword").val()){$("#passwordReset").removeClass("disabled");$("#passwordReset").attr("disabled",false);$("#passwordReset").parent().addClass("bw");}},invalidHandler:function(event,validator){if($("#newPassword").val()!==$("#confirmPassword").val()){$("#passwordReset").addClass("disabled");$("#passwordReset").attr("disabled",true);$("#passwordReset").parent().removeClass("bw");}},submitHandler:function(form){form.submit();}});if($("#newPassword").length>0){$("#newPassword").rules("add",{required:true,minlength:6,messages:{required:" ",minlength:" "}});}if($("#confirmPassword").length>0){$("#confirmPassword").rules("add",{required:true,minlength:6,equalTo:"#newPassword",messages:{required:" ",minlength:" ",equalTo:"Password does not match"}});}},orderHistory:function(){var update,search,defaultFilterOption,defaultFilterType,searchFilterOption,searchFilterType,section=$("#order-results"),orderFilter=$(".order-filter"),form=orderFilter.find("form"),orderResultsURL=form.attr("action"),filterMenu=form.find("select[name=orderFilter]"),filterBtn=form.find("input.button"),filterType=filterMenu.val();function getOrderResults(params,callback){$.ajax({url:orderResultsURL,data:params,success:function(data,textStatus,jqXHR){var orderItems;try{orderItems=$("#orderItemTemplate").tmpl(data);if(orderItems.length>0){section.empty().prepend(orderItems);}if(typeof callback==="function"){callback(data);}}catch(e){}}});}update=(function(){var cancelOnFilterChange=false;defaultFilterOption=filterMenu.children("option[value=recentOrders]");defaultFilterType=defaultFilterOption.val();searchFilterOption=filterMenu.children("option[value=allOrders]");searchFilterType=searchFilterOption.val();function onFilterChange(e){var that;if(cancelOnFilterChange){return;}cancelOnFilterChange=true;that=$(e.target);filterType=that.val();orderFilter.not(that).find("option[value="+filterType+"]").prop("selected",true);cancelOnFilterChange=false;}function onFilterSubmit(e){e.preventDefault();getOrderResults({orderFilterType:filterType},search.clear());return false;}filterMenu.each(function(){var that=$(this),options=that.find("option");options.filter(":selected").prop("selected",false);options.eq(0).attr("selected",true);}).change(onFilterChange);filterBtn.click(onFilterSubmit);return{filterType:filterType};})();search=(function(){var searchWrap=$(".orders-search-wrap"),searchField=searchWrap.find("input[name=orderSearch]"),searchBtn=searchWrap.find(".button"),ordersDisplayHeader=$(".orders-display").find(".secondary-header"),searchText=ordersDisplayHeader.find(".search-text"),headerText=ordersDisplayHeader.find(".header-text"),clearLink=searchText.find(".clear-link");function clearSearch(e){if(e){e.preventDefault();getOrderResults({orderFilterType:defaultFilterType},function(){defaultFilterOption.prop("selected",true);});}headerText.show();searchText.hide();}function processSearch(e){e.preventDefault();getOrderResults({orderSearchTerms:searchField.val()},function(data){var searchTerms=searchText.find(".search-terms"),orderSearchTerms=$("#orderSearchTermsTemplate").tmpl(data);searchTerms.empty().prepend(orderSearchTerms);headerText.hide();searchText.show();clearLink.one("click",clearSearch);update.filterType=searchFilterOption.prop("selected",true).val();});}searchBtn.click(processSearch);return{clear:clearSearch};})();},donationRefund:function(){function toggleRadio(){var wrap=$(".sub-field-wrap");wrap.each(function(){var thisWrap=$(this),radio=thisWrap.find("input[type=radio]"),input=thisWrap.find("input[type=text]");input.bind("focus",function(){radio.attr("checked","checked");});});}toggleRadio();RCO.ui.form.toggleSibling($(".chapter-link"));},addPayment:function(){RCO.ui.form.matchCard($("#card-number"));if($(".quick-donate-info").length>0){$(".quick-donate-info").live("mouseover mouseout",function(evt){var $target=$(evt.target),leftPos=$(this).parent("label").width()+20;if(evt.type==="mouseout"){$(this).parent("label").find(".rco-tooltip").hide();}else{$(this).parent("label").find(".rco-tooltip").show().css({left:leftPos,top:-20});}});}},editPayment:function(){if($(".quick-donate-info").length>0){$(".quick-donate-info").live("mouseover mouseout",function(evt){var $target=$(evt.target),leftPos=$(this).parent("label").width()+20;if(evt.type==="mouseout"){$(this).parent("label").find(".rco-tooltip").hide();}else{$(this).parent("label").find(".rco-tooltip").show().css({left:leftPos,top:-20});}});}},myDonations:function(){var scopedCallback;function sortBy(callback){var sortSelect=$("#sort-by"),sortValue=sortSelect.val(),form=sortSelect.closest("form"),params={sortByString:sortValue},template=$("#monthly-donation-tmpl"),targetSection=$(".monthly-donations-table tbody"),staticDataURL=form.attr("action");function sortBySuccess(data,textStatus,jqXHR){var sortByItems;try{sortByItems=template.tmpl(data);if(sortByItems.length>0){targetSection.empty().append(sortByItems);}if(typeof(callback)==="function"){callback(data);}}catch(err){}}function sortByError(jqXHR,textStatus,errorThrown){}$.ajax({url:staticDataURL,data:params,success:sortBySuccess,error:sortByError});}$("#submit-sort").bind("click.myDonations",function(evt){RCO.util.ajax.sortBy(evt,scopedCallback);});},editDonation:function(){var chapterToggle=$(".chapter-link");RCO.ui.form.toggleSibling(chapterToggle);},cancelDonation:function(){var chapterToggle=$(".chapter-link"),cancelReasonToggle=$("#cancel-all"),toggleNext;RCO.ui.form.toggleSibling(chapterToggle);toggleNext=(function(){var cancelOptions=$("input[name=cancelOptions]"),cancelAll=cancelOptions.filter("#cancel-all"),thisField=cancelOptions.closest(".field-wrap"),nextField=thisField.next(".field-wrap"),hideClass="hide";function checkOptions(){var isCancelAll=cancelAll.prop("checked");if(isCancelAll){nextField.removeClass(hideClass);}else{nextField.addClass(hideClass);}}cancelOptions.bind("click",checkOptions);checkOptions();})();},myCourses:function(){var upcomingTab=$(".courses-tabs"),pageState={},listPointer,_courseData,toolTipTimer;function startCarousel(element){var that=element,carouselWrap=that.children("div"),slider=carouselWrap.children("div"),items=slider.children("div"),visible=3,step=3,currentIndex=0,currentItem=items.eq(currentIndex),popItems=currentItem.add(currentItem.nextUntil(items.eq(currentIndex+step))),speed=300,itemHeight=carouselWrap.innerHeight()/3,itemsCount=items.length,sliderPosition=parseInt(slider.css("top"),10),disableAnimation=false;function slideCarousel(direction){if(disableAnimation){return;}disableAnimation=true;var offset,newIndex,newItem,pushItems,untilItem;newIndex=currentIndex+(direction*step);if((itemsCount-1)<newIndex||newIndex<0){disableAnimation=false;return;}offset=itemHeight*direction*step;newItem=items.eq(newIndex);if(direction===-1){untilItem=currentItem;}else{untilItem=items.eq(newIndex+step);}pushItems=newItem.add(newItem.nextUntil(untilItem));(function(){pushItems.css({visibility:"visible"});sliderPosition=sliderPosition-offset;slider.animate({top:sliderPosition+"px"},{duration:speed,easing:"linear",complete:function(){slider.css({top:sliderPosition+"px"});popItems.css({visibility:"hidden"});disableAnimation=false;popItems=pushItems;currentIndex=newIndex;currentItem=newItem;currentItem.find("a").focus();}});})();}(function setupCarousel(){var i,prevLink=$('<a href="#" class="prev-item">PreV</a>'),nextLink=$('<a href="#" class="next-item">NexT</a>'),element;for(i=0;i<itemsCount;i+=1){element=$(items[i]);element.css({height:itemHeight+"px"});if(i>=visible){element.css({visibility:"hidden"});}}slider.css({height:(itemHeight*itemsCount)+"px"});that.append(nextLink).prepend(prevLink);})();that.find(".next-item").click(function(e){e.preventDefault();slideCarousel(1);});that.find(".prev-item").click(function(e){e.preventDefault();slideCarousel(-1);});}function initCarousel(index,carousel){var that=$(carousel),events=that.find(".event"),toggleClass="event-carousel",count=events.length;if(count>3){that.addClass(toggleClass);startCarousel(that);}}function setSortArrow(sortFilter){var upcomingList=$("#upcoming-list"),courseTable=upcomingList.find(".course-table"),tableHeads=courseTable.find("th");switch(sortFilter){case"formatAsc":tableHeads.filter(".format").addClass("sorted-asc");break;case"formatDesc":tableHeads.filter(".format").addClass("sorted-desc");break;case"titleAtoZ":tableHeads.filter(".title").addClass("sorted-asc");break;case"titleZtoA":tableHeads.filter(".title").addClass("sorted-desc");break;case"dateAsc":tableHeads.filter(".dates-and-times").addClass("sorted-asc");break;case"dateDesc":tableHeads.filter(".dates-and-times").addClass("sorted-desc");break;case"languageAsc":tableHeads.filter(".lang").addClass("sorted-asc");break;case"languageDesc":tableHeads.filter(".lang").addClass("sorted-desc");break;case"statusAsc":tableHeads.filter(".status").addClass("sorted-asc");break;case"statusDesc":tableHeads.filter(".status").addClass("sorted-desc");break;}}function maintainSort(data){$(".sort-by").val(data.users[0].sortCoursesBy);}function convertToEvent(courseData){var courses=courseData,coursesLen,events=[],event,i;for(i=0,coursesLen=courses.length;i<coursesLen;i+=1){if(courses[i].datesAndTimes!=null){event={allDay:false,courseHref:courses[i].courseHref,title:courses[i].courseTitle,format:courses[i].formatType,start:courses[i].datesAndTimes.datesRange.startDate,end:courses[i].datesAndTimes.datesRange.endDate,facility:null,city:null,state:null,language:courses[i].courseLanguage,price:courses[i].price,latlng:null,sessions:[{sessionDate:null,startTime:null,endTime:null},{sessionDate:null,startTime:null,endTime:null}],tooltip:$.tmpl($("#event-tooltip-tmpl"),courses[i])};events.push(event);}}return events;}function renderEvent(event,element,view){var $details=$("<div/>"),$titleLink=$("<a/>"),$tooltip=event.tooltip;element.html("");$titleLink.attr("href",event.courseHref||"#");$titleLink.addClass("open-tooltip").text(event.title).wrap("<h3/>").appendTo(element);$details.text(event.format).appendTo(element);$tooltip.appendTo(element);}function afterRender(event,element,view){var $tooltip=element.find(".tooltip-body"),leftVal=+element.find(".open-tooltip").width()+20;if(+element.css("left")>350){leftVal=-340;$tooltip.find(".bg-arrow").addClass("bg-arrow-right").removeClass("bg-arrow");}$tooltip.css("left",leftVal).css("top","-60px");}function hideTip(element){var $toolTip=element.find(".tooltip-body");toolTipTimer=window.setTimeout(function(){$toolTip.fadeOut("fast");element.css("z-index",8);},500);}function buildCalendar(data){_courseData=data;$(".summary").live("mouseover mouseout",function(evt){var $target=$(evt.target),leftPos=$target.closest(".summary").find("a").width()+20,$objToolTipPos=$target.closest(".summary").position(),topPos=-50;if($(window).scrollTop()+$(window).height()<$objToolTipPos.top+$(this).find(".tooltip-body").height()+340){topPos=60-$(this).find(".tooltip-body").height();$(this).find(".bg-arrow").css("top","auto").css("bottom",75);}else{$(this).find(".bg-arrow").css("top",50);}if(evt.type==="mouseout"){$(this).children(".tooltip-body").hide();}else{$(this).children(".tooltip-body").show().css({left:leftPos,top:topPos});}});$("#course-calendar").empty();$("#course-calendar").fullCalendar({events:convertToEvent(_courseData.users[0].courseCal),eventMouseover:function(){var elem=$(this);if($(".tooltip-body").is(":visible")){hideTip(elem);}window.clearTimeout(toolTipTimer);elem.find(".tooltip-body").fadeIn("fast");elem.css("z-index",100);},eventMouseout:function(){var elem=$(this);hideTip(elem);},header:{left:"prev title next",center:"",right:""},contentHeight:1115,theme:false,titleFormat:{month:"MMMM"},columnFormat:{month:"dddd"},weekMode:"variable",eventRender:renderEvent,eventAfterRender:afterRender});setSortArrow(data.users[0].sortCoursesBy);$(document).trigger("shareBar:render");RCO.exec.courses.loadLTPClassRegisterModal();}(function init(){listPointer=new RCO.ui.ajax.courseManager({form:$("#course-filter"),submit:$("#course-filter-submit"),namespace:"myCourses",pagination:{next:$(".course-next"),prev:$(".course-prev"),pages:$(".course-page"),count:$(".course-show")},template:$("#course-wrapper-tmpl"),target:$(".courses-container","#upcoming-list"),data:{user:$("#course-users"),sort:$(".sort-by")},callback:function(data){_courseData=data;maintainSort(data);setSortArrow(data.users[0].sortCoursesBy);$(document).trigger("shareBar:render");},initCallback:buildCalendar});$(".event-box").each(initCarousel);RCO.ui.tabs.init(upcomingTab);$("#accessibletabsnavigation0-1").live("click",function(){buildCalendar(_courseData);});$("div.tabs-content").delegate("a.list-view","click",function(evt){evt.preventDefault();RCO.ui.tabs.instance.showAccessibleTabSelector("a[href=#accessibletabscontent0-0]");});(function(){var $courseItems=$("div.course-item-inner");if(!!$courseItems.length){var lengths=[],$courseItemsPaddingTop=+$courseItems.css("padding-top"),$courseItemsPaddingBottom=+$courseItems.css("padding-bottom");for(var i=0,j=$courseItems.length;i<j;i++){lengths.push($courseItems[i].clientHeight);}lengths.sort();var max_length=lengths[lengths.length-1];for(i=0;i<j;i++){$courseItems.height(max_length-$courseItemsPaddingTop-$courseItemsPaddingBottom);}}})();RCO.ui.printerFriendly(".printer-friendly");})();},progressReport:function(){RCO.ui.printerFriendly(".printer-friendly");},accountCourseDetail:function(){},transcripts:function(){var pointer;function setSortArrow(sortFilter){var transcriptsWrap=$(".transcripts-container"),courseTable=transcriptsWrap.find(".course-table"),tableHeads=courseTable.find("th");switch(sortFilter){case"formatAsc":tableHeads.filter(".format").addClass("sorted-asc");break;case"formatDesc":tableHeads.filter(".format").addClass("sorted-desc");break;case"titleAtoZ":tableHeads.filter(".class-title").addClass("sorted-asc");break;case"titleZtoA":tableHeads.filter(".class-title").addClass("sorted-desc");break;case"completionDateNewestFirst":tableHeads.filter(".date-completed").addClass("sorted-asc");break;case"completionDateOldestFirst":tableHeads.filter(".date-completed").addClass("sorted-desc");break;case"scoreHightestFirst":tableHeads.filter(".score").addClass("sorted-asc");break;case"scorelowestFirst":tableHeads.filter(".score").addClass("sorted-desc");break;case"expirationEarliest":tableHeads.filter(".expires").addClass("sorted-asc");break;case"expirationLatest":tableHeads.filter(".expires").addClass("sorted-desc");break;}}function maintainSort(data){$(".sort-by").val(data.users[0].sortTranscriptsBy);}pointer=new RCO.ui.ajax.courseManager({form:$("#trans-filter"),submit:$("#trans-filter-submit"),namespace:"transcripts",pagination:{next:$(".trans-next"),prev:$(".trans-prev"),pages:$(".trans-page"),count:$(".trans-show")},template:$("#transcript-wrapper-tmpl"),target:$(".transcripts-container"),data:{user:$("#trans-users"),sort:$(".sort-by")},callback:function(data){var summaries=$(".summary");maintainSort(data);setSortArrow(data.users[0].sortTranscriptsBy);summaries.each(function(idx,summary){var tmpl=$.tmpl($("#event-tooltip-tmpl"),data.users[0].transcripts[idx]);$(summary).append(tmpl);});summaries.live("mouseover mouseout",function(evt){var $target=$(evt.target),leftPos=$target.closest(".summary").find("a").width()+20;if(evt.type==="mouseout"){$(this).children(".tooltip-body").hide();}else{$(this).children(".tooltip-body").show().css({left:leftPos,top:-50});}});$(document).trigger("shareBar:render");}});RCO.ui.printerFriendly(".printer-friendly");}},tribute:(function(){function init(){var $container=$("#container")[0],$cardTumb=$("#container").find(".card-thumb");ko.applyBindings(new viewModels.page(),$container);$cardTumb.live("click",function(){var $this=$(this);var $cardSelector=$this.parents(".card-selector");$cardSelector.find(".card-thumb").removeClass("active");$cardSelector.find(".card-radio[name='cardImage']").removeAttr("checked");$this.addClass("active");$this.children(".card-radio").attr("checked","checked");});var $downloadCardForm=$("#tributeDonateDownloadCardForm");if($downloadCardForm!=undefined){$(window).bind("load",function(){$downloadCardForm.submit();});$("#id-download-card-btn").bind("click",function(){$("#id-stop-email").val("true");$downloadCardForm.submit();});}RCO.exec.donate.tributeLightBox.init();}function donateConfirmation(){var eCardPreviewModal=$("[data-eCardPreviewModal]"),previewModal=$("[data-previewModal]"),eCardSent=$("[data-eCardSent]"),eCardScheduled=$("[data-eCardScheduled]"),eCardScheduledOneRecipient=$("[data-eCardScheduledOneRecipient]"),eCardScheduledMultipleRecipients=$("[data-eCardScheduledMultiRecipients]");var isAnonymous;isAnonymous=false;RCO.exec.donate.addQuickDonateToolTip();function disablesendAnon(){isAnonymous=false;$(".personalize-mail-card").removeClass("anon");$(".send-anon-card").removeAttr("checked");}$(".tabs-list .tab").live("click",function(e){e.preventDefault();$(".tabs-list .tab").removeClass("active");$(this).addClass("active");var tabID=$(".tabs-list .tab.active a").attr("href");$(".tabs .send-card-wrap").addClass("hide");$(tabID).removeClass("hide");disablesendAnon();});function tributePopulateCardPreview(cardType){var keyElements=cardType.find("[data-key]");$("#ecard-honorName").text($("#ecard-honoreeName").val());if($(".mailcard-wrap").is(":visible")){$("#tribute-card-honorName").text($("#mailcard-honoreeName").val());}if($(".printcard-wrap").is(":visible")){$("#tribute-card-honorName").text($("#printcard-honoreeName").val());}for(var i=0;i<keyElements.length;i++){var element=keyElements.eq(i);var key=element.data("key");var defaultValue=element.data("default");if(!defaultValue){defaultValue=element.text();element.data("default",defaultValue);}var value="";switch(key){case"tribute-message":value=$("#ecard-message").val();if(value!=""){}break;case"mailcard-tribute-message":if($(".mailcard-wrap").is(":visible")){value=$("#mailcard-message").val();if(value!=""){}}else{value=$("#printcard-message").val();if(value!=""){}}break;case"tribute-name":if($(".mailcard-wrap").is(":visible")){value=$("#mailcard-sender-name").val();}else{value=$("#printcard-sender-name").val();}if(value!=""){$(cardType).find(".tribute-donor-name").html("From<br>"+value);}break;default:break;}}if(value&&value.length>0){element.text(value);}else{element.text(defaultValue);}}RCO.ui.modal.init($(".ecard-sent-modal"),{width:770,onComplete:function(){var ecardEmailVal=$("#ecard-email").val(),$recipients=$(".tribute-ecard-recipients"),multipleEmailVals=ecardEmailVal.indexOf(",");if(ecardEmailVal!==""){$recipients.html("");if(multipleEmailVals!==-1){var EmailArray=ecardEmailVal.split(",");for(var i=0;i<EmailArray.length;i++){$recipients.append("<p>"+EmailArray[i]+"</p>");}}else{$recipients.append("<p>"+ecardEmailVal+"</p>");}}}});RCO.ui.modal.init($(".tribute-ecard-preview-modal"),{width:false,onComplete:function(){var cardType=$(".tribute-preview-ecard");tributePopulateCardPreview(cardType);var $ecardImg=$("#ecard-card-thumbs .card-thumb.active img");var ecardImgUrl=$ecardImg.attr("data-card-url");var ecardAltTxt=$ecardImg.attr("alt");if(ecardImgUrl!=undefined){$("#tribute-e-card-img").attr("src",ecardImgUrl).attr("alt",ecardAltTxt);}$(".card-design-wrap").each(function(){var $thisObj=$(this);var vDisplay=$thisObj.css("display");if(vDisplay=="block"){var $liCardThumb=$(this).find("li.card-thumb");if($liCardThumb.hasClass("active")){var cardRadio=$liCardThumb.find(".ecard-radio");if(cardRadio.val()!=undefined){$("#tributeECardId").attr("value",cardRadio.val());}}}});if($("#ecard-include-donation").is(":checked")){$(".tribute-donation-amount").removeClass("hide");}$("#tributeDonateECardBtn").bind("click",function(){$("#ecard-submit").click();});$.fn.colorbox.resize();}});RCO.ui.modal.init($(".open-ecard-tribute-modal"),{width:450});if($("[eCardConfirmModal]").length>0){$(".ecard-sent-modal").click();}RCO.ui.form.datePicker();function setDeliveryDate(){var today=new Date(),month=today.asString("mmmm"),date=today.getDate(),year=today.asString("yyyy"),$fromDate=$("#from-date"),deliveryDate;$fromDate.val("Today: "+month+" "+date+", "+year);$(".date-pickers-wrap").find(".field").bind("dateSelected",function(event,date){var today=new Date();today=today.asString("mmmm")+" "+today.getDate()+", "+today.asString("yyyy");deliveryDate=date.asString("mmmm")+" "+date.getDate()+", "+date.asString("yyyy");if(today===deliveryDate){$fromDate.val("Today: "+deliveryDate);$(".today-delivery-times").removeClass("hide");$(".future-delivery-times").addClass("hide");}else{$(".today-delivery-times").addClass("hide");$(".future-delivery-times").removeClass("hide");$fromDate.val(deliveryDate);}});}setDeliveryDate();RCO.ui.modal.init($(".open-tribute-modal"),{width:770,onComplete:function(){var $address=$(".mail-tribute-address");if($address.length>0){$(".tribute-recipients").html("");$address.each(function(i){var $address=$(this),name=$address.find(".mail-tribute-name").text(),address1=$address.find(".mail-tribute-address1").text(),address2=$address.find(".mail-tribute-address2").text(),city=$address.find(".mail-tribute-city").text(),state=$address.find(".mail-tribute-state").text(),zip=$address.find(".mail-tribute-zip").text();var checkForAddress2=function(){if(address2!=""){return address2+"<br/>";}else{return"";}};var addressStr="";addressStr+="<div class='recipient'>";addressStr+="<p class='recipient-name'>"+name+"</p>";addressStr+="<p>"+address1+"<br/>"+checkForAddress2();addressStr+=city+", "+state+" "+zip+"</p>";addressStr+="</div>";$(".tribute-recipients").append(addressStr);if($address.length>1){$(".one-recipient-scheduled").removeClass("hide");$(".multiple-recipients-scheduled").addClass("hide");}else{$(".one-recipient-scheduled").addClass("hide");$(".multiple-recipients-scheduled").removeClass("hide");}});}$.fn.colorbox.resize();}});RCO.ui.modal.init($(".tribute-card-preview-modal"),{width:723,onComplete:function(){var cardType=$(".tribute-preview-card");var cardTypeStr=$("#cardType").val();var cardDesignImg=$("#"+cardTypeStr+"-card-thumbs .card-thumb.active img");var cardImgFrontUrl=cardDesignImg.attr("data-card-fnt-url");var cardImgFrontAlt=cardDesignImg.attr("data-card-fnt-alt");var cardImgBackUrl=cardDesignImg.attr("data-card-bak-url");var cardImgBackAlt=cardDesignImg.attr("data-card-bak-alt");$("#img-card-preview-front").attr("src",cardImgFrontUrl).attr("alt",cardImgFrontAlt);$("#img-card-preview-back").attr("src",cardImgBackUrl).attr("alt",cardImgBackAlt);$(".preview-card-slider").anythingSlider({buildArrows:true,buildNavigation:true,infiniteSlides:false,hashTags:false,stopAtEnd:true,startPanel:2,onInitialized:function(evt,slider){var vgaTagCategory="Donate";var vgaTagActionBack="Donate_Tribute_CardPreview|Preview_Back";var vgaTagActionFront="Donate_Tribute_CardPreview|Preview_Front";var vgaTagActionInside="Donate_Tribute_CardPreview|Preview_Inside";$("div.anythingControls ul li a").click(function(){if($(this).hasClass("panel1")){gaEvent(vgaTagCategory,vgaTagActionFront);}if($(this).hasClass("panel2")){gaEvent(vgaTagCategory,vgaTagActionInside);}if($(this).hasClass("panel3")){gaEvent(vgaTagCategory,vgaTagActionBack);}return false;});$(".forward a").click(function(){if(slider.currentPage===2){gaEvent(vgaTagCategory,vgaTagActionBack);}if(slider.currentPage===1){gaEvent(vgaTagCategory,vgaTagActionInside);}});$(".back a").click(function(){if(slider.currentPage===2){gaEvent(vgaTagCategory,vgaTagActionFront);}if(slider.currentPage===3){gaEvent(vgaTagCategory,vgaTagActionInside);}});},navigationFormatter:function(index,panel){return["Front","Inside","Back"][index-1];}});if(cardTypeStr=="printcard"){if($("#printcard-include-donation").is(":checked")){$(".tribute-donation-amount").removeClass("hide");}}else{if($("#mailcard-include-donation").is(":checked")){$(".tribute-donation-amount").removeClass("hide");}}if(!isAnonymous){tributePopulateCardPreview(cardType);}else{$(".tribute-card-info").addClass("hide");if($(".mailcard-wrap").is(":visible")){$("#tribute-card-honorName").text($("#mailcard-honoreeName").val());}if($(".printcard-wrap").is(":visible")){$("#tribute-card-honorName").text($("#printcard-honoreeName").val());}}$("#tributeDonatePCardDownloadBtn").live("click",function(){$("#printcard-submit").click();});$("#tributeDonateMailCardBtn").bind("click",function(){$("#mailcard-submit").click();});$.fn.colorbox.resize();}});if($("#close-tribute-modal")!=undefined){$("#cboxClose").click(function(){if($("#close-tribute-modal").attr("href")!=undefined){window.location.href=$("#close-tribute-modal").attr("href");}});}function validateCarriageReturn(e){var element=e.target.id;var delimiter="\n";var number_breaks=$("#"+element).val().split(delimiter).length;number_breaks--;if(number_breaks>=3){var str=$("#"+element).val();if(element!="ecard-message"){var tokens=str.split(delimiter).slice(0,3);$(this).val(tokens.join(delimiter));$("#"+element+"-error").removeClass("hide");}}else{$("#"+element+"-error").addClass("hide");}var text=$("#"+element).val();var limit=$("#"+element).attr("maxlength");if(element=="ecard-message"){limit=250;}else{limit=80;}limit=limit-number_breaks;if(text.length>=limit){$("#"+element).val(text.substr(0,limit));$("#"+element+"-infoText").removeClass("hide");}else{$("#"+element+"-infoText").addClass("hide");}}$("#ecard-message").keyup(validateCarriageReturn);$("#mailcard-message").keyup(validateCarriageReturn);$("#printcard-message").keyup(validateCarriageReturn);$(".send-anon-card").bind("click",function(){var $personalizeMailCard=$(this).parents("#personalize-card-wrap").find(".personalize-mail-card");$personalizeMailCard.toggleClass("anon");if($personalizeMailCard.hasClass("anon")){isAnonymous=true;}else{isAnonymous=false;}});$("#mailcard-submit").live("click",function(){$("#card-error-container").html("");if($(".mail-tribute-address").length===0){$("#card-error-container").html("Please add at least one recipient.");$(".close-modal").click();return false;}return true;});$(".tab").live("click",function(){if($(this).hasClass("ecard")){selectTheFirstCard("ecard");}else{if($(this).hasClass("mailcard")){selectTheFirstCard("mailcard");}else{if($(this).hasClass("printcard")){selectTheFirstCard("printcard");}}}});if($("[pCardConfirmModal]").length>0){$(".mailcard-sent").click();}if($("[mailCardTabAttr]").length>0){$(".mailCardTabClass").click();}if($("[printCardTabAttr]").length>0){$(".printCardTabClass").click();}function selectTheFirstCard(cardType){$(".card-design-wrap").each(function(){var $thisObj=$(this);var vDisplay=$thisObj.css("display");var vClass=$thisObj.attr("class");if(vClass.indexOf(cardType)!=-1){if(vDisplay=="block"){var $imgCardDesign=$(this).find("img.card-design");if($imgCardDesign.length>0){$imgCardDesign[0].click();}}}});}var vgaTagCategory="Donate";$("#ecard-card-dropdown").change(function(){var occasionName=this.options[this.selectedIndex].getAttribute("gaLabel");var vgaTagAction="Donate_Tribute_SendeCard|"+occasionName;gaEvent(vgaTagCategory,vgaTagAction);selectTheFirstCard("ecard");});$("#mailcard-card-dropdown").change(function(){var occasionName=this.options[this.selectedIndex].getAttribute("gaLabel");var vgaTagAction="Donate_Tribute_MailPrintCard|"+occasionName;gaEvent(vgaTagCategory,vgaTagAction);selectTheFirstCard("mailcard");});$("#printcard-card-dropdown").change(function(){var occasionName=this.options[this.selectedIndex].getAttribute("gaLabel");var vgaTagAction="Donate_Tribute_PrintatHome|"+occasionName;gaEvent(vgaTagCategory,vgaTagAction);selectTheFirstCard("printcard");});if(eCardScheduledMultipleRecipients.length>0){eCardScheduledMultipleRecipients[0].click();}if(eCardSent.length>0){eCardSent[0].click();}if(eCardScheduled.length>0){eCardScheduled[0].click();}if(eCardScheduledOneRecipient.length>0){eCardScheduledOneRecipient[0].click();}if(eCardScheduledMultipleRecipients.length>0){eCardScheduledMultipleRecipients[0].click();}if(previewModal.length>0){previewModal[0].click();}if(eCardPreviewModal.length>0){eCardPreviewModal[0].click();}RCO.ui.printerFriendlyTranscript("#printable-tax-receipt");}function customTributeCard(){$(".card-design").bind("click",function(){var cardTab=$(this).attr("data-card-tab");var cardUrl=$(this).attr("data-card-url");var cardAlt=$(this).attr("data-card-alt");var cardBakUrl=$(this).attr("data-card-bak-url");var cardBakAlt=$(this).attr("data-card-bak-alt");var cardLay=$(this).attr("data-card-lay");var imgWidth="301px";var imgHeight="421px";if(cardLay=="Landscape"){imgWidth="421px";imgHeight="301px";$("#card-preview-"+cardTab).addClass("card-preview-Landscape");}else{$("#card-preview-"+cardTab).removeClass("card-preview-Landscape");}$("#img-preview-"+cardTab).prop("src",cardUrl).prop("alt",cardAlt).width(imgWidth).height(imgHeight);$("#img-preview-bak-"+cardTab).prop("src",cardBakUrl).prop("alt",cardBakAlt);$("#card-image-url-"+cardTab).val(cardUrl);var $previewLink=$("#"+cardTab+"-preview");if($previewLink!=undefined){var previewHref=$previewLink.attr("data-bkp-href");if(previewHref==undefined){previewHref=$previewLink.attr("href");$previewLink.attr("data-bkp-href",previewHref);}if(previewHref.indexOf("?")==-1){$previewLink.attr("href",previewHref+"?cardlayout="+cardLay);}else{$previewLink.attr("href",previewHref+"&cardlayout="+cardLay);}}});if(!$(".tabs").hasClass("ignoreCardSelect")){var $ecardTab=$(".tab.ecard").find("a")[0];if($ecardTab!=undefined){var gaAction=$ecardTab.getAttribute("data-ga-action");var gaCategory=$ecardTab.getAttribute("data-ga-category");gaEvent(gaCategory,gaAction);}}$(".card-design-wrap").each(function(){var $thisObj=$(this);var vDisplay=$thisObj.css("display");if(vDisplay=="block"){var vClass=$thisObj.attr("class");if(vClass.indexOf("ecard")!=-1&&!$(".tabs").hasClass("ignoreCardSelect")){if($thisObj.find(".card-radio:checked").length>0){$thisObj.find(".card-radio:checked").siblings("img.card-design").click();}else{if($thisObj.find("img.card-design").length>0){$thisObj.find("img.card-design")[0].click();}}}}});var disableFields=$("#disableFields").val();if(disableFields=="1"){$(".tabs").find("input, textarea, button, select, a, img, li").attr("disabled","disabled");$(".tabs").find("a, li").click(function(e){e.preventDefault();return($(this).attr("disabled"))?false:true;});}}var viewModels={page:function(){var vm=this;var $addRecipientForm=$(".send-card-fields");vm.selectedOccasion=ko.o("none");vm.occasion=function(currentDesign){return ko.c(function(){return this.selectedOccasion()===currentDesign;},vm);};vm.selectedOccasionEcard=ko.o("none");vm.occasionEcard=function(currentDesign){return ko.c(function(){return this.selectedOccasionEcard()===currentDesign;},vm);};if($("#eCardMessageHidden").val()!=undefined){vm.message=ko.o($("#eCardMessageHidden").val());}else{vm.message=ko.o("");}if($("#mailCardMessageHidden").val()!=undefined){vm.mailcardmessage=ko.o($("#mailCardMessageHidden").val());}else{vm.mailcardmessage=ko.o("");}if($("#printCardMessageHidden").val()!=undefined){vm.printcardmessage=ko.o($("#printCardMessageHidden").val());}else{vm.printcardmessage=ko.o("");}if($("#eCardSubjectHidden").val()!=undefined){vm.subject=ko.o($("#eCardSubjectHidden").val());}else{vm.subject=ko.o($("#ecard-subject").val()==undefined?"":$.trim($("#ecard-subject").val()));}if($("#ecard-honoreeName").val()!=undefined){vm.honoreeName=ko.o($("#ecard-honoreeName").val());}else{vm.honoreeName=ko.o($("#ecard-honoreeName").val()==undefined?"":$.trim($("#ecard-honoreeName").val()));}if($("#mailcard-honoreeName").val()!=undefined){vm.mailHonoreeName=ko.o($("#mailcard-honoreeName").val());}else{vm.mailHonoreeName=ko.o($("#mailcard-honoreeName").val()==undefined?"":$.trim($("#mailcard-honoreeName").val()));}if($("#printcard-honoreeName").val()!=undefined){vm.printHonoreeName=ko.o($("#printcard-honoreeName").val());}else{vm.printHonoreeName=ko.o($("#printcard-honoreeName").val()==undefined?"":$.trim($("#printcard-honoreeName").val()));}vm.maxCard=ko.o(5);vm.newCard={name:ko.o(""),address1:ko.o(""),address2:ko.o(""),city:ko.o(""),state:ko.o(""),zip:ko.o("")};vm.cards=ko.oa([]);$("#mailcard-address-container .existing-recipient-list").each(function(){vm.cards.push(ko.toJS({name:ko.o($(this).children(".name").val()),address1:ko.o($(this).children(".address1").val()),address2:ko.o($(this).children(".address2").val()),city:ko.o($(this).children(".city").val()),state:ko.o($(this).children(".state").val()),zip:ko.o($(this).children(".zipCode").val())}));});vm.addCard=function(){var vMaxCard=vm.maxCard();var errorStr="";$("#card-error-container").html("");if(vm.cards().length<vMaxCard){var isError=false;$addRecipientForm.removeClass("disabled");if(vm.newCard.name().length===0){errorStr+="Name ";isError=true;}if(vm.newCard.address1().length===0){errorStr+="Address1 ";isError=true;}if(vm.newCard.city().length===0){errorStr+="City ";isError=true;}if(vm.newCard.state().length===0){errorStr+="State ";isError=true;}if(vm.newCard.zip().length===0){errorStr+="ZipCode ";isError=true;}if(!isError){var zipCodePattern=/^[0-9]{5}$/;if(!zipCodePattern.test(vm.newCard.zip())){errorStr+="Please enter a valid zipcode.";$("#card-error-container").html(errorStr);}else{vm.cards.push(ko.toJS(vm.newCard));for(var field in vm.newCard){vm.newCard[field]("");}}}else{errorStr=$.trim(errorStr).split(" ").join(", ");errorStr+=" cannot be empty.";$("#card-error-container").html(errorStr);}if(vm.cards().length==vMaxCard){$addRecipientForm.addClass("disabled");$addRecipientForm.find("input, select").attr("disabled","disabled");$addRecipientForm.find(".button").val("No Cards Remaining");}if(!Modernizr.input.placeholder){$("#first-name, #address1, #address2").blur();}}};vm.removeCard=function(card,e){var $target=$(e.target),$targetAddress=$target.parents(".mail-tribute-address");$addRecipientForm.removeClass("disabled");$addRecipientForm.find("input, select").removeAttr("disabled");$addRecipientForm.find(".button").val("Add Recipient");$targetAddress.fadeOut(function(){vm.cards.remove(card);});};vm.messageCharCount=ko.c(function(){var tempMessage=this.message().replace(new RegExp(String.fromCharCode(10),"g"),"\n\r");if(tempMessage.length<250){return 250-tempMessage.length;}else{return 0;}},vm);vm.messageMailCardCharCount=ko.c(function(){var tempMessage=this.mailcardmessage().replace(new RegExp(String.fromCharCode(10),"g"),"\n\r");if(tempMessage.length<80){return 80-tempMessage.length;}else{return 0;}},vm);vm.messagePCardCharCount=ko.c(function(){var tempMessage=this.printcardmessage().replace(new RegExp(String.fromCharCode(10),"g"),"\n\r");if(tempMessage.length<80){return 80-tempMessage.length;}else{return 0;}},vm);vm.messageMinCharCount=ko.c(function(){return 50-this.subject().length;},vm);vm.honNameMinCharCount=ko.c(function(){return 50-this.honoreeName().length;},vm);vm.honNameMailCardCharCount=ko.c(function(){return 50-this.mailHonoreeName().length;},vm);vm.honNamePrintCardCharCount=ko.c(function(){return 50-this.printHonoreeName().length;},vm);},cardViewsModal:function(){var vm=this;this.currentView=ko.o("Front");this.viewList=[];this.view=function(view){vm.viewList.push(view);return ko.c(function(){return this.currentView()===view;},vm);};this.selectView=function(data,event){var t=event.target;var view=t.innerText||t.textContent;if(vm.viewList.indexOf(view)>=0){vm.currentView(view);$.fn.colorbox.resize();}};}};return{init:init,donateConfirmation:donateConfirmation,customTributeCard:customTributeCard};})(),donate:{init:function(){},retrieveReceiptStep1:function(){RCO.ui.form.datePicker(null,true);},addQuickDonateToolTip:function(elem){$(".rco-tooltip-trigger").live("mouseover mouseout",function(evt){var $target=$(evt.target),$parent=$(this).parent(".rco-tooltip-wrap"),parentOffset=$parent.position(),parentWidth=$parent.width(),leftPos=parentOffset.left+parentWidth+20;if(evt.type==="mouseout"){$parent.find(".rco-tooltip").hide();}else{$parent.find(".rco-tooltip").show().css({left:leftPos,top:-25});}});},initLoginModal:function(){RCO.ui.modal.init($(".rco-login-modal"),{width:450,onComplete:RCO.exec.donate.forgotPasswordModal});},donateLanding:function(){RCO.ui.progress.init();(function simpleDropDown(){var element=$(".simple-dropdown");RCO.ui.simpleDropDown(element);})();},donateLandingV3:function(){var wrapper=$(".dedicate-options-group"),fieldWrap=wrapper.children(".field-wrap"),expandableWrap=$(".cause-description");RCO.ui.progress.init();(function simpleDropDown(){var element=$(".simple-dropdown");RCO.ui.simpleDropDown(element);})();(function causeDropdown(){var dropdown=$(".change-cause-dropdown"),toggle=dropdown.children(".toggle"),menuWrap=dropdown.children(".menu-wrap"),menu=menuWrap.children(".menu"),selectedCause=menuWrap.children(".selected-cause"),activeClass="active",bdy=$("body");function hideMenu(){dropdown.removeClass(activeClass);toggle.focus();toggle.one("click",showMenu);return false;}function showMenu(){dropdown.addClass(activeClass);menu.css("paddingTop",menuWrap.height());selectedCause.focus();selectedCause.one("click",hideMenu);bdy.one("click",hideMenu);return false;}function setWidth(){var menuWidth=menuWrap.width();menu.css("width",menuWidth);}function preserveMenu(evt){evt.stopPropagation();}toggle.one("click",function(){showMenu();setWidth();return false;});selectedCause.bind("click",function(){return false;});menu.click(preserveMenu);}());RCO.ui.expandable(expandableWrap,{initial:"hide"});RCO.exec.donate.quickDonateDollarHandles();fieldWrap.each(function(){var thisWrap=$(this),radio=thisWrap.find('input[type="radio"]'),toggle=thisWrap.find("label"),fieldWrap=wrapper.children(".field-wrap"),allRadio=fieldWrap.find('input[type="radio"]'),selectClass="selected";toggle.bind("click",function(){$(this).parents(".dedicate-options-group").find(".field-wrap").removeClass(selectClass);$(this).parents(".field-wrap").addClass(selectClass);return false;});});},quickDonateDollarHandles:function(){function selectAmount(){var wrapper=$(".fixed-amounts"),fieldWrap=wrapper.children(".field-wrap"),allRadio=fieldWrap.find('input[name="donationAmount"]'),selectClass="selected",qdButton=$("#quickDonateBtn"),qdButtonTmpl=qdButton.val(),$tributeAmount=$(".tribute-donation-amount"),otherAmtField=$("#other-donation-amount");if(fieldWrap.prop("tagName")!="DIV"){fieldWrap=wrapper.children(".fieldWrapper").children(".field-wrap");}otherAmtField.blur(function(){var val=otherAmtField.val();var ph=otherAmtField.attr("placeholder");var justActive=otherAmtField.closest(".field-wrap").hasClass(selectClass);if(justActive){updateQuickDonateButton();}if(val!==ph&&justActive){otherAmtField.data("customAmt",val);}else{if(val===ph&&justActive){val="";otherAmtField.data("customAmt",val);}else{val="";}}if(val===""){otherAmtField.closest(".field-wrap").removeClass(selectClass);}if($("#donation-options-tribute").length>0){$tributeAmount.text(val);}if(Modernizr.input.placeholder){otherAmtField.attr("placeholder",otherAmtField.data("placeholder"));}});otherAmtField.data("placeholder",otherAmtField.attr("placeholder"));if(otherAmtField.val()!==""){otherAmtField.data("customAmt",otherAmtField.val());}function updateQuickDonateButton(){if(qdButton.length){RCO.exec.donate.donateButtonTextUpdate();}}$("#other-donation-amount").bind("keyup",function(){var value=$(this).val();var amt=CurrencyFormatted(value);$tributeAmount.text(amt);RCO.exec.donate.donateButtonTextUpdate();});$("#other-donation-amount").blur(function(){var value=$(this).val();var amt=CurrencyFormatted(value);$tributeAmount.text(amt);RCO.exec.donate.donateButtonTextUpdate();});fieldWrap.each(function(){var thisWrap=$(this),radio=thisWrap.find('input[name="donationAmount"]'),toggle=thisWrap.find("label, #custom-amount");if(radio.is(":checked")){var donateAmount=radio.attr("data-amount");if(donateAmount==undefined){donateAmount=otherAmtField.data("customAmt");}$(".tribute-donation-amount").text(donateAmount);}toggle.bind("click",function(){allRadio.removeAttr("checked");radio.attr("checked","checked");fieldWrap.removeClass(selectClass);thisWrap.addClass(selectClass);var donationValue="0.00";var setAmount=0;if(radio.is(":checked")){var donateAmount=radio.attr("data-amount");if(donateAmount==undefined){donateAmount=otherAmtField.data("customAmt");}$("#skuDonationRetain").val(donateAmount);}if(thisWrap.hasClass("other-amount-wrap")){if(otherAmtField.data("customAmt")===otherAmtField.attr("placeholder")){otherAmtField.data("customAmt","");}otherAmtField.val(otherAmtField.data("customAmt"));$tributeAmount.text(otherAmtField.data("customAmt"));if(Modernizr.input.placeholder){otherAmtField.attr("placeholder","");}}else{otherAmtField.val("");otherAmtField.blur();otherAmtField.closest(".field-wrap").removeClass(selectClass);}if($("#donation-options-tribute").length>0){var donateAmount=radio.attr("data-amount");$(".tribute-donation-amount").text(donateAmount);}updateQuickDonateButton();return false;});});function resetStates(){var selectedRadio=allRadio.filter(":checked");fieldWrap.removeClass(selectClass);if(selectedRadio.length){selectedRadio.closest(".field-wrap").addClass(selectClass);}else{if(otherAmtField.val()!==""&&otherAmtField.val()!==otherAmtField.attr("placeholder")){otherAmtField.closest(".field-wrap").addClass(selectClass);fieldWrap.find('input[name="donationAmount"]').attr("checked","checked");}}}resetStates();updateQuickDonateButton();if(otherAmtField.closest(".field-wrap").hasClass("selected")){if(otherAmtField.val()==""){otherAmtField.attr("placeholder","");}otherAmtField.focus();}}selectAmount();},quickDonateSupportOptions:function(){$("#donation-support-select").click(function(){$("#myTest").val("clicked");});$("#container").click(function(event){if($("#myTest").val()=="clicked"){$(".menu-wrap").toggleClass("active");$(".menu-wrap").find(".menu-item").removeClass("hide");$("#myTest").val("containerVal");}else{$(".menu-wrap").removeClass("active");}});$(".donation-support-link").click(function(){var text=$(this).data("donation-text");$(".donation-support-text").text(text);$(this).parents(".menu-wrap").removeClass("active");$("#donation-cause").val(text);var prodId=$(this).attr("data-product-id");$("#donation-productId").val(prodId);});$(".toggle-donation-view").click(function(){var id=$(this).attr("id"),$form=$("#"+id+"-form");$form.toggleClass("hide");});$(".qd-tooltip-trigger").live("mouseover mouseout",function(evt){var $target=$(evt.target),leftPos=$(this).parent(".label").find("label").width()+45;if(evt.type==="mouseout"){$(this).parent(".label").find(".rco-tooltip").hide();}else{$(this).parent(".label").find(".rco-tooltip").show().css({left:leftPos,top:-20});}});RCO.ui.modal.init($(".learn-more-modal"),{width:770,onComplete:function(){$(".change-donation-option").click(function(){var $this=$(this),causeId=$this.data("donation-id"),donationTabId=$this.data("donation-content"),$activeTab=$("#donation-content-"+donationTabId),$donationSupportButton=$activeTab.find(".button");$(".change-donation-option").removeClass("active");$(this).addClass("active");$(".change-donation-content").removeClass("active");$activeTab.addClass("active");if($donationSupportButton.data("support-id")!=causeId){$donationSupportButton.attr("data-support-id",causeId);}else{}$donationSupportButton.bind("click",function(){var selectedId=$(this).data("support-id"),$selectedOption=$("#donation-support-options").find("[data-donation-text='"+selectedId+"']");$selectedOption.trigger("click");$.fn.colorbox.close();});});RCO.exec.donate.urlParamsUtil.init($(".change-donation-modal"));}});},quickDonateLanding:function(){RCO.exec.donate.gtmDataGathering();$(".toggle-qd-donation-view").click(function(){var tributeType=$("#tribute-type");if(tributeType.prop("value")=="In Honor of"){$("#ecardTypeDiv-InHonor ul li:first").addClass("selected");$("#ecardTypeDiv-InMemory").hide();$("#ecardTypeDiv-InHonor").show();}if(tributeType.prop("value")=="In Memory of"){$("#ecardTypeDiv-InMemory ul li:first").addClass("selected");$("#ecardTypeDiv-InHonor").hide();$("#ecardTypeDiv-InMemory").show();}});var modalError=$("[data-modalerror]");RCO.ui.progress.init();RCO.exec.donate.quickDonateDollarHandles();RCO.exec.donate.quickDonateSupportOptions();RCO.ui.modal.init($(".sign-in-modal"),{width:450,onComplete:RCO.exec.donate.forgotPasswordModal});if(modalError.length>0){modalError[0].click();}if($("[data-signInModal]").length>0){$("[data-signInModal]").click();}RCO.exec.donate.registerToggleTributeSection();$("#quickDonateBtn").bind("click",function(event){var skuPos=RCO.exec.donate.util.findSelectedDollarHandle().pos;$("#dollarHandleIndex").val(skuPos);});},quickdonateAlternateLanding:function(){var modalError=$("[data-modalerror]");RCO.ui.progress.init();RCO.exec.donate.gtmDataGathering();RCO.exec.donate.quickDonateDollarHandles();RCO.exec.donate.quickDonateSupportOptions();RCO.exec.donate.registerSwapPaymentType();RCO.exec.donate.registerToggleTributeSection();RCO.exec.donate.addQuickDonateToolTip();RCO.exec.donate.quickdonateToCharitableSwitch.init();$("#quickDonateBtn").bind("click",RCO.exec.donate.paymentMultiSubmitHandler.preventMultiSubmission);$("#paypal-donate").bind("click",RCO.exec.donate.paymentMultiSubmitHandler.preventMultiSubmission);$("#monthly-donation").live("click",RCO.exec.donate.donateButtonTextUpdate);if($("#monthly-donation").is(":checked")){var expandableWrap=$("#"+$("#monthly-donation").attr("id")+"-form");expandableWrap.removeClass("hide");}else{var expandableWrap=$("#"+$("#monthly-donation").attr("id")+"-form");expandableWrap.addClass("hide");}if($("#quick-donation-tribute").is(":checked")){var expandableWrap=$("#"+$("#quick-donation-tribute").attr("id")+"-form");expandableWrap.removeClass("hide");}else{var expandableWrap=$("#"+$("#quick-donation-tribute").attr("id")+"-form");expandableWrap.addClass("hide");}RCO.ui.modal.init($(".rco-login-modal"),{width:450,onComplete:RCO.exec.donate.forgotPasswordModal});if(modalError.length>0){modalError[0].click();}if($("[data-signInModal]").length>0){$("[data-signInModal]").click();}window.setSkuIdToBeanElement=function(){var radioSku=$("input[name='donationAmount']:checked");if(radioSku.length>0){var selectedSkuId=radioSku.val();$("#qd-sku-id").attr("value",selectedSkuId);}};$("input[name='paymentMethod']").change(function(){var changedElement=$(this);if(changedElement.is(":checked")){$("#payment-method").val(changedElement.val());}});if($("#card-number").length>0){RCO.exec.donate.registerShowCreditCardType($("#card-number"));}var otherAmntValue=$("#other-donation-amount").val();try{if(Number(otherAmntValue)==0){$("#other-donation-amount").val("");}}catch(ex){}RCO.exec.donate.masterPassCheckout.init("qd-alt");if($("#masterPassPaymentErrorPage").length>0){$("#masterpass-method").click();}},forgotPasswordModal:function(e){var tempTributeperson=$(".tribute-person").val();var tempTributeVariableAmt=$("#other-donation-amount").val();var tempTributeSkuId=$("#tdDonationSkuId").val();var tempTributeGiftType=$("#tdGiftType").val();var tempTributeDonationTiming=$("#tdDonationRecurrance").val();$("#tributePerson").val(tempTributeperson);$("#tributeOption").val(tempTributeGiftType);$("#tributeSkuId").val(tempTributeSkuId);$("#tributeVariableAmt").val(tempTributeVariableAmt);$("#tributeDonationTiming").val(tempTributeDonationTiming);var modalHeadText=$("#modal-header").text();$("#qdSuccess").css("display","none");RCO.ui.modal.resize();$(".forgot-pw-trigger").click(function(){var $loginWrap=$(this).parents(".login-modal-wrap");$loginWrap.toggleClass("show-forgot-password");$.fn.colorbox.resize();$("#modal-header").text("Forgot Password");return false;});$("#loginModalOkBtn").click(function(){$.fn.colorbox.close();});if(".login-form #qdLoginFormId"){var oneClickModalSignIn=RCO.exec.common.signInModal;var getStaySignedInVal=$("#stay-signed-in");var signedInVal=function(){getStaySignedInVal.bind("click",function(){var signedIn=$("#stay-signed-in").prop("checked");if(signedIn){$("#stay-signed-in").prop("value",true);}else{$("#stay-signed-in").prop("value",false);}});};signedInVal();$(".login-form #qdLoginFormId").bind("submit",function(e){oneClickModalSignIn.validateForm(e);});$(".captcha-box form").bind("submit",function(e){oneClickModalSignIn.validateForm(e);});}if(".forgot-pw-form #qdForgotPwdFormId"){$(".forgot-pw-form #qdForgotPwdFormId").bind("submit",function(e){e.preventDefault();var signIn=this;signIn.$form=$(e.target);var signInfields=signIn.$form.find("input");$.post(signIn.$form.attr("action"),signInfields,function(response){if(response.notifications.errors){signIn.errors=signIn.$form.find(".invalid-box");signIn.errors.find(".error-list").empty();$.each(response.notifications.errors[0].messages,function(idx,error){signIn.errors.find(".error-list").append("<li>"+error+"</li>");});signIn.errors.show();RCO.ui.modal.resize();}else{$("#qdSuccess").show();$("#modal-header").text("Check Your Email");$("#qdForgotPwdFormId").css("display","none");RCO.ui.modal.resize();}});});}},donateRenderECardPreview:function(){var keyElements=$(".ecard-preview").find("[data-key]");var donationSelection=$('#donation-selection option:selected, input[name="donationPick"]');var donateSelected="";if(donationSelection.attr("name")==="donationPick"){donateSelected=donationSelection.val();donationSelection=donationSelection.parent();}else{donateSelected=donationSelection.val();}for(var i=0;i<keyElements.length;i++){var element=keyElements.eq(i);var key=element.data("key");var defaultValue=element.data("default");if(!defaultValue){defaultValue=element.text();element.data("default",defaultValue);}var value="";switch(key){case"donationArea":if(donationSelection.length){value=donationSelection.text().trim().match(/(.*) - /)[1];}else{value=$(".primary-header h1").last().text().replace(/^\s+|\s+$/g,"").split("\n")[0];}var eCardDonationArea=$(".ecard-preview").find("[data-key='donationArea']");eCardDonationArea.html(value);break;case"qd-donationArea":value=$("#donation-cause").val();break;case"donationAreaDescription":var mutliDonationDescription=$(".cause-description."+donateSelected);if(mutliDonationDescription.length){value=$(".cause-description."+donateSelected).text();}else{value=$(".cause-description .accordion-content").text();}var eCardDonationDesc=$(".ecard-preview").find("[data-key='donationAreaDescription']");eCardDonationDesc.html(value);break;case"ecard-message":value=$("input, select, textarea").filter("#"+key).last().val();if(value===""){element.hide();}else{element.show();}var eCardMessage=$(".ecard-preview").find("[data-key='ecard-message']");eCardMessage.html(value);break;case"first-name":value=$("input, select, textarea").filter("#"+key+":visible").last().val();var eCardFirstName=$(".ecard-preview").find("[data-key='first-name']");if(value==""){value="[Your Name]";}eCardFirstName.html(value);break;case"last-name":value=$("input, select, textarea").filter("#"+key+":visible").last().val();var eCardLastName=$(".ecard-preview").find("[data-key='last-name']");eCardLastName.html(value);break;case"tribute-type":value=$("input, select, textarea").filter("#"+key).last().val().toLowerCase();var eCardTributeType=$(".ecard-preview").find("[data-key='tribute-type']");eCardTributeType.html(value);break;case"tribute-name":value=$("input, select, textarea").filter("#"+key).last().val();if(value=="Honoree or Event Name"){value="";}var eCardTributeName=$(".ecard-preview").find("[data-key='tribute-name']");eCardTributeName.html(value);break;default:value=$("input, select, textarea").filter("#"+key).last().val();break;}}},donateChangeTributeViewMode:function(e){e.preventDefault();var modalData=RCO.ui.modal.getData();if(modalData.targetUrl.indexOf("mode=preview")!==-1){modalData.closeModal();}else{var tributeViewModes=$(".tribute-modal");tributeViewModes.toggle();RCO.exec.donate.donateRenderECardPreview();$.fn.colorbox.resize({innerWidth:modalData.width,innerHeight:modalData.height});}},donateInitTributeModalLink:function(){var colorBoxContent=$("#cboxContent"),tributeModalLink=$(".open-modal-tribute"),modalData=RCO.ui.modal.getData();var tributeType=$("#tribute-type");var tributeName=$("#tribute-name");var tributeFields=$("#tribute-type:visible, #tribute-name:visible");if((!!tributeFields.data("events")&&!tributeFields.data("events").blur)||!tributeFields.data("events")){tributeName.blur(function(){if(tributeName.val().length>0){$("#ecard-subject").val(tributeType.val()+" "+tributeName.val());}else{$("#ecard-subject").val("");}});tributeType.blur(function(){if(tributeName.val().length>0){$("#ecard-subject").val(tributeType.val()+" "+tributeName.val());}else{$("#ecard-subject").val("");}});}function checkAndFillDate(){var today=new Date();today=today.getMonth()+1+"/"+today.getDate()+"/"+today.getFullYear();var formDateField=$('[name="fromDate"]');if(formDateField.length>0){for(var i=0;i<formDateField.length;i++){var iField=formDateField.eq(i);if(iField.val().length===0){iField.val(today);}}}}function tributeCallback(modalData){var tributeForm=colorBoxContent.find("#tribute-form");var tributeViewModes=$(".tribute-modal");$("#cboxClose").hide();checkAndFillDate();if(modalData.targetUrl.indexOf("mode=preview")!==-1){tributeViewModes.eq(0).hide();tributeViewModes.eq(1).show();RCO.exec.donate.donateRenderECardPreview();}else{tributeViewModes.eq(1).hide();tributeViewModes.eq(0).show();}$("#cboxClose").hide();RCO.ui.validate.current=RCO.ui.validate.init(tributeForm,{submitHandler:function(){setTribute(tributeForm);tributeForm.get(0).submit();return false;}});if($(".remove-card-trigger").length>0){$(".remove-card-trigger").bind("click",function(){var remove=confirm("Are you sure you don't want to send a card?");if(remove){$.fn.colorbox.close();}});$(".send-card-later").bind("click",function(){alert("Check your email for details on sending a card for this donation later.");$.fn.colorbox.close();});}RCO.ui.form.datePicker(colorBoxContent.find(".date-pickers-wrap"));RCO.ui.donationTribute(colorBoxContent);RCO.exec.donate.donateInitTributeModalLink();$.fn.colorbox.resize({innerWidth:modalData.width,innerHeight:modalData.height});}var modalHeight=0;if($.browser.msie){modalHeight=875;}else{modalHeight=850;}for(var i=0;i<tributeModalLink.length;i++){var link=$(tributeModalLink[i]);if(!link.data("events")){if(typeof modalData==="undefined"||!modalData.modalOpening){RCO.ui.modal.init(link,{width:650,height:modalHeight,onComplete:tributeCallback});}else{link.bind("click",RCO.exec.donate.donateChangeTributeViewMode);}}}checkAndFillDate();},changeDonateAmountModal:function(){RCO.ui.modal.init($(".qd-change-amount-modal"),{width:548,onComplete:function(){RCO.exec.donate.quickDonateDollarHandles();RCO.exec.donate.quickDonateChangeCart();RCO.exec.donate.urlParamsUtil.init($("#quickDOnateChangeAmntFOrm"));if($("#monthly-donation").attr("checked")){$("#monthly-donation-form").toggleClass("hide");$.colorbox.resize();}$(".toggle-donation-view").click(function(){var id=$(this).attr("id");$("#"+id+"-form").toggleClass("hide");$.colorbox.resize();});$(".quickdonation-options").find(".button").click(function(){});var cardMonth=$("#card-month").val();var cardYear=$("#card-year").val();var billAddress1=$("#creditCardQuick-addressOne").val();var billAddress2=$("#creditCardQuick-addressTwo").val();var billCity=$("#creditCardQuickCity").val();var billState=$("#creditCardQuickState").val();var billPostalCode=$("#creditCardQuickZipCode").val();var saveCCCheck=$("#save-info").is(":checked");$("#cardMonth").val(cardMonth);$("#cardYear").val(cardYear);$("#billAddress1").val(billAddress1);$("#billAddress2").val(billAddress2);$("#billCity").val(billCity);$("#billState").val(billState);$("#billPostalCode").val(billPostalCode);$("#saveCCCheck").val(saveCCCheck);}});},gtmDataGathering:function(){if($("#data-gtm-ecomm-track-backend").length>0){if(!($("#data-gtm-ecomm-track-backend").val()=="")){gtmTrackTheCart();}}},quickDonatePayment:function(){RCO.exec.donate.addQuickDonateToolTip();RCO.exec.donate.initLoginModal();RCO.exec.donate.quickdonateToCharitableSwitch.init();$("#quickDonateBtn").bind("click",RCO.exec.donate.paymentMultiSubmitHandler.preventMultiSubmission);$("#paypal-donate").bind("click",RCO.exec.donate.paymentMultiSubmitHandler.preventMultiSubmission);if($("#paypal-method").is(":checked")){$(".payment-method-section").removeClass("current");$("#paypal-section").addClass("current");RCO.exec.donate.donateFormValidator.toggleCCValidations();}$(".payment-method-toggle").click(function(){var sectionId=$(this).data("section-id");$(".payment-method-section").removeClass("current");$("#"+sectionId+"-section").addClass("current");RCO.exec.donate.donateFormValidator.toggleCCValidations();});RCO.exec.donate.changeDonateAmountModal();if($("#card-number").length>0){RCO.exec.donate.registerShowCreditCardType($("#card-number"));}RCO.exec.donate.masterPassCheckout.init("qd");if($("#masterPassPaymentErrorPage").length>0){$("#masterpass-method").click();}},paymentMultiSubmitHandler:{blockedTriggerIds:new Array(),checkIfClicked:function(id){var blockedTriggerIds=this.blockedTriggerIds;return blockedTriggerIds.indexOf(id)>=0?true:false;},registerClick:function(id){this.blockedTriggerIds.push(id);},preventMultiSubmission:function(){var element=this;var buttonCLicked=RCO.exec.donate.paymentMultiSubmitHandler.checkIfClicked(element.id);log(element.id+"newCreditCardButtonBlocked : "+buttonCLicked);if(buttonCLicked){return false;}RCO.exec.donate.paymentMultiSubmitHandler.registerClick(this.id);},unregisterClick:function(id){this.blockedTriggerIds.splice(this.blockedTriggerIds.indexOf(id),1);}},donatePayment:function(){var isWalletReview=$("#isWalletReviewPage").length>0;if(!isWalletReview){if($(".paymentMethod").length>0){$(".paymentMethod").click(function(){if($("#errorMessageList").length>0){$("#errorMessageList .error").html("");}});}var multisubmitPreventModule=RCO.exec.donate.paymentMultiSubmitHandler;$("#newCreditCardSubmit").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#creditCardSubmit1").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#creditCardSubmit2").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#creditCardSubmit3").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#creditCardSubmit4").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#paypalBtn").bind("click",multisubmitPreventModule.preventMultiSubmission);}var colorBoxContent=$("#cboxContent"),sidebar=$(".payment-secondary"),recurringModalLink=sidebar.find(".open-modal-recurring"),modalError=$("[data-modalerror]");function cacheProperties(form){var allRecurring=sidebar.find(".recurringFlag"),allTribute=sidebar.find(".tributeFlag, .tributeTypeFlag, .tributeNameFlag");form.prepend(allRecurring.add(allTribute));}function setRecurring(){var form=$(this),recurringToggle=form.find("#toggle-recurring"),currentName=recurringToggle.attr("name"),isRecurring=recurringToggle.prop("checked");sidebar.find(".recurringFlag[name="+currentName+"]").val(isRecurring);cacheProperties(form);}function setTribute(_form){var form=_form||$("#tribute-form"),donationPicker=form.find("[name=donationPick]"),selectedDonation=donationPicker.val(),removeDonation=form.find("[name=removeDonation]").val();if(removeDonation==="true"){sidebar.find(".tributeFlag[name="+selectedDonation+"]").val("false");}else{sidebar.find(".tributeFlag[name="+selectedDonation+"]").val("true");}cacheProperties(form);}function removeTribute(){var form=$(this).closest("#tribute-form"),submitButton=form.find("input[type=submit]"),removeDonation=form.find("[name=removeDonation]");removeDonation.val("true");form.find("input, textarea, select").each(function(){$(this).rules("remove");});submitButton.trigger("click");return false;}function tributeCallback(modalData){var tributeForm=colorBoxContent.find("#tribute-form");var today=new Date();today=today.getMonth()+1+"/"+today.getDate()+"/"+today.getFullYear();var formDateField=$('[name="fromDate"]');if(formDateField.val().length===0){formDateField.val(today);}var tributeViewModes=$(".tribute-modal");if(modalData.targetUrl.indexOf("mode=preview")!==-1){tributeViewModes.eq(0).hide();}else{tributeViewModes.eq(1).hide();}$.colorbox.resize();RCO.ui.validate.current=RCO.ui.validate.init(tributeForm,{submitHandler:function(){setTribute(tributeForm);tributeForm.get(0).submit();return false;}});RCO.ui.form.datePicker(colorBoxContent.find(".date-pickers-wrap"));RCO.ui.donationTribute(colorBoxContent);}colorBoxContent.delegate("#recurring-form","submit",setRecurring);colorBoxContent.delegate("#tribute-form .remove-tribute a","click",removeTribute);var modalHeight=0;if($.browser.msie){modalHeight=875;}else{modalHeight=800;}RCO.ui.modal.init(recurringModalLink,{width:570,height:modalHeight,onComplete:function(){RCO.exec.donate.urlParamsUtil.init($("#recurring-form1"));}});RCO.exec.donate.donateInitTributeModalLink();RCO.ui.form.paymentMethods();if($("#recurring-error").length>0){recurringModalLink.click();}if($("#tribute-error").length>0){tributeModalLink.click();}if(modalError.length>0){modalError.eq(0).click();}if($(".radioCardSelector").length>0){$(".radioCardSelector").click(function(){if($("#errorMessageList").length>0){$("#errorMessageList .error").html("");}});}if($(".coupon-form").length>0){$(".coupon-form").bind("submit",function(event){if($("#paypal-method").is(":checked")){$("#selectedPaymentType").val("paypal");}else{$("#selectedPaymentType").val("cc");}});}if($("#selectedPaymentType").length>0&&$("#selectedPaymentType").val()=="paypal"){$("#paypal-method").get(0).click();}RCO.exec.donate.masterPassCheckout.init();},donateAmount:function(){var wrapper=$(".donation-amount-options"),skuButtons=wrapper.find(".skuButton"),fieldWrap=wrapper.find(".field-wrap"),selectClass="selected";RCO.exec.donate.quickDonateDollarHandles();fieldWrap.each(function(){var thisWrap=$(this),toggle=thisWrap.find("label"),allRadio=thisWrap.find(".tribute-radio");if(thisWrap.find(".tribute-radio").is(":checked")){thisWrap.addClass(selectClass);}if(thisWrap.hasClass(selectClass)){thisWrap.find(".tribute-radio").attr("checked","checked");}toggle.bind("click",function(){var $self=$(this),$currentWrap=$self.parents(".dedicate-options-group");if(thisWrap.hasClass("onetimeButton")){$(".fieldWrapper").removeClass("perMonthCaptionSku");}if($(this).attr("class")=="currentSelection"){var labelDisplayed=$(this).attr("for");if(labelDisplayed=="in honor of"||labelDisplayed=="in memory of"){if($(this).parents(".selected").length){$(this).parents(".field-wrap").find(".tribute-radio").removeAttr("checked");$(this).parents(".field-wrap").removeClass(selectClass);this.parent().removeClass(selectClass);}}}allRadio.removeAttr("checked");$currentWrap.find(".tribute-radio").attr("checked","checked");$currentWrap.find(".tribute-radio").removeAttr("checked");thisWrap.find(".tribute-radio").attr("checked","checked");$currentWrap.find(".field-wrap").removeClass(selectClass);thisWrap.addClass(selectClass);skuButtons.each(function(){var skuButtonWrap=$(this);if((wrapper.find(".monthlyButton").hasClass(selectClass))&&(skuButtonWrap.hasClass(selectClass))){skuButtonWrap.parents(".fieldWrapper").find(".perMonthCaption").removeClass("hide");$(".fieldWrapper").addClass("perMonthCaptionSku");}else{skuButtonWrap.parents(".fieldWrapper").find(".perMonthCaption").addClass("hide");}});return false;});});var tributeTypeRadioBtn=$('input[name="tributeType"]');var toggleOldFields=function(){tributeTypeRadioBtn.bind("click",function(){$("#errorMessagesDiv").html("");});};toggleOldFields();RCO.ui.progress.init();(function causeDropdown(){var dropdown=$(".change-cause-dropdown"),toggle=dropdown.children(".toggle"),menuWrap=dropdown.children(".menu-wrap"),menu=menuWrap.children(".menu"),selectedCause=menuWrap.children(".selected-cause"),activeClass="active",bdy=$("body");function hideMenu(){dropdown.removeClass(activeClass);toggle.focus();toggle.one("click",showMenu);return false;}function showMenu(){dropdown.addClass(activeClass);menu.css("paddingTop",menuWrap.height());selectedCause.focus();selectedCause.one("click",hideMenu);bdy.one("click",hideMenu);return false;}function setWidth(){var menuWidth=menuWrap.width();menu.css("width",menuWidth);}function preserveMenu(evt){evt.stopPropagation();}toggle.one("click",function(){showMenu();setWidth();return false;});selectedCause.bind("click",function(){return false;});menu.click(preserveMenu);}());(function monthlyDonation(){var amountOptions=$(".donation-amount-options"),monthlyToggle=amountOptions.find("#monthly-donation"),recurringNote=amountOptions.find(".recurring-note"),customAmount=$(".custom-amount-wrap"),hideClass="hide";function checkRecurring(){var checked=monthlyToggle.prop("checked");if(!!checked){$(customAmount).stop(true,true).animate({marginTop:"24px"});recurringNote.removeClass(hideClass);}else{$(customAmount).stop(true,true).animate({marginTop:"8px"});recurringNote.addClass(hideClass);}}monthlyToggle.click(checkRecurring);checkRecurring();})();function toggleTributeForm(evt){var checkbox=$(evt.target),form=$("#"+checkbox.attr("id")+"-form");if(checkbox.is(":checked")){form.removeClass("hide");}else{form.addClass("hide");}}(function(){var expandableWrap=$(".cause-description"),tributeCheckbox=$("#donation-tribute"),tributeType=$("#tribute-type"),tributeName=$("#tribute-name");function doCheck(){tributeCheckbox.prop("checked",true);toggleTributeForm({target:tributeCheckbox.get()});}function swapTributeName(){if(tributeType.prop("value")=="In Honor of"){$("#ecardTypeDiv-InMemory ul li").removeClass("selected");$("#pcardTypeDiv-InMemory ul li").removeClass("selected");$("#ecardTypeDiv-InHonor ul li").removeClass("selected");$("#pcardTypeDiv-InHonor ul li").removeClass("selected");$("#ecardTypeDiv-InHonor ul li:first").addClass("selected");$("#pcardTypeDiv-InHonor ul li:first").addClass("selected");$("#ecardTypeDiv-InMemory").hide();$("#pcardTypeDiv-InMemory").hide();$("#ecardTypeDiv-InHonor").show();$("#pcardTypeDiv-InHonor").show();}if(tributeType.prop("value")=="In Memory of"){$("#ecardTypeDiv-InHonor ul li").removeClass("selected");$("#pcardTypeDiv-InHonor ul li").removeClass("selected");$("#ecardTypeDiv-InMemory ul li").removeClass("selected");$("#pcardTypeDiv-InMemory ul li").removeClass("selected");$("#ecardTypeDiv-InMemory ul li:first").addClass("selected");$("#pcardTypeDiv-InMemory ul li:first").addClass("selected");$("#ecardTypeDiv-InHonor").hide();$("#pcardTypeDiv-InHonor").hide();$("#ecardTypeDiv-InMemory").show();$("#pcardTypeDiv-InMemory").show();}}RCO.ui.expandable(expandableWrap,{initial:"hide"});RCO.ui.form.datePicker();RCO.ui.donationTribute($("#donation-tribute-form"));tributeCheckbox.change(toggleTributeForm);tributeType.change(swapTributeName);tributeCheckbox.click(swapTributeName);tributeName.focus(doCheck);toggleTributeForm({target:tributeCheckbox.get()});})();RCO.exec.donate.donateInitTributeModalLink();$("#custom-amount").keydown(function(){$("#amount-custom").prop("checked",true);});},quickDonateAmount:function(){RCO.exec.donate.gtmDataGathering();var multisubmitPreventModule=RCO.exec.donate.paymentMultiSubmitHandler;$("#quickDonateBtn").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#paypal-donate").bind("click",multisubmitPreventModule.preventMultiSubmission);RCO.exec.donate.registerSwapPaymentType();RCO.exec.donate.registerToggleTributeSection();if($(".toggle-qd-donation-view").prop("checked")){$("#quick-donation-tribute-form").removeClass("hide");}if($("#qd-combinedView").length>0){jQuery("#monthly-donation").live("click",RCO.exec.donate.donateButtonTextUpdate);RCO.exec.donate.donateButtonTextUpdate();}RCO.exec.donate.donateInitTributeModalLink();RCO.exec.donate.addQuickDonateToolTip();RCO.exec.donate.quickDonateDollarHandles();RCO.exec.donate.quickDonateSupportOptions();RCO.exec.donate.initLoginModal();RCO.exec.donate.changeDonateAmountModal();},donateCombined:function(){this.donateAmount();this.donatePayment();var i=1;while(true){var creditCard=$("#creditCardSubmit"+i);if(creditCard.length!=0){var count=i;creditCard.bind("click",function(){var checkBoxCount=1;while(true){var checkBoxField=$("#credit-card-"+checkBoxCount);if(checkBoxField.length==0){break;}if(!(checkBoxField.is(":checked"))){$("#ccNickName"+checkBoxCount).prop("disabled","disabled");$("#ccType"+checkBoxCount).prop("disabled","disabled");$("#ccNumber"+checkBoxCount).prop("disabled","disabled");$("#subId"+checkBoxCount).prop("disabled","disabled");$("#expMonth"+checkBoxCount).prop("disabled","disabled");$("#expYear"+checkBoxCount).prop("disabled","disabled");$("#ccHolderName"+checkBoxCount).prop("disabled","disabled");$("#billFirstName"+checkBoxCount).prop("disabled","disabled");$("#billLastName"+checkBoxCount).prop("disabled","disabled");$("#billAdd1"+checkBoxCount).prop("disabled","disabled");$("#billAdd2"+checkBoxCount).prop("disabled","disabled");$("#billCity"+checkBoxCount).prop("disabled","disabled");$("#billState"+checkBoxCount).prop("disabled","disabled");$("#billZipCode"+checkBoxCount).prop("disabled","disabled");$("#billCountry"+checkBoxCount).prop("disabled","disabled");$("#billPhoneNumber"+checkBoxCount).prop("disabled","disabled");$("#billEmail"+checkBoxCount).prop("disabled","disabled");$("#cvvNumber"+checkBoxCount).prop("disabled","disabled");}checkBoxCount++;}$("#paymentID #subId").prop("disabled","disabled");$("#paymentID #ccNumber").prop("disabled","disabled");$("#paymentID #nick-name").prop("disabled","disabled");$("#paymentID #ccType").prop("disabled","disabled");$("#paymentID #card-number").prop("disabled","disabled");$("#paymentID #expiration-month").prop("disabled","disabled");$("#paymentID #expiration-year").prop("disabled","disabled");$("#paymentID #name").prop("disabled","disabled");$("#paymentID #cvvNumber").prop("disabled","disabled");$("#paymentID #first-name").prop("disabled","disabled");$("#paymentID #last-name").prop("disabled","disabled");$("#paymentID #address-line-1").prop("disabled","disabled");$("#paymentID #address-line-2").prop("disabled","disabled");$("#paymentID #city").prop("disabled","disabled");$("#paymentID #state").prop("disabled","disabled");$("#paymentID #postal-code").prop("disabled","disabled");$("#paymentID #country").prop("disabled","disabled");$("#paymentID #billPhoneNumber").prop("disabled","disabled");$("#paymentID #email").prop("disabled","disabled");$("#paymentID #email-updates").prop("disabled","disabled");$("#paymentID #hidden-email").prop("disabled","disabled");});}else{break;}i++;}var newCreditCard=$("#newCreditCardSubmit");newCreditCard.bind("click",function(){var NewRdButton=$("[name='useSavedCard']");var newCount=0;NewRdButton.each(function(i){newCount=newCount+1;$("#ccNickName"+newCount).prop("disabled","disabled");$("#ccType"+newCount).prop("disabled","disabled");$("#ccNumber"+newCount).prop("disabled","disabled");$("#subId"+newCount).prop("disabled","disabled");$("#expMonth"+newCount).prop("disabled","disabled");$("#expYear"+newCount).prop("disabled","disabled");$("#ccHolderName"+newCount).prop("disabled","disabled");$("#billFirstName"+newCount).prop("disabled","disabled");$("#billLastName"+newCount).prop("disabled","disabled");$("#billAdd1"+newCount).prop("disabled","disabled");$("#billAdd2"+newCount).prop("disabled","disabled");$("#billCity"+newCount).prop("disabled","disabled");$("#billState"+newCount).prop("disabled","disabled");$("#billZipCode"+newCount).prop("disabled","disabled");$("#billCountry"+newCount).prop("disabled","disabled");$("#billPhoneNumber"+newCount).prop("disabled","disabled");$("#billEmail"+newCount).prop("disabled","disabled");$("#cvvNumber"+newCount).prop("disabled","disabled");});});},quickDonateConfirmation:function(){var submitDonation=$("[data-submitDonation]");RCO.ui.printerFriendlyTranscript("#printable-tax-receipt");RCO.exec.donate.donateInitTributeModalLink();if(submitDonation.length>0){submitDonation.eq(0).click();}},donateConfirmation:function(){RCO.exec.donate.gtmDataGathering();RCO.ui.printerFriendlyTranscript("#printable-tax-receipt");RCO.exec.donate.tributeLightBox.init();},donateShoppingCart:function(){RCO.exec.donate.gtmDataGathering();RCO.ui.addDonation();$(".tooltip-summary").live("mouseover mouseout",function(evt){var $target=$(evt.target),$objToolTipPos=$(this).find(".tooltipdrop").position(),leftPos=$objToolTipPos.left+$(this).find(".tooltipdrop").width()+20,topPos=$objToolTipPos.top-60;if($(window).scrollTop()+$(window).height()<$objToolTipPos.top+$(this).find(".tooltip-body").height()+200){topPos=topPos-$(this).find(".tooltip-body").height()+100;$(this).find(".bg-arrow").css("top","auto").css("bottom",60);}else{$(this).find(".bg-arrow").css("top",60);}if(evt.type==="mouseout"){$(this).children(".tooltip-body").hide();}else{$(this).children(".tooltip-body").show().css({left:leftPos,top:topPos});}});},tributeDonate:function(){var wrapper=$(".dedicate-radio-options"),fieldWrap=wrapper.find(".field-wrap");RCO.exec.donate.quickDonateDollarHandles();if($("[data-signInModal]").length>0){RCO.ui.modal.init($(".sign-in-modal"),{width:450,onComplete:RCO.exec.donate.forgotPasswordModal});$(".sign-in-modal").click();}fieldWrap.each(function(){var thisWrap=$(this),toggle=thisWrap.find("label"),allRadio=thisWrap.find(".tribute-radio"),selectClass="selected";if(thisWrap.hasClass(selectClass)){thisWrap.find(".tribute-radio").attr("checked","checked");}toggle.bind("click",function(){var $self=$(this),$currentWrap=$self.parents(".dedicate-radio-options");allRadio.removeAttr("checked");$currentWrap.find(".tribute-radio").attr("checked","checked");$currentWrap.find(".tribute-radio").removeAttr("checked");thisWrap.find(".tribute-radio").attr("checked","checked");$currentWrap.find(".field-wrap").removeClass(selectClass);thisWrap.addClass(selectClass);return false;});});$(".selectedGiftType").click(function(){var tempGiftType=$(this).html().trim();if(tempGiftType=="In Honor of"){$("#tdGiftType").val(1);}if(tempGiftType=="In Memory of"){$("#tdGiftType").val(2);}$("#tributeGiftOption").val($("#tdGiftType").val());});$(".td-twenty-five-link").click(function(){var tdSkuId=$(this).find(".tdSkuId").html();$("#tdDonationSkuId").val(tdSkuId);});$(".variable-sku").click(function(){var tdSkuId=$(this).find(".tdSkuId").html();$("#tdDonationSkuId").val(tdSkuId);});$(".selectedDonationTiming").click(function(){var tempDonationTiming=$(this).html().trim();if(tempDonationTiming=="one-time"){$("#tdDonationRecurrance").val(false);}if(tempDonationTiming=="monthly"){$("#tdDonationRecurrance").val(true);}});$(".tribute-payment-method-toggle").click(function(){var sectionId=$(this).data("section-id");$(".method").removeClass("active");$(this).parent().addClass("active");$(".payment-method-section").removeClass("current");$("#"+sectionId+"-section").addClass("current");});$(".change-payment-method").click(function(){$(".saved-payment-info").removeClass("returning");$(".enter-payment-info").removeClass("hide");});$(".change-payment-method").click(function(){$("#ccActiontd").prop("disabled","disabled");$("#ccNickNameqd").prop("disabled","disabled");$("#ccTypeqd").prop("disabled","disabled");$("#ccNumberqd").prop("disabled","disabled");$("#subIdqd").prop("disabled","disabled");$("#expMonthqd").prop("disabled","disabled");$("#expYearqd").prop("disabled","disabled");$("#billFirstNameqd").prop("disabled","disabled");$("#billLastNameqd").prop("disabled","disabled");$("#billAdd1qd").prop("disabled","disabled");$("#billAdd2qd").prop("disabled","disabled");$("#billCityqd").prop("disabled","disabled");$("#billStateqd").prop("disabled","disabled");$("#billZipCodeqd").prop("disabled","disabled");$("#billCountryqd").prop("disabled","disabled");$("#billPhoneNumberqd").prop("disabled","disabled");$("#billPhoneNumber").prop("disabled","disabled");$("#billEmailqd").prop("disabled","disabled");$("#skipCvvtd").prop("disabled","disabled");$("#saveCardtd").prop("disabled","disabled");});$(".custom-select").change(function(){window.location.href=$("#tributeDonationUrl").val()+$(this).val();});function clearPlaceHolderText(){$("#tributeDonationForm").find(":input").each(function(){if($(this).attr("placeholder")!=undefined&&($(this).attr("placeholder")==$(this).val())){$(this).val("");}});}var tributeDonateButtonClicked=false;var tributeDonateAnonymousButtonClicked=false;var tributePayViaPaypalClicked=false;$("#tributeDonateBtn").click(function(){clearPlaceHolderText();});var multisubmitPreventModule=RCO.exec.donate.paymentMultiSubmitHandler;$("#tributeDonateBtn").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#tributeDonateAnonymousBtn").click(function(){clearPlaceHolderText();$("#receivePhoneUpdates").val($("#creditcard-phone-link").is(":checked"));});var multisubmitPreventModule=RCO.exec.donate.paymentMultiSubmitHandler;$("#tributeDonateAnonymousBtn").bind("click",multisubmitPreventModule.preventMultiSubmission);$("#tributeDonatePayPalBtn").click(function(){clearPlaceHolderText();$("#receivePhoneUpdates").val($("#paypal-phone-link").is(":checked"));});$("#tributeDonatePayPalBtn").bind("click",multisubmitPreventModule.preventMultiSubmission);RCO.exec.donate.quickDonatePayment();RCO.exec.donate.addQuickDonateToolTip();},quickDonateChangeCart:function(){jQuery(".qd-tooltip-trigger").die("mouseover mouseout");jQuery(".qd-tooltip-trigger").live("mouseover mouseout",function(evt){var leftPos=jQuery(this).parent(".label").find("label").width()+45;if(evt.type==="mouseout"){jQuery(this).parent(".label").find(".rco-tooltip").hide();}else{jQuery(this).parent(".label").find(".rco-tooltip").show().css({left:leftPos,top:-20,width:220});}});var ajaxValidation=true;if(ajaxValidation){$(".changedonationModal").find("#quickDonateBtn").die("click");$(".changedonationModal").find("#quickDonateBtn").live("click",function(evt){$(".changedonationModal").find("input[id='qd-variable-amount']").attr("value",$(".changedonationModal").find("input[id='other-donation-amount']").attr("value"));var radio=$(".other-amount-wrap").find('input[name="donationAmount"]');if(radio&&radio.is(":checked")){evt.preventDefault();$(".changedonationModal").find("input[id='qd-variable-amount']").attr("value",$(".changedonationModal").find("input[id='other-donation-amount']").attr("value"));var params="customAmount="+$(".changedonationModal").find("input[id='other-donation-amount']").attr("value")+"&productId="+$(".changedonationModal").find("input[id='productIdHidden']").attr("value");$.post("/modal/changeDonationCauseAmountModalValidatorAjax.jsp",params,function(response){if(response.error){$(".changeDonationModalError").removeClass("hide");$(".changeDonationModalError").text(response.error);RCO.ui.modal.resize();}else{$(".changedonationModal").get(0).submit();}});}});}else{$(".changedonationModal").find("#quickDonateBtn").die("click");$(".changedonationModal").find("#quickDonateBtn").live("click",function(evt){$(".changedonationModal").find("input[id='qd-variable-amount']").attr("value",$(".changedonationModal").find("input[id='other-donation-amount']").attr("value"));var radio=$(".other-amount-wrap").find('input[name="donationAmount"]');if(radio&&radio.is(":checked")){var varAmnt=$(".changedonationModal").find("input[id='qd-variable-amount']").attr("value");var minAmnt=$("#validationConfigs").find("input[id='minAmnt']").attr("value");var maxAmnt=$("#validationConfigs").find("input[id='maxAmnt']").attr("value");var minAmntMsg=$("#validationConfigs").find("input[id='minAmntMsg']").attr("value");var maxAmntMsg=$("#validationConfigs").find("input[id='maxAmntMsg']").attr("value");var invalidVariableDonationAmountMsg=$("#validationConfigs").find("input[id='invalidVariableDonationAmountMsg']").attr("value");var errorMsg="";if(isNaN(varAmnt)){errorMsg=invalidVariableDonationAmountMsg;}else{if(Number(varAmnt)>Number(maxAmnt)){errorMsg=maxAmntMsg;}else{if(Number(varAmnt)<Number(minAmnt)){errorMsg=minAmntMsg;}}}if(errorMsg!=""){$(".changeDonationModalError").removeClass("hide");$(".changeDonationModalError").text(errorMsg);RCO.ui.modal.resize();evt.preventDefault();}}});}$("#quickDOnateChangeAmntFOrm").find("#quickDonateBtn").bind("click",function(event){var skupos=RCO.exec.donate.util.findSelectedDollarHandle().pos;$("#quickDOnateChangeAmntFOrm").find("#dollarHandleIndex").val(skupos);});},getSelectedAmt:function(){var wrapper=$(".fixed-amounts");var selectedLabel=wrapper.find(".selected label a span");var customAmt=wrapper.find(".selected label input");var selectedCustomVal=customAmt.val();if(selectedCustomVal!=undefined&&selectedCustomVal===customAmt.attr("placeholder")){selectedCustomVal="";}return selectedCustomVal||selectedLabel.clone().children().remove().end().text().trim();},donateButtonTextUpdate:function(){if($("#qd-combinedView").length>0||$("#qd-alternate-view").length>0){var buttonText="Donate";var amt=RCO.exec.donate.getSelectedAmt().replace("$","");amt=CurrencyFormatted(amt);if(amt){amt=" $"+amt;}buttonText=buttonText+amt;var checkedFlg=$("#monthly-donation").is(":checked");if(checkedFlg){buttonText=buttonText+" Monthly";}buttonText=buttonText+decodeURIComponent(" &#9656");buttonText=$("<div />").html(buttonText).text();jQuery("#quickDonateBtn").attr("value",buttonText);}},donationLightBox:{closeButton:null,yesButton:null,noButton:null,paymentForm:null,paymentTrigger:null,lighBoxON:0,amountInfo:null,paymentInProgress:false,init:function(){this.repopulateVarAmount();if($("#lightBoxRulesJson").length==0){return;}var paymentForms=$(".cc-payment-form");var submitButtons=paymentForms.find("input[type='submit']");submitButtons.live("click",function(){RCO.exec.donate.donationLightBox.paymentTrigger=$(this);});$(window).bind("beforeunload",function(event){if(RCO.exec.donate.donationLightBox.lighBoxON==1){return RCO.exec.donate.donationLightBox.ajaxFormSubmit();}else{}});RCO.ui.modal.init($(".lightbox-modal"),{width:540,onComplete:function(){var module=RCO.exec.donate.donationLightBox;module.postLightBoxShow();}});},repopulateVarAmount:function(){if($("#lasteSelectedLightBoxOption")&&$("#lasteSelectedLightBoxMonthlyAmount")){if($("#lasteSelectedLightBoxOption").attr("value")=="1"){var otherAmntField=$("#other-donation-amount");if(otherAmntField){try{var monthlyAmnt=Number($("#lasteSelectedLightBoxMonthlyAmount").attr("value"));var varSkuRadio=$(otherAmntField.closest("div")).find("input#skuDonationAmount");if(varSkuRadio.length==0){varSkuRadio=$(otherAmntField.closest("div")).find("input:radio[name='donationAmount']");}varSkuRadio.prop("checked","true");otherAmntField.attr("value",monthlyAmnt.toFixed(2));var checkboxMonthly=$("#monthly-donation");if(!checkboxMonthly.is(":checked")){checkboxMonthly.click();}}catch(e){}}}}},findPaymentTrigger:function(formObj){var submitPoints=formObj.find("input[type=submit]");var primarySubmit=null;for(var idx=0;idx<submitPoints.length;++idx){if(!submitPoints.get(idx).hasClass("ignore-lightbox")){primarySubmit=submitPoints.get(idx);break;}}return $(primarySubmit);},checkIfRecurringDonation:function(formObj){var chkboxEl=formObj.find("#monthly-donation");if(chkboxEl.length>0){return chkboxEl.is(":checked");}chkboxEl=formObj.find("input[name='monthly-donation']:checked");if(chkboxEl.length>0){return chkboxEl.attr("value")=="true";}chkboxEl=formObj.find("input[name='donationTiming']:checked");if(chkboxEl.length>0){return chkboxEl.attr("value")=="true";}return false;},postLightBoxShow:function(){var yesBtn=$("#lightbox-Yes");var noBtn=$("#lightbox-No");var closeBtn=$("#cboxClose");var overlayBlanket=$("#cboxOverlay");yesBtn.bind("click",1,this.formSubmit);noBtn.bind("click",2,this.formSubmit);closeBtn.bind("click",3,this.formSubmit);overlayBlanket.bind("click",3,this.formSubmit);var userSelectedAmount=this.amountInfo.userAmnt;var recurringAmount=this.amountInfo.recAmnt;try{userSelectedAmount=Number(userSelectedAmount).toFixed(2);recurringAmount=Number(recurringAmount).toFixed(2);}catch(e){}noBtn.find(".btnDescription").html($("#lightbox-No").find(".btnDescription").html().replace("?amount?",userSelectedAmount));yesBtn.find(".btnDescription").html($("#lightbox-Yes").find(".btnDescription").html().replace("?amount?",recurringAmount));noBtn.attr("gaLabel","One_Time,$"+userSelectedAmount);noBtn.attr("gaAction","Lightbox_One_Time");yesBtn.attr("gaLabel","Recurring,$"+recurringAmount);yesBtn.attr("gaAction","Lightbox_Recurring");closeBtn.attr("gaAction","Lightbox_Close");},formSubmit:function(event){if(!RCO.exec.donate.donationLightBox.paymentInProgress){RCO.exec.donate.donationLightBox.paymentInProgress=true;var triggerPoint=event.data;var submitButtonId=RCO.exec.donate.donationLightBox.paymentTrigger.attr("id");RCO.exec.donate.paymentMultiSubmitHandler.unregisterClick(submitButtonId);var submitForm=RCO.exec.donate.donationLightBox.paymentForm;submitForm.find("#LightBoxTriggerPoint").attr("value",triggerPoint);if(triggerPoint==1){submitForm.find("#LightBoxconvertToRD").attr("value","true");}if($(this).attr("gaAction")){var gaCategory="Donate_2013";var gaAction=$(this).attr("gaAction");var gaLabel=$(this).attr("gaLabel");if(gaLabel){_GA.trackEvent(gaCategory,gaAction,gaLabel);}else{_GA.trackEvent(gaCategory,gaAction);}}var triggerPoint=RCO.exec.donate.donationLightBox.paymentTrigger;if(triggerPoint.attr("data-ga-caregory")){triggerPoint.removeAttr("data-ga-caregory");}if(triggerPoint.attr("data-ga-action")){triggerPoint.removeAttr("data-ga-action");}triggerPoint.trigger("click");}},checkifInternationalDonation:function(form){var countryField=form.find("#country");if(countryField.length>0&&countryField.is(":visible")){if(countryField.val().toUpperCase()!="US"){return true;}}else{countryField=form.find(".cc-card-addressInfo-country");if(countryField.val().toUpperCase()!="US"){return true;}}return false;},registerLightBoxEventOForm:function(form){var module=this;module.paymentForm=form;if($("#lightBoxRulesJson").length==0){return true;}if(module.checkIfRecurringDonation(form)){return true;}if(module.paymentTrigger==null){module.paymentTrigger=module.findPaymentTrigger(form,event);}if(module.paymentTrigger.hasClass("ignore-lightbox")){return true;}if(module.checkifInternationalDonation(form)){return true;}var lighBoxON=module.lighBoxON;if(lighBoxON==0){var lightBoxRules=eval($("#lightBoxRulesJson").attr("value"));if(lightBoxRules.length==0){return true;}var donationAmount=module.findDonationAmount();if(donationAmount==""){return true;}var recAmount=module.checkIfLightBoxRequired(donationAmount,lightBoxRules);if(recAmount<0){return true;}module.paymentForm.find("input#LightBoxconvertToRD_Amount").attr("value",recAmount);module.amountInfo={userAmnt:donationAmount,recAmnt:recAmount};module.launchLightBox();module.lighBoxON=1;return false;}else{return true;}},ajaxFormSubmit:function(){var module=this;if(!module.paymentInProgress){module.paymentInProgress=true;var signInfields=module.paymentForm.find("input");module.paymentForm.find("#LightBoxTriggerPoint").attr("value","4");var optionFields=module.paymentForm.find("select");var submissionFields=new Array();for(var cnt=0;cnt<signInfields.length;++cnt){var fieldElement=signInfields.get(cnt);var jqfield=jQuery(fieldElement);if(jqfield.is("input:radio")||jqfield.is("input:checkbox")){var isChecked=jqfield.is(":checked");if(isChecked){submissionFields.push(fieldElement);}}else{if(jqfield.is("input:submit")&&jqfield.get(0)==module.paymentTrigger.get(0)){submissionFields.push(fieldElement);}else{submissionFields.push(fieldElement);}}}for(var cnt=0;cnt<optionFields.length;++cnt){var fieldElement=optionFields.get(cnt);submissionFields.push(fieldElement);}var settings={url:module.paymentForm.attr("action"),data:submissionFields,type:"post",async:false,dataType:"json",success:function(response){}};try{module.invokeOnsubmitEvents();}catch(e){}var amount=new String(this.findDonationAmount());var billingInfo=this.findBillingAddressInfo();var itemArray=[];itemArray.push({id:$("#productid_lightbox").attr("value"),name:$("#designationname_lightbox").attr("value"),category:"One-Time",price:amount,quantity:1});dataLayer.push({ecommercePurchaseItems:itemArray});dataLayer.push({ecommercePurchase:{id:$("#orderid_lightbox").attr("value"),affiliation:"Personal Donation",revenue:amount}});dataLayer.push({event:"trackTrans"});jQuery.ajax(settings);}},findBillingAddressInfo:function(){var paymentForm=this.paymentForm;if(paymentForm.find(".cc-card-addressInfo-city").length>0){var cityVal=paymentForm.find(".cc-card-addressInfo-city").attr("value");var stateVal=paymentForm.find(".cc-card-addressInfo-state").attr("value");var countryVal=paymentForm.find(".cc-card-addressInfo-country").attr("value");return{city:cityVal,state:stateVal,country:countryVal};}},findDonationAmount:function(){var checkedSku=jQuery("input[name=donationAmount]:checked");if(checkedSku.length>0){if(checkedSku.attr("data-amount")){return checkedSku.attr("data-amount");}if(jQuery("#other-donation-amount").length>0&&jQuery("#other-donation-amount").attr("value")!=""){return $("#other-donation-amount").attr("value");}if(jQuery("#custom-amount").length>0&&jQuery("#custom-amount").attr("value")!=""){return $("#custom-amount").attr("value");}}if(jQuery("#donationAmountForPaymentPage").length>0){return jQuery("#donationAmountForPaymentPage").attr("value");}return -1;},checkIfLightBoxRequired:function(donationAmount,lbRules){var lightBoxRules=lbRules;for(var i=0;i<lightBoxRules.length;++i){var minAmnt=lightBoxRules[i].minVal;var maxAmnt=lightBoxRules[i].maxVal;if(donationAmount>=minAmnt&&donationAmount<maxAmnt){return lightBoxRules[i].recVal;}}return -1;},launchLightBox:function(){$(".lightbox-modal").click();var lbUrl=$(".lightbox-modal").get(0).href;_GA.trackPageview(lbUrl);_GA.trackEvent("Lightbox","Open",lbUrl);},invokeOnsubmitEvents:function(form){if($("#qd-combinedView").length>0){setOneClickDonationValues();}if($("#qd-paymentpage").length>0){setPaymetTypeArguments();getqdActiveCreditCardType();}if($("#combinedViewAllStep").length>0){setDonationValues();getActiveCreditCardType();}if($("#tributeDonationForm").length>0){setTributeDonationVariableValue();}if($("#qd-alternate-view").length>0){setSkuIdToBeanElement();setOneClickDonationValues();setPaymetTypeArguments();getqdActiveCreditCardType();}}},donateFormValidator:{init:function(){var forms=$(".cc-payment-form");if(forms.length>0){for(var cnt=0;cnt<forms.length;++cnt){this.registerFormValidations(forms.get(cnt));}}},submitTrigger:null,invokeOnsubmitEvents:function(form){if($("#qd-combinedView").length>0){setOneClickDonationValues();}if($("#qd-paymentpage").length>0){setPaymetTypeArguments();getqdActiveCreditCardType();}if($("#combinedViewAllStep").length>0){setDonationValues();getActiveCreditCardType();}if($("#tributeDonationForm").length>0){setTributeDonationVariableValue();}if($("#qd-alternate-view").length>0){setSkuIdToBeanElement();setOneClickDonationValues();setPaymetTypeArguments();getqdActiveCreditCardType();}},ignoreCSV:false,invokeCustomValidations:function(formEl){if($("#enableClientSideValidations").length==0){return true;}if(this.ignoreCSV){return true;}if($("#country").length>0&&!$("div.card-form").hasClass("hide")){var countryVal=$("#country").val();var postalVal=$("#postal-code").val();var phoneVal=$("#billPhoneNumber").val();var stateVal=$("#state").val();var isArmedForces=false;if(stateVal!==""&&stateVal!==null&&stateVal!==undefined&&(stateVal==="AP"||stateVal==="AE"||stateVal==="AA")){isArmedForces=true;}var isErrorFlag=false;if(countryVal=="US"){var usr=/^\+?\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/;if(phoneVal===""||phoneVal===null||phoneVal===undefined||(!usr.test(phoneVal)&&!isArmedForces)){this.showCustomError("Please enter a valid Phone Number.");isErrorFlag=true;}if(postalVal===""||postalVal===null||postalVal===undefined||postalVal.length<5){this.showCustomError("Please enter a valid US zip Code.");isErrorFlag=true;}return !isErrorFlag;}else{if(countryVal=="CA"){var ca=/[a-zA-Z][0-9][a-zA-Z][\s][0-9][a-zA-Z][0-9]/;if(postalVal===""||postalVal===null||postalVal===undefined){this.showCustomError("Please enter a valid Postal Code.");return false;}if(postalVal.length==6){postalVal=[postalVal.slice(0,3)," ",postalVal.slice(3)].join("");}if(postalVal.length!=7||!ca.test(postalVal)){this.showCustomError("Please enter a valid Postal Code.");return false;}$("#postal-code").val(postalVal);}else{if(postalVal!==""&&postalVal!==null&&postalVal!==undefined){if(postalVal.length<3||postalVal.length>10){this.showCustomError("Please enter a valid Postal Code.");return false;}var ipc=/^[a-z\d\-\s]+$/i;if(!ipc.test(postalVal)){this.showCustomError("Please enter a valid Postal Code.");return false;}}}}}if(jQuery("input[name=donationAmount]").length>0){var checkedSku=jQuery("input[name=donationAmount]:checked");if(checkedSku.length>0){var variableSku=jQuery("#other-donation-amount");if(variableSku.length>0&&checkedSku.attr("data-amount")==undefined){if(!variableSku.attr("value")){this.showCustomError("Donation Amount Missing. Please select or enter a donation amount.");return false;}}variableSku=jQuery("#custom-amount");if(variableSku.length>0&&checkedSku.attr("data-amount")==undefined){if(!variableSku.attr("value")){this.showCustomError("Donation Amount Missing. Please select or enter a donation amount.");return false;}}}else{this.showCustomError("Donation Amount Missing. Please select or enter a donation amount.");return false;}}if(window.allowedTypes&&window.allCardTypes){var value=$("#card-number").val();var cardType=null;for(var val in allCardTypes){var cardInfo=allCardTypes[val];var regexp=cardInfo.regex;if(value.match(regexp)){cardType=val;}}if(cardType&&allowedTypes[cardType]=="false"){this.showCustomError($("#notAllowedCCTypeMessage").val());return false;}}return true;},showCustomError:function(errorMsg){if(RCO.exec.donate.donateFormValidator.submitTrigger){RCO.exec.donate.paymentMultiSubmitHandler.unregisterClick(RCO.exec.donate.donateFormValidator.submitTrigger.attr("id"));}var errorDiv=$("div#errorMessageList");var errorEl="<div  class='error'>"+errorMsg+"</div>";errorDiv.append(errorEl);var scrollPos=errorDiv.offset().top;$(window).scrollTop(scrollPos);},registerFormValidations:function(formEl){var formsObj=$(formEl);var submitButtons=formsObj.find("input[type='submit']");submitButtons.live("click",function(){RCO.exec.donate.donateFormValidator.submitTrigger=$(this);});formsObj.validate({onkeyup:false,onclick:false,onblur:false,ignore:".ignore-validations",onfocusout:false,errorElement:"div",errorPlacement:function(error,element){error.appendTo("div#errorMessageList");},invalidHandler:function(event,validator){var error=validator.numberOfInvalids();if(error){if(RCO.exec.donate.donateFormValidator.submitTrigger){RCO.exec.donate.paymentMultiSubmitHandler.unregisterClick(RCO.exec.donate.donateFormValidator.submitTrigger.attr("id"));}}},submitHandler:function(form){if(RCO.exec.donate.donateFormValidator.invokeCustomValidations()){if(RCO.exec.donate.donationLightBox.registerLightBoxEventOForm($(form))){RCO.exec.donate.donateFormValidator.invokeOnsubmitEvents();form.submit();}}else{}}});if($("#enableClientSideValidations").length>0){var elementObj=formsObj.find("input#card-number");if(elementObj.length>0){elementObj.rules("add",{required:true,creditcard:true,messages:{required:"Please enter a valid credit card number",creditcard:"Please enter a valid credit card number"}});}elementObj=formsObj.find("#card-month");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select the card expiration month"}});}elementObj=formsObj.find("#expiration-month");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select the card expiration month"}});}elementObj=formsObj.find("#card-year");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select the card expiration year"}});}elementObj=formsObj.find("#expiration-year");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select the card expiration year"}});}elementObj=formsObj.find("#cvvNumber");if(elementObj.length>0){elementObj.rules("add",{required:true,number:true,messages:{required:"Supply a valid security code for the Credit Card Type Chosen",number:"Supply a valid security code for the Credit Card Type Chosen"}});}elementObj=formsObj.find("#first-name");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid First Name."}});}elementObj=formsObj.find("#last-name");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid Last Name."}});}elementObj=formsObj.find("#address-line-1");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid Address Line 1."}});}elementObj=formsObj.find("#city");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid City."}});}elementObj=formsObj.find("#creditCardQuick-addressOne");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid Address Line 1."}});}elementObj=formsObj.find("#creditCardQuickCity");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid City."}});}elementObj=formsObj.find("#state");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select a valid State."}});}elementObj=formsObj.find("#creditCardQuickState");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select a valid State."}});}elementObj=formsObj.find("#creditCardQuickZipCode");if(elementObj.length>0){elementObj.rules("add",{required:true,number:true,minlength:5,messages:{required:"Please enter a valid zipcode.",number:"Please enter a valid zipcode.",minlength:"Please enter a valid zipcode."}});}elementObj=formsObj.find("#country");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid Country."}});}elementObj=formsObj.find(".cvvValidationClass");if(elementObj.length>0){elementObj.rules("add",{required:true,number:true,messages:{required:"Supply a valid security code for the Credit Card Type Chosen",number:"Supply a valid security code for the Credit Card Type Chosen"}});}elementObj=formsObj.find("#email");if(elementObj.length>0&&!elementObj.is(":hidden")){elementObj.rules("add",{required:true,email:true,messages:{required:"The given email address was invalid",email:"The given email address was invalid"}});}elementObj=formsObj.find("#dedicate-name");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter the name of the person"}});}elementObj=formsObj.find(".cardMonth");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select the card expiration Month."}});}elementObj=formsObj.find(".cardYear");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select the card expiration Year."}});}elementObj=formsObj.find("#creditcard-first-name");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid First Name."}});}elementObj=formsObj.find("#creditcard-last-name");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid Last Name."}});}elementObj=formsObj.find("#creditcard-email-address");if(elementObj.length>0){elementObj.rules("add",{required:true,email:true,messages:{required:"The given email address was invalid",email:"The given email address was invalid"}});}elementObj=formsObj.find("#creditcard-address-1");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid Address Line 1."}});}elementObj=formsObj.find("#creditcard-city");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please enter a valid City."}});}elementObj=formsObj.find("#tributedonate-creditcard-state");if(elementObj.length>0){elementObj.rules("add",{required:true,messages:{required:"Please select a valid State."}});}elementObj=formsObj.find("#creditcard-zipCode");if(elementObj.length>0){elementObj.rules("add",{required:true,number:true,minlength:5,messages:{required:"Please enter a valid zipcode.",number:"Please enter a valid zipcode.",minlength:"Please enter a valid zipcode."}});}elementObj=formsObj.find("#creditcard-cvv");if(elementObj.length>0){elementObj.rules("add",{required:true,number:true,messages:{required:"Supply a valid security code for the Credit Card Type Chosen",number:"Supply a valid security code for the Credit Card Type Chosen"}});}if($(".paypal-wrap")){elementObj=$(".paypal-wrap").find("input");if(elementObj.length>0){elementObj.addClass("ignore-validations");}elementObj=$(".paypal-wrap").find("select");if(elementObj.length>0){elementObj.addClass("ignore-validations");}}if($(".tribute-cc-form").length>0){if(($(".tribute-cc-form").is(":hidden"))){elementObj=$(".tribute-cc-form").find("input");if(elementObj.length>0){elementObj.addClass("ignore-validations");}elementObj=$(".tribute-cc-form").find("select");if(elementObj.length>0){elementObj.addClass("ignore-validations");}$(".change-payment-method").click(function(){var elementObj=$(".tribute-cc-form").find("input");if(elementObj.length>0){elementObj.removeClass("ignore-validations");}elementObj=$(".tribute-cc-form").find("select");if(elementObj.length>0){elementObj.removeClass("ignore-validations");}});}}var csvNonRequiredSubmitPoints=$("#tributeDonatePayPalBtn");if(csvNonRequiredSubmitPoints.length>0){csvNonRequiredSubmitPoints.bind("click",function(){RCO.exec.donate.donateFormValidator.disableValidations($(this));});}csvNonRequiredSubmitPoints=$("#paypalBtn");if(csvNonRequiredSubmitPoints.length>0){csvNonRequiredSubmitPoints.bind("click",function(){RCO.exec.donate.donateFormValidator.disableValidations($(this));});}csvNonRequiredSubmitPoints=$("#paypal-donate");if(csvNonRequiredSubmitPoints.length>0){csvNonRequiredSubmitPoints.bind("click",function(){RCO.exec.donate.donateFormValidator.disableValidations($(this));});}}},toggleCCValidations:function(){if($("#paypal-method").is(":checked")){var ccElements=$(".credit-card-section-wrap").find("input");ccElements.addClass("ignore-validations");ccElements=$(".credit-card-section-wrap").find("select");ccElements.addClass("ignore-validations");RCO.exec.donate.donateFormValidator.ignoreCSV=true;}else{var ccElements=$(".credit-card-section-wrap").find("input");ccElements.removeClass("ignore-validations");ccElements=$(".credit-card-section-wrap").find("select");ccElements.removeClass("ignore-validations");RCO.exec.donate.donateFormValidator.ignoreCSV=false;}},disableValidations:function(trigger){var formEl=trigger.closest("form");var ccElements=formEl.find("input");ccElements.addClass("ignore-validations");ccElements=formEl.find("select");ccElements.addClass("ignore-validations");RCO.exec.donate.donateFormValidator.ignoreCSV=true;}},tributeLightBox:{allowNavigation:true,init:function(){if($("#tribute_lightbox_applicable").length==0){return;}if($("#block_Navigate_Away").length>0){this.allowNavigation=false;}RCO.ui.modal.init($(".confirm-modal"),{width:480,onComplete:function(){RCO.ui.modal.resize();RCO.exec.donate.tributeLightBox.postLightBoxShow();}});$("a#tribute_customize_link").click(function(){RCO.exec.donate.tributeLightBox.allowNavigation=true;});$(window).bind("beforeunload",function(event){if(!RCO.exec.donate.tributeLightBox.allowNavigation){return"You havent chosen when to send the card.";}});var closeBtn=$("#cboxClose");closeBtn.click(function(){if($("#tribute_SendNow").length==0){return;}var gaCategory="Donate";var gaAction="Lightbox_Tribute_Close";_GA.trackEvent(gaCategory,gaAction);});},postLightBoxShow:function(){if($("#tribute_SendNow").length>0){$("#tribute_SendNow").bind("click",function(event){event.preventDefault();var triggerPoint=$("#tribute_customize_link");if(triggerPoint.length>0){if(triggerPoint.attr("data-ga-caregory")){triggerPoint.removeAttr("data-ga-caregory");}if(triggerPoint.attr("data-ga-action")){triggerPoint.removeAttr("data-ga-action");}triggerPoint.get(0).click();}RCO.exec.donate.tributeLightBox.closeModal();});}if($("#tribute_SendLater").length>0){$("#tribute_SendLater").bind("click",function(event){event.preventDefault();var ajaxForm=$("#tributeReminderAjaxForm");RCO.exec.donate.tributeLightBox.allowNavigation=true;ajaxForm.get(0).submit();});}if($("#cancel_tribute_lightbox").length>0){$("#cancel_tribute_lightbox").bind("click",function(event){RCO.exec.donate.tributeLightBox.closeModal();});}},closeModal:function(){var modalData=RCO.ui.modal.getData();modalData.closeModal();}},registerSwapPaymentType:function(){if($("#paypal-method").is(":checked")){$(".payment-method-section").removeClass("current");$("#paypal-section").addClass("current");RCO.exec.donate.donateFormValidator.toggleCCValidations();}if($(".payment-method-toggle").length>0){$(".payment-method-toggle").click(function(){var sectionId=$(this).data("section-id");$(".payment-method-section").removeClass("current");$("#"+sectionId+"-section").addClass("current");RCO.exec.donate.donateFormValidator.toggleCCValidations();});}},registerToggleTributeSection:function(){var tributeCheckbox=$("#quick-donation-tribute"),tributeType=$("#tribute-type"),tributeName=$("#tribute-name");function toggleTributeForm(evt){var checkbox=$(evt.target),form=$("#"+checkbox.attr("id")+"-form");toggleForm(form,checkbox);}function toggleForm(sectionContent,checkbox){if(checkbox.is(":checked")){sectionContent.removeClass("hide");}else{sectionContent.addClass("hide");}}tributeCheckbox.click(toggleTributeForm);toggleForm($("#quick-donation-tribute-form"),tributeCheckbox);},registerShowCreditCardType:function(element){element.bind("keyup",function(e){creditCardTypeHandler(e);});if(window.allCardTypes==undefined){jQuery.getJSON("/ajax/cardInfo.jsp?visa=true&amex=true&master=true&disc=true",function(data,textStatus){window.allCardTypes=data;});}function getCreditCardType(accountNumber){var result="unknown";for(var cardType in window.allCardTypes){var cardTypeAttribs=window.allCardTypes[cardType];var prefixes=cardTypeAttribs.prefix;for(var index in prefixes){var prefix=prefixes[index];var prefixLen=prefix.length;var cardNumberSubstr=accountNumber.trim().substring(0,prefixLen);if(cardNumberSubstr==prefix){result=cardType;break;}}}return result;}function creditCardTypeHandler(e){var $target=$(e.target),value=$target.val(),type=getCreditCardType(value),$cardType=$("#card-type");var cardTypesClassMap={visa:"visa",masterCard:"mc",discover:"discover",americanExpress:"amex"};$cardType.removeClass();if(value===""){$cardType.removeClass();}else{if(cardTypesClassMap[type]!=undefined){$cardType.addClass(cardTypesClassMap[type]);}}}},quickDonateReview:function(){var modalError=$("[data-modalerror]");RCO.ui.progress.init();RCO.exec.donate.gtmDataGathering();RCO.exec.donate.quickDonateDollarHandles();RCO.exec.donate.quickDonateSupportOptions();RCO.exec.donate.registerToggleTributeSection();RCO.exec.donate.addQuickDonateToolTip();if($("#launchScreen").length>0){populateContents();}updateButtonText();$("#monthly-donation").click(updateButtonText);$("#monthly-donation").click(updateButtonText);$(".field-wrap").find("label").click(updateButtonText);$("#other-donation-amount").blur(updateButtonText);function populateContents(){var skuId=$("#reviewSku").val();var skuPos=$("#reviewSkuPos").val();var fieldwrapEl=$($("div.field-wrap.radio-wrap").get(skuPos));if(fieldwrapEl){if(fieldwrapEl.find("#other-donation-amount").length==0){fieldwrapEl.find("label").click();}else{var textEl=fieldwrapEl.find("#other-donation-amount");if(textEl.length>0){var formattedAmnt=parseFloat($("#reviewVarAmnt").val()).toFixed(2);if(!isNaN(formattedAmnt)){fieldwrapEl.find("label").click();textEl.val(formattedAmnt);}}}}if($("#reviewRecurring").val()=="true"){$("#monthly-donation").get(0).click();}if($("#reviewTribute").val()=="true"){$("#quick-donation-tribute").get(0).click();$("#tribute-type").val($("#reviewTributeType").val());$("#tribute-name").val($("#reviewTributeName").val());}if($("#disableRecurring").val()=="1"){if($("#monthly-donation").is(":checked")){$("#monthly-donation").get(0).click();}$("#monthly-donation").attr("disabled","disabled");}}function updateButtonText(){var amount=RCO.exec.donate.donationLightBox.findDonationAmount();var isMonthly=$("#monthly-donation").is(":checked");var currentText=$("#quickDonateBtn").val();var arrow="\u25B8";var buttonText="Donate $"+((amount==""||amount<0)?"0.00":parseFloat(amount).toFixed(2))+((isMonthly)?" Monthly":" ")+arrow;$("#quickDonateBtn").val(buttonText);}},urlParamsUtil:{init:function(parentElement){if(parentElement==null||parentElement==undefined){parentElement=$("body");}if($("#vwoPgVer").length>0&&$("#vwoPgVer").val()!=""||$("#flowParamVal").length>0&&$("#flowParamVal").val()!=""||$("#srcCodeId").length>0&&$("#srcCodeId").val()!=""||$("#subSrcCodeId").length>0&&$("#subSrcCodeId").val()!=""||$("#campaignParamId").length>0&&$("#campaignParamId").val()!=""||$("#micrositeParamId").length>0&&$("#micrositeParamId").val()!=""){var navigationElements=parentElement.find(".attach-url-params");if($("#vwoPgVer").length>0&&$("#vwoPgVer").val()!=""){var vwoPgVerValue=$("#vwoPgVer").val();var vwoParam="pgver";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));if(element.hasClass("ignore-vwo-param")){continue;}if(element.is("a")){var newUrl=this.updateUrl(element.attr("href"),vwoParam,vwoPgVerValue);element.attr("href",newUrl);}else{if(element.is("form")){var newUrl=this.updateUrl(element.attr("action"),vwoParam,vwoPgVerValue);element.attr("action",newUrl);}else{if(element.is("input")){var newUrl=this.updateUrl(element.attr("value"),vwoParam,vwoPgVerValue);element.attr("value",newUrl);}}}}}if($("#flowParamVal").length>0&&$("#flowParamVal").val()!=""){var flowParamVal=$("#flowParamVal").val();var flowParam="flow";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));if(element.hasClass("ignore-flow-param")){continue;}if(element.is("a")){var newUrl=this.updateUrl(element.attr("href"),flowParam,flowParamVal);element.attr("href",newUrl);}else{if(element.is("form")){var newUrl=this.updateUrl(element.attr("action"),flowParam,flowParamVal);element.attr("action",newUrl);}else{if(element.is("input")){var newUrl=this.updateUrl(element.attr("value"),flowParam,flowParamVal);element.attr("value",newUrl);}}}}}if($("#srcCodeId").length>0&&$("#srcCodeId").val()!=""){var srcCodeValue=$("#srcCodeId").val();var srcCodeParam="scode";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));if(element.hasClass("ignore-scode-param")){continue;}if(element.is("a")){var newUrl=this.updateUrl(element.attr("href"),srcCodeParam,srcCodeValue);element.attr("href",newUrl);}else{if(element.is("form")){var newUrl=this.updateUrl(element.attr("action"),srcCodeParam,srcCodeValue);element.attr("action",newUrl);}else{if(element.is("input")){var newUrl=this.updateUrl(element.attr("value"),srcCodeParam,srcCodeValue);element.attr("value",newUrl);}}}}}if($("#subSrcCodeId").length>0&&$("#subSrcCodeId").val()!=""){var subSrcCodeValue=$("#subSrcCodeId").val();var subSrcCodeParam="subcode";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));if(element.hasClass("ignore-subcode-param")){continue;}if(element.is("a")){var newUrl=this.updateUrl(element.attr("href"),subSrcCodeParam,subSrcCodeValue);element.attr("href",newUrl);}else{if(element.is("form")){var newUrl=this.updateUrl(element.attr("action"),subSrcCodeParam,subSrcCodeValue);element.attr("action",newUrl);}else{if(element.is("input")){var newUrl=this.updateUrl(element.attr("value"),subSrcCodeParam,subSrcCodeValue);element.attr("value",newUrl);}}}}}if($("#campaignParamId").length>0&&$("#campaignParamId").val()!=""){var campaignIdValue=$("#campaignParamId").val();var campaignIdParam="campaignId";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));if(element.hasClass("ignore-campaign-param")){continue;}if(element.is("a")){var newUrl=this.updateUrl(element.attr("href"),campaignIdParam,campaignIdValue);element.attr("href",newUrl);}else{if(element.is("form")){var newUrl=this.updateUrl(element.attr("action"),campaignIdParam,campaignIdValue);element.attr("action",newUrl);}else{if(element.is("input")){var newUrl=this.updateUrl(element.attr("value"),campaignIdParam,campaignIdValue);element.attr("value",newUrl);}}}}}if($("#micrositeParamId").length>0&&$("#micrositeParamId").val()!=""){var micrositeIdValue=$("#micrositeParamId").val();var micrositeIdParam="micrositeId";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));if(element.hasClass("ignore-microsite-param")){continue;}if(element.is("a")){var newUrl=this.updateUrl(element.attr("href"),micrositeIdParam,micrositeIdValue);element.attr("href",newUrl);}else{if(element.is("form")){var newUrl=this.updateUrl(element.attr("action"),micrositeIdParam,micrositeIdValue);element.attr("action",newUrl);}else{if(element.is("input")){var newUrl=this.updateUrl(element.attr("value"),micrositeIdParam,micrositeIdValue);element.attr("value",newUrl);}}}}}}navigationElements=parentElement.find("[data-flow-param]");var flowParam="flow";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));var newUrl=this.updateUrl(element.attr("href"),flowParam,$(element).attr("data-flow-param"));element.attr("href",newUrl);}navigationElements=parentElement.find("[data-loggedin-param]");var flowParam="loggedIn";for(var cnt=0;cnt<navigationElements.length;++cnt){var element=$(navigationElements.get(cnt));var newUrl=this.updateUrl(element.attr("href"),flowParam,$(element).attr("data-loggedin-param"));element.attr("href",newUrl);}},updateUrl:function(currentUrl,paramName,paramval){var newUrl=currentUrl;if(currentUrl.indexOf(paramName)!=-1){return currentUrl;}if(currentUrl.lastIndexOf("?")==currentUrl.length-1){newUrl=currentUrl+paramName+"="+paramval;}else{if(currentUrl.lastIndexOf("?")==-1){newUrl=currentUrl+"?"+paramName+"="+paramval;}else{newUrl=currentUrl+"&"+paramName+"="+paramval;}}return newUrl;}},deleteItem:function(commerceItemId){document.getElementById("removeItemId").value=commerceItemId;try{var iscourse=false;var coursesRows=jQuery(".course-table").find(".course-item-row");for(var cnt=0;cnt<coursesRows.length;++cnt){var rowEl=jQuery(coursesRows.get(cnt));if(rowEl.attr("item-id")==commerceItemId){iscourse=true;break;}}if(iscourse&&coursesRows.length==1){var successUrl=jQuery("#cartRemoveItemSuccessUrl").val();if(successUrl.indexOf("flow=course")!=-1){successUrl=successUrl.replace("flow=course","flow=char");jQuery("#cartRemoveItemSuccessUrl").val(successUrl);}}}catch(e){}jQuery("#deleteCartForm").get(0).submit();document.getElementById("removeHref").value="#";},quickdonateToCharitableSwitch:{clickedLink:null,inProgress:false,init:function(){if($(".intlSwitchLink").length>0){$(".intlSwitchLink").bind("click",function(event){event.preventDefault();if(RCO.exec.donate.quickdonateToCharitableSwitch.inProgress){return false;}RCO.exec.donate.quickdonateToCharitableSwitch.inProgress=true;RCO.exec.donate.quickdonateToCharitableSwitch.clickedLink=$(this);if($("#alt-qd-cartmodifierform").length>0){RCO.exec.donate.quickdonateToCharitableSwitch.processAltOneClickAddToCart($("#alt-qd-cartmodifierform"));}else{RCO.exec.donate.quickdonateToCharitableSwitch.navigateToCharitable();}});}},navigateToCharitable:function(){var isAltView=$("#qd-alternate-view").length>0;var fieldsToBeCopied=["card-month","card-year","creditCardQuick-addressOne","creditCardQuick-addressTwo","creditCardQuickCity"];if(isAltView){fieldsToBeCopied.push("first-name");fieldsToBeCopied.push("last-name");fieldsToBeCopied.push("email");fieldsToBeCopied.push("phone");}else{fieldsToBeCopied.push("step3_firstName");fieldsToBeCopied.push("step3_lastName");fieldsToBeCopied.push("step3_email");fieldsToBeCopied.push("step3_phone");}for(var index in fieldsToBeCopied){var fieldId="#"+fieldsToBeCopied[index];var snapshotFieldId=fieldId+"_snapshotProxy";if($(fieldId).length>0&&$(snapshotFieldId).length>0){$(snapshotFieldId).val($(fieldId).val());}}var fieldEls=$(".ajaxSnapshotForm").find("input");$.ajax({type:"POST",url:$(".ajaxSnapshotForm").attr("action"),data:fieldEls,async:false,});window.open(this.clickedLink.attr("href"),"_self");},processAltOneClickAddToCart:function(formEl){var selectedSkuItem=$("input[name='donationAmount'][checked='checked']");if(selectedSkuItem.length==0){selectedSkuItem=$("div.field-wrap.radio-wrap.selected").find("input[type='radio']");}var errorMessages=new Array();if(selectedSkuItem.length>0){var skuId=selectedSkuItem.val();var isCustomDOllarHandle=selectedSkuItem.attr("data-iscustomdollarhandle");var varDonationAmount=$("#other-donation-amount").val();var isRecurring=$("#monthly-donation").is(":checked");var isTribute=$("#quick-donation-tribute").is(":checked");var tribType=$("#tribute-type").val();var tribName=$("#tribute-name").val();formEl.find("#addtocart-is-custom-dollar-handle").val(isCustomDOllarHandle);formEl.find("#addtocart-catalogRefIds").val(skuId);if(isCustomDOllarHandle&&selectedSkuItem.attr("data-amount")!=undefined){formEl.find("#addtocart-variable-amount").val(selectedSkuItem.attr("data-amount"));}else{if(selectedSkuItem.attr("data-amount")==undefined){formEl.find("#addtocart-variable-amount").val(varDonationAmount);}}formEl.find("#addtocart-is-RecurringDonation").val(isRecurring);formEl.find("#addtocart-is-TributeDonation").val(isTribute);formEl.find("#addtocart-gift-type").val(tribType);formEl.find("#addtocart-gift-name").val(tribName);var fieldEls=formEl.find("input");$.ajax({type:"POST",url:formEl.attr("action"),data:fieldEls,async:false,success:function(response){if(response.notifications){var errors=response.notifications.errors;for(var x=0;x<errors.length;++x){var messages=errors[x].messages;for(var y=0;y<messages.length;++y){errorMessages.push(messages[y]);}}}}});}else{errorMessages.push("Donation Amount Missing. Please select or enter a donation amount.");}if(errorMessages.length>0){RCO.exec.donate.quickdonateToCharitableSwitch.inProgress=false;$("#errorMessagesDiv").find("font").empty();for(var msgel in errorMessages){var messageElement=$("<strong/>");messageElement.text(errorMessages[msgel]);$("#errorMessagesDiv").find("font").append(messageElement);$("html,body").animate({scrollTop:$("#errorMessagesDiv").offset().top},10);}}else{RCO.exec.donate.quickdonateToCharitableSwitch.navigateToCharitable();}}},masterPassCheckout:{masterPassButtonClicked:false,init:function(flow){if($("#masterpass-button").length>0){$("#masterpass-button").click(function(event){if(flow=="qd-alt"){var selectedSkuItem=$("div.field-wrap.radio-wrap.selected").find("input[type='radio']");var errorMessages=new Array();var amountSelected=0;if(selectedSkuItem.length>0){var skuId=selectedSkuItem.val();var isCustomDOllarHandle=selectedSkuItem.attr("data-iscustomdollarhandle");var varDonationAmount=$("#other-donation-amount").val();if(isCustomDOllarHandle&&selectedSkuItem.attr("data-amount")!=undefined){amountSelected=selectedSkuItem.attr("data-amount");}else{if(selectedSkuItem.attr("data-amount")==undefined){amountSelected=varDonationAmount;}}}if(amountSelected==0){$("#errorMessagesDiv").find("font").empty();var messageElement=$("<strong/>");messageElement.text("Donation Amount Missing. Please select or enter a donation amount.");$("#errorMessagesDiv").find("font").append(messageElement);$("html,body").animate({scrollTop:$("#errorMessagesDiv").offset().top},10);return;}var selectedDollarHandle=RCO.exec.donate.util.findSelectedDollarHandle();var pos=selectedDollarHandle.pos;$("#masterPassCheckoutParams_skupos").val(pos);$("#masterPassCheckoutParams_varamount").val(amountSelected);$("#masterPassCheckoutParams_recurring").val($("#monthly-donation").is(":checked"));$("#masterPassCheckoutParams_tribute").val($("#quick-donation-tribute").is(":checked"));$("#masterPassCheckoutParams_tribute_type").val($("#tribute-type").val());$("#masterPassCheckoutParams_tribute_name").val($("#tribute-name").val());$("#masterPassCheckoutParams_firstName").val($("#first-name").val());$("#masterPassCheckoutParams_lastName").val($("#last-name").val());$("#masterPassCheckoutParams_phone").val($("#phone").val());$("#masterPassCheckoutParams_email").val($("#email").val());if($("#phone-link").is(":checked")){$("#receivePhoneUpdates-hidden").prop("checked","checked");}}var elements=$("#masterpassCheckoutform").find("input");RCO.exec.donate.util.overlay.on();$.ajax({type:"POST",url:$("#masterpassCheckoutform").attr("action"),data:elements,success:function(data){var error=data.masterTokenResponse.error;if(error){RCO.exec.donate.util.overlay.off();$("#errorMessagesDiv").find("font").empty();var messageElement=$("<strong/>");messageElement.text(error);$("#errorMessagesDiv").find("font").append(messageElement);$("html,body").animate({scrollTop:$("#errorMessagesDiv").offset().top},10);return;}var token=data.masterTokenResponse.token;var callbackUrl=data.masterTokenResponse.callbackUrl;var merchantCheckoutId=data.masterTokenResponse.merchantCheckoutId;var suppressShippingAddressEnable=data.masterTokenResponse.suppressShippingInfo;RCO.exec.donate.util.overlay.off();MasterPass.client.checkout({requestToken:token,merchantCheckoutId:merchantCheckoutId,allowedCardTypes:"master,amex,discover,visa",suppressShippingAddressEnable:suppressShippingAddressEnable,version:"v6",successCallback:function(data){document.getElementById("oauthToken").value=data.oauth_token;document.getElementById("oauthVerifer").value=data.oauth_verifier;document.getElementById("checkoutUrl").value=data.checkout_resource_url;$("#masterPassCartreviewNav").attr("action",callbackUrl);window.gaEvent(masterpassGACategory,"Lightbox_ MasterPass|Success");RCO.exec.donate.util.overlay.on();$("#masterPassCartreviewNav").get(0).submit();},failureCallback:function(error){}});},});});}}},util:{findSelectedDollarHandle:function(){var dollarHandles=$(".field-wrap.radio-wrap");var dollarHandleSelected={pos:-1,dollarhandle:null};for(var x=0;x<dollarHandles.length;++x){var el=dollarHandles.get(x);if($(el).hasClass("selected")){dollarHandleSelected.pos=x;dollarHandleSelected.dollarhandle=el;break;}}return dollarHandleSelected;},overlay:{overlay:null,on:function(){this.overlay=$("<div id='simple_overlay' />");$("body").append(this.overlay);var overlayImgContainer=$("<div id='overlayImg' />");this.overlay.append(overlayImgContainer);var overlayImgLeaf1=$("<div class='blockG' id='rotateG_01' />");overlayImgContainer.append(overlayImgLeaf1);var overlayImgLeaf2=$("<div class='blockG' id='rotateG_02' />");overlayImgContainer.append(overlayImgLeaf2);var overlayImgLeaf3=$("<div class='blockG' id='rotateG_03' />");overlayImgContainer.append(overlayImgLeaf3);var overlayImgLeaf4=$("<div class='blockG' id='rotateG_04' />");overlayImgContainer.append(overlayImgLeaf4);var overlayImgLeaf5=$("<div class='blockG' id='rotateG_05' />");overlayImgContainer.append(overlayImgLeaf5);var overlayImgLeaf6=$("<div class='blockG' id='rotateG_06' />");overlayImgContainer.append(overlayImgLeaf6);var overlayImgLeaf7=$("<div class='blockG' id='rotateG_07' />");overlayImgContainer.append(overlayImgLeaf7);var overlayImgLeaf8=$("<div class='blockG' id='rotateG_08' />");overlayImgContainer.append(overlayImgLeaf8);},off:function(){this.overlay.remove();}}}},quickdonate:{donationConfirmation:function(){$(document).ready(function(){jQuery("#stay-signed-in").bind("click",function(){if(jQuery("#stay-signed-in").prop("checked")){jQuery("#stay-signed-in").prop("value",true);}else{jQuery("#stay-signed-in").prop("value",false);}});});},combinedViewDomUpdate:function(proxyDivEl){if($("#monthly-donation").is(":checked")){$("#monthly-donation-form").removeClass("hide");}else{$("#monthly-donation-form").addClass("hide");}if($("#quick-donation-tribute").is(":checked")){$("#quick-donation-tribute-form").removeClass("hide");}else{$("#quick-donation-tribute-form").addClass("hide");}var otherAmtProxy=proxyDivEl.find("#other-donation-amount_retrieveProxy");var skuIdValue=proxyDivEl.find("#skuDonationRetain_retrieveProxy").val();var formatValue=CurrencyFormatted(skuIdValue);var eleToBeSelectedValue=$('#twenty-five[data-amount="'+formatValue+'"]');var eleToBeSelectedCombined=$('#skuDonationAmount[data-amount="'+formatValue+'"]');if((otherAmtProxy==null||otherAmtProxy.val()==undefined||otherAmtProxy.val()=="")){if((eleToBeSelectedValue.val()!==undefined&&eleToBeSelectedValue!==null&&eleToBeSelectedValue.val()!=="")){eleToBeSelectedValue.prop("checked","true");$("#other-donation-amount").val("");}else{if((eleToBeSelectedCombined.val()!==undefined&&eleToBeSelectedCombined!==null&&eleToBeSelectedCombined.val()!=="")){eleToBeSelectedCombined.prop("checked","true");$("#other-donation-amount").val("");}else{$("#other-donation-amount").val(skuIdValue);}}}else{var otherVal=otherAmtProxy.val();var formatValue=CurrencyFormatted(otherVal);var eleToBeSelectedValue=$('#twenty-five[data-amount="'+formatValue+'"]');var eleToBeSelectedCombined=$('#skuDonationAmount[data-amount="'+formatValue+'"]');if((eleToBeSelectedValue==null||eleToBeSelectedValue.val()==undefined||eleToBeSelectedValue.val()=="")){if((eleToBeSelectedCombined==null||eleToBeSelectedCombined.val()==undefined||eleToBeSelectedCombined.val()=="")){$("#other-donation-amount").val(otherAmtProxy.val());}else{eleToBeSelectedCombined.prop("checked","true");$("#other-donation-amount").val("");}}else{eleToBeSelectedValue.prop("checked","true");$("#other-donation-amount").val("");}}if($("#qd-alternate-view").length>0){if($("#payment-method").val()=="paypal"){$("input#paypal-method").click();}}}},courses:{init:function(){},loadLTPClassRegisterModal:function(){var modalLinks=$(".register-modal").filter(function(i){return !$(this).data("events");});RCO.ui.modal.init(modalLinks,{width:500,onComplete:function(){var clickedLink=$(RCO.ui.modal.clickedElement)[0],$clickedLink=$(clickedLink),$registerBtn=$("#register-class-btn"),partner=$clickedLink.data("partner-name"),url=$clickedLink.data("partner-href");$(".partner-name-text").html(partner);$(this).attr("target","_blank");$registerBtn.attr("href",url);$registerBtn.attr("target","_blank");$(window).one("focus",function(e){$.fn.colorbox.close();});},onClosed:function(){}});},coursesLanding:function(){$(document).bind("CourseListRendered",function(){$("#accessibletabsnavigation0-0").attr("data-ga-category","Take A Class");$("#accessibletabsnavigation0-0").attr("data-ga-action","Find Classes|List Tab");$("#accessibletabsnavigation0-1").attr("data-ga-category","Take A Class");$("#accessibletabsnavigation0-1").attr("data-ga-action","Find Classes|Calendar Tab");$("#accessibletabsnavigation0-2").attr("data-ga-category","Take A Class");$("#accessibletabsnavigation0-2").attr("data-ga-action","Find Classes|Map Tab");RCO.exec.courses.loadLTPClassRegisterModal();});$(".tooltip-summary").live("mouseover mouseout",function(evt){var $target=$(evt.target),$objToolTipPos=$(this).find(".tooltipdrop").position(),leftPos=$objToolTipPos.left+$(this).find(".tooltipdrop").width()+20,topPos=$objToolTipPos.top-60;if($(window).scrollTop()+$(window).height()<$objToolTipPos.top+$(this).find(".tooltip-body").height()+200){topPos=topPos-$(this).find(".tooltip-body").height()+100;$(this).find(".bg-arrow").css("top","auto").css("bottom",60);}else{$(this).find(".bg-arrow").css("top",60);}if(evt.type==="mouseout"){$(this).children(".tooltip-body").hide();}else{$(this).children(".tooltip-body").show().css({left:leftPos,top:topPos});}});RCO.util.loadMapApi.load(RCO.ui.ajax.CourseListWithMap);},courseSignin:function(){var oldUserCheckbox=$("#old-user");var toggleOldSystemFields=function(){oldUserCheckbox.bind("click",function(){$(".old-system").toggle();});};var focusOldSystemFields=function(){$("#old-signin-link").bind("click",function(){$(".create-account-form").find("input:text:first").trigger("focus");if(!oldUserCheckbox.prop("checked")){oldUserCheckbox.trigger("click");}});};var getTimeZoneForUser=function(){var date=new Date();var timezoneval=-date.getTimezoneOffset()/60;$("#timezonetextID").prop("value",timezoneval);};toggleOldSystemFields();focusOldSystemFields();getTimeZoneForUser();},courseDetail:function(){if($(".register-modal").length>0){RCO.exec.courses.loadLTPClassRegisterModal();}},coursesCart:function(){RCO.ui.addDonation();},courseReview:function(){var reviewViewButtonClicked=false;$("#reviewViewButton").click(function(){if(reviewViewButtonClicked){return false;}reviewViewButtonClicked=true;reviewViewBottomButton=true;});var reviewViewBottomButton=false;$("#reviewViewBottomButton").click(function(){if(reviewViewBottomButton){return false;}reviewViewBottomButton=true;reviewViewButtonClicked=true;});},coursePayment:function(){RCO.ui.form.paymentMethods();},courseConfirmation:function(){RCO.ui.printerFriendly(".printer-friendly");}},chapter:{chapterNews:function(){var pointer=new RCO.ui.ajax.listManager({namespace:"communityNews",template:$("#community-news-tmpl"),target:$(".pagination-section"),query:true});RCO.ui.printerFriendly(".printer-friendly");},chapterLanding:function(){$(".upcoming-carousel-slides").anythingSlider({infiniteSlides:false,stopAtEnd:true});},chapterEvents:function(){var eventsTabs=$(".events-tabs"),listPointer,calendar=$("#event-calendar"),toolTipTimer,currentView;var eventAdapter=new EventAdapter();function EventAdapter(){var _date=new Date();var _data={};var _adapter=this;var _categories=[];function getData(){var wcmPageId=$("#wcm-page-Id").val();var req=$.getJSON(RCO.util.root+"/ajax/monthlyEvents.jsp?pageId="+wcmPageId,{year:_date.getFullYear(),month:_date.getMonth()+1});req.done(function(data){_data=data;if(!data.eventList){return;}var i=data.eventList.length,e;var done={},sortKey="eventType",bySortKey=function(a,b){var x=a[sortKey];var y=b[sortKey];return((x<y)?-1:((x>y)?1:0));};_categories=[];for(;i--;){e=data.eventList[i];if(!done[e.eventType]){done[e.eventType]=true;_categories.push({eventType:e.eventType,eventFilterId:e.eventFilterId,eventTypePlural:e.eventTypePlural});}}_categories.sort(bySortKey);});return req.promise();}function filteredEventList(){var eventList=_data.eventList;var output=[];var toFilterOut=$(".sort-by .filter-by .menu input:not(:checked)");var i,ev,filterTypes=[];var nationalEvent="National Event";i=toFilterOut.length;for(;i--;){filterTypes.push($(toFilterOut[i]).data("filterType"));}i=eventList.length;for(;i--;){ev=eventList[i];if(filterTypes.indexOf(ev.eventType)===-1){if(ev.eventScope=="Local"||(ev.eventScope=="National"&&filterTypes.indexOf(nationalEvent)===-1)){output.push(ev);}}}return output;}this.next=function(){_date.addMonths(1);getData().done(_adapter.onDateChange);return _date;};this.prev=function(){var date=eventAdapter.getDate();var now=new Date();now.setMonth(now.getMonth()-3);if(date<now){return _date;}_date.addMonths(-1);getData().done(_adapter.onDateChange);return _date;};this.getDate=function(){return _date;};this.init=function(view){getData().done(_adapter.onDateChange);};this.getCategories=function(){var categories=$.extend([],_categories);return categories;};this.getFullMonthEvents=function(){return _data.fullMonthEvents;};this.getListEventData=function(){var events=filteredEventList(),day=1000*60*60*24,output=[],sortKey="dayOfMonth",dateEvents={},bySortKey=function(a,b){var x=a[sortKey];var y=b[sortKey];return((x<y)?-1:((x>y)?1:0));},i,j,k,eStart,date,e;for(i=0;i<events.length;i++){e=$.extend({},events[i],events[i].datesAndTimes);if(e.start){eStart=new Date(e.start);delete e.datesAndTimes;j=e.times.length;for(;j--;){date=new Date(e.times[j].date);e.times[j].dayOfMonth=date.getDate();e.times[j].dayName=date.getDayName(false);e.times[j].year=date.getFullYear();e.times[j].monthName=date.getMonthName(false);}e.times.sort(bySortKey);dateEvents[eStart.getDate()]=dateEvents[eStart.getDate()]||{dayOfMonth:eStart.getDate(),monthAbbr:eStart.getMonthName(true),monthName:eStart.getMonthName(false),events:[]};dateEvents[eStart.getDate()].events.push(e);}}for(k in dateEvents){output.push(dateEvents[k]);}output.sort(bySortKey);return output;};this.getCalendarEvents=function(start,end,callback){var _events=[],events=filteredEventList(),dateEvents={},dateEventCounts={},dateEventsOverFlow={},i,j,d,k,tooltipHtml,scrollContent,rawEvent,baseEvent,day=1000*60*60*24,eStart,eStop,dates,date,time,e,template,sortKey="dayOfMonth",bySortKey=function(a,b){var x=a[sortKey];var y=b[sortKey];return((x<y)?-1:((x>y)?1:0));};for(i=0;i<events.length;i++){rawEvent=events[i];e=$.extend({allDay:false},rawEvent,rawEvent.datesAndTimes);eStart=new Date(e.start);eStop=new Date(e.end);dates=Math.round((eStop.getTime()-eStart.getTime())/day);delete e.datesAndTimes;e.dateHeader=eStart.asString("mmmm dd, yyyy");if(!e.times){continue;}j=e.times.length;for(;j--;){date=new Date(e.times[j].date);e.times[j].dayOfMonth=date.getDate();e.times[j].dayName=date.getDayName(false);e.times[j].year=date.getFullYear();e.times[j].monthName=date.getMonthName(false);}e.times.sort(bySortKey);var eTitle=e.title;if(eTitle.length>40){var processedTitle=eTitle.substring(0,39)+"...";e.title=processedTitle;}if(dates){e.allDay=true;e["class"]="multi-day";_events.push(e);for(j=0;j<=dates;j++){d=(new Date(eStart.getTime()+(day*j))).asString("yyyy/mm/dd");dateEventCounts[d]=dateEventCounts[d]||0;dateEventCounts[d]++;}}else{d=eStart.asString("yyyy/mm/dd");dateEvents[d]=dateEvents[d]||[];dateEvents[d].push(e);}}for(k in dateEvents){dateEventCounts[k]=dateEventCounts[k]||0;if(dateEventCounts[k]<2&&dateEvents[k].length){for(i=0;i<2-dateEventCounts[k];i++){if(dateEvents[k].length){_events.push(dateEvents[k].shift());}}}if(dateEvents[k].length){tooltipHtml=$('<div class="tooltip-body"></div>');tooltipHtml.append('<div class="tooltip-header">'+dateEvents[k][0].dateHeader+"</div>");tooltipHtml.append('<div class="bg-arrow"></div>');scrollContent=$('<div class="scroll-content simple"></div>');for(i=0;i<dateEvents[k].length;i++){scrollContent.append(renderOverflowContent(dateEvents[k][i]));}tooltipHtml.append(scrollContent);_events.push({title:i+" More »",start:k,tooltip:tooltipHtml});}}i=_events.length;for(;i--;){e=_events[i];if(!e.tooltip){tooltipHtml=$('<div class="tooltip-body"></div>');tooltipHtml.append('<div class="bg-arrow"></div>');template=$("#event-detail-tmpl");tooltipHtml.append(template.tmpl(e));e.tooltip=tooltipHtml;}}callback(_events);};this.onDateChange=$.noop;}function initCarousel(index,carousel){var that=$(carousel),events=that.find(".event"),toggleClass="event-carousel",count=events.length;if(count>3){that.addClass(toggleClass);startCarousel(that);}}function renderEvent(event,element,view){var $titleLink=$("<a/>"),$eventType=$('<div class="event-type" />');element.html("");element.data("event-type",event.eventType);if(event["class"]){element.addClass(event["class"]);}$titleLink.attr("href",event.href||"#");$titleLink.text(event.title).wrap("<h3></h3>");element.append($titleLink);if(event.eventType){$eventType.text(event.eventType);element.append($eventType);}if(event.tooltip){$titleLink.addClass("open-tooltip");element.append(event.tooltip);}}function renderOverflowContent(event){var $titleLink=$("<a/>"),$eventType=$('<div class="event-type" />'),element=$('<div class="overflow-event" />');$titleLink.attr("href",event.href||"#");$titleLink.text(event.title).wrap("<h3></h3>");$eventType.text(event.eventType);element.append($titleLink);element.append($eventType);element.data("event-type",event.eventType);return element;}function afterRender(event,element,view){var $tooltip=element.find(".tooltip-body");var tooltipLink=element.find(".open-tooltip");var leftVal=tooltipLink.width()+25;var heightVal=$tooltip.height()/2;$tooltip.css("left",leftVal).css("top","-"+heightVal+"px");$tooltip.find(".bg-arrow").css("top",(heightVal+5)+"px");}function buildList(){var events=eventAdapter.getListEventData();var listContainer=$("#view-content #view-list .event-list");var template=$("#event-list-tmpl");listContainer.html(template.tmpl(events));}function hideTip(element){var $toolTip=element.find(".tooltip-body");element.css("z-index",80);toolTipTimer=window.setTimeout(function(){$toolTip.fadeOut("fast",function(){element.css("z-index",8);});},100);}function buildCalendar(){$(".summary").live("mouseover mouseout",function(evt){var $target=$(evt.target),leftPos=$target.closest(".summary").find("a").width()+20;if(evt.type==="mouseout"){$(this).children(".tooltip-body").hide();}else{$(this).children(".tooltip-body").show().css({left:leftPos,top:-50});}});calendar.empty();calendar.fullCalendar({events:eventAdapter.getCalendarEvents,eventMouseover:function(){var elem=$(this),scroll;var tip=elem.find(".tooltip-body");var winWidth=$(window).width();var tooltipRightEdge;var tooltipLink=elem.find(".open-tooltip");var leftVal=tooltipLink.width()+25;tip.css("left",leftVal+"px");tip.find(".bg-arrow-right").addClass("bg-arrow").removeClass("bg-arrow-right");if($(".tooltip-body").is(":visible")){hideTip(elem);}if(tip.length){window.clearTimeout(toolTipTimer);tip.fadeIn("fast");elem.css("z-index",100);scroll=tip.find(".scroll-content");if(!scroll.find("scrollbar-pane").length){scroll.scrollbar();}tooltipRightEdge=tip.offset().left+tip.width();if(tooltipRightEdge>winWidth&&tip.find(".bg-arrow").length){tip.css("left",((tip.width()+20)*-1)+"px");tip.find(".bg-arrow").addClass("bg-arrow-right").removeClass("bg-arrow");}}},eventMouseout:function(){var elem=$(this);hideTip(elem);},contentHeight:1115,theme:false,columnFormat:{month:"dddd"},weekMode:"variable",eventRender:renderEvent,eventAfterRender:afterRender});$(document).trigger("shareBar:render");calendar.fullCalendar("gotoDate",eventAdapter.getDate());}function darkenThePast(){var date=eventAdapter.getDate();var now=new Date();var allDays=$(".fc-widget-content:not(.fc-other-month)","#event-calendar");var day;if(date.getMonth()<now.getMonth()||date.getFullYear()<now.getFullYear()){allDays.addClass("disabled");}else{if(date.getMonth()===now.getMonth()&&date.getFullYear()===now.getFullYear()){allDays.each(function(i,el){day=$(this);if(!day.hasClass("fc-today")){day.addClass("disabled");}else{return false;}});}}}function renderView(view){view=view||currentView;if(view!==currentView||!$("#view-select li.current").length){currentView=view;$("#view-content > li").hide();$("#view-content #view-"+view).show();$("#view-select > li.current").removeClass("current");$("#view-select #button-"+view).addClass("current");}var fullMonthEvents=eventAdapter.getFullMonthEvents();var bannerContainer=$("#month-awareness-container");var template=$("#awareness-banner-tmpl");bannerContainer.html(template.tmpl(fullMonthEvents));switch(view){case"calendar":buildCalendar();darkenThePast();break;case"list":buildList();break;}}function idSelectorEscapingSpChars(str){return str.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");}function buildFilterMenu(){var categories=eventAdapter.getCategories();var filterContainer=$(".filter-by .menu");var filterDropDown=$(".filter-by .filter-events");var template=$("#event-filter-tmpl");var checkedState=(function(){var unchecked=filterContainer.find("input:not(:checked)");var output=[];var i=unchecked.length;for(;i--;){output.push($(unchecked[i]).data("filterType"));}return output;})();filterContainer.html(template.tmpl(categories));$.each(checkedState,function(i,v){filterContainer.find("input#filter_"+idSelectorEscapingSpChars(v.split(" ").join("_"))).attr("checked",false);});filterContainer.find("li").click(function(e){e.stopPropagation();if(e.target===$(this).find("input")[0]){var filterCount=filterContainer.find("input:not(:checked)").length;filterCount=(filterCount)?" ("+filterCount+")":"";filterDropDown.text("Filter Events"+filterCount);renderView();}});}(function init(){var viewSelect=$("#view-select"),hash=document.location.hash.replace("#",""),filter=$(".filter-by .filter-events"),filterMenu=filter.siblings(".menu");currentView=viewSelect.data("default-view");if(viewSelect.find("#button-"+hash).length){currentView=hash;}viewSelect.find("li").click(function(){var clicked=$(this);var viewName=clicked.attr("id").replace("button-","");renderView(viewName);});$(".event-box").each(initCarousel);$(document).click(function(e){if(filter.hasClass("toggle")){filter.removeClass("toggle");filterMenu.addClass("hide");}});filter.click(function(e){e.preventDefault();e.stopPropagation();if(filter.hasClass("toggle")){filter.removeClass("toggle");filterMenu.addClass("hide");}else{filter.addClass("toggle");filterMenu.removeClass("hide");}});var calControls=$("#fc-external-controls");eventAdapter.onDateChange=function updateViewDisplay(view){var date=eventAdapter.getDate();var year=date.asString("yyyy");var dateFormat="mmmm yyyy";view=(typeof(view)==="string")?view:undefined;calControls.find(".fc-header-title h2").html(date.asString(dateFormat));buildFilterMenu();renderView(view);};eventAdapter.init();calControls.find(".fc-button-next").bind("click",function(){eventAdapter.next();});calControls.find(".fc-button-prev").bind("click",function(){eventAdapter.prev();});})();},pressReleases:function(){var pointer=new RCO.ui.ajax.listManager({namespace:"pressReleases",template:$("#press-releases-tmpl"),target:$(".more-press-section")});RCO.ui.printerFriendly(".printer-friendly");}},eventsCheckout:{selectTickets:function(){var expandableWrap=$(".event-description");RCO.ui.expandable(expandableWrap,{initial:"hide"});},register:function(){var expandableWrap=$(".event-description");RCO.ui.expandable(expandableWrap,{initial:"hide"});var guestInfoTable=$(".guest-table");var deferLink=$(".deferLink");deferLink.bind("click",function(){guestInfoTable.toggleClass("defer");return false;});RCO.ui.addDonation();},payment:function(){var expandableWrap=$(".event-description");RCO.ui.expandable(expandableWrap,{initial:"hide"});RCO.ui.form.paymentMethods();},eventConfirm:function(){}},search:{searchLanding:function(){var pointer=new RCO.ui.ajax.listManager({namespace:"searchResults",template:$("#search-wrapper-tmpl"),target:$(".pagination-section"),query:true});RCO.ui.printerFriendly(".printer-friendly");}},newsEvents:{newsList:function(){var pointer=new RCO.ui.ajax.listManager({namespace:"newsListing",template:$("#news-listing-tmpl"),query:true});RCO.ui.printerFriendly(".printer-friendly");},eventList:function(){var pointer=new RCO.ui.ajax.listManager({namespace:"eventListing",template:$("#event-listing-tmpl"),target:$(".pagination-section")});RCO.ui.printerFriendly(".printer-friendly");},pressReleases:function(){var pointer=new RCO.ui.ajax.listManager({namespace:"pressReleases",template:$("#press-releases-tmpl"),target:$(".more-press-section")});RCO.ui.printerFriendly(".printer-friendly");}},stories:{storiesLanding:function(){var pointer=new RCO.ui.ajax.listManager({namespace:"storiesLanding",template:$("#storyList-tmpl"),target:$(".pagination-section")});RCO.ui.printerFriendly(".printer-friendly");}},wcm:{init:function(){function clearPullQuote(){var $element=$(this),clearfixClass="clearfix",$parent,offset,targetHeight;if($element.hasClass("align-right")||$element.hasClass("align-left")){$parent=$element.parent();targetHeight=$element.outerHeight()+($element.offset().top-$parent.offset().top);if($parent.height()<targetHeight){$parent.height(targetHeight);}}}$(".pull-quote").each(clearPullQuote);},clipboardClient:function(){var clipboard=$('[data-action="clipboardClient"]'),cssTransitions=Modernizr.csstransitions,activeClass="animating";function initClient(){var wrapper=$(this),client=new ZeroClipboard.Client(),textElement=wrapper.find(".clipboard-text"),copyText=textElement.val(),feedback=wrapper.find(".feedback");function onComplete(){wrapper.addClass(activeClass);if(!cssTransitions){feedback.stop(true,true).show().fadeOut(3000);}}function onMouseDown(){wrapper.removeClass(activeClass);}(function init(){client.setText(copyText);client.setHandCursor(true);client.glue(textElement.get(0),wrapper.get(0));client.addEventListener("onComplete",onComplete);client.addEventListener("onMouseDown",onMouseDown);})();}clipboard.each(initClient);},formModule:function(){var form=$("[data-action=formModule]");form.each(function(){RCO.ui.validate.init($(this));});},sliderResize:function(){var imageWrapper=$(".image-wrapper"),imageWrapperHeight=imageWrapper.innerHeight(),imageWrapperWidth=imageWrapper.innerWidth(),image=imageWrapper.find("img"),tries=0;function positionImg(imgHeight,imgWidth){if(imgHeight<imageWrapperHeight||imgWidth<imageWrapperWidth){image.css({top:((imageWrapperHeight/2)-(imgHeight/2)),left:((imageWrapperWidth/2)-(imgWidth/2)),position:"absolute"});}}function checkHeightWidth(){var imgHeight=image.innerHeight();var imgWidth=image.innerWidth();if(tries>=30){return;}if(imgHeight===0){window.setTimeout(checkHeight,100);tries++;return;}positionImg(imgHeight,imgWidth);}},slider:function(){function sidebarSliderHeight(){var sliders=$(".sidebar-slider-wrap");sliders.each(function(){var thisSlider=$(this),panelWrap=thisSlider.find(".slides"),panels=panelWrap.children(".panel"),topHeight=0;if(panels.length<2){panelWrap.removeClass("true-slider");return true;}panels.each(function(){var height=$(this).innerHeight();if(height>topHeight){topHeight=height;}});panelWrap.height(topHeight);});}function imageWrapperHeight(){var sliders=$(".sidebar-slider-wrap"),imageWrapper=sliders.find(".image-wrapper"),image=imageWrapper.find(".image");}imageWrapperHeight();sidebarSliderHeight();RCO.ui.slider({autoPlay:true});},expandable:function(){RCO.ui.expandable(null,{initial:"hide"});},sliderTopic:function(){RCO.ui.slider({autoPlay:false});},newsTicker:function(){var tickerDuration=8000,tickerItems=$(".ticker-item",".ticker");function tickerCycle(){var activeItem=tickerItems.filter(".ticker-active").first(),nextItem=activeItem.next(),showNextItem=function(){nextItem.addClass("ticker-active");activeItem.appendTo(tickerItems.parent());},hideItems=function(){tickerItems.removeClass("ticker-active");nextItem.fadeIn(800,showNextItem);};activeItem.fadeOut(800,hideItems);}if(tickerItems.length>0){RCO.tickerInterval=window.setInterval(tickerCycle,tickerDuration);}},homeAspot:function(){var aspot=$(".slides"),aspotDuration=8000,winWidth=$(window).width(),imgWidth=1600,animTime=1200,leftPos=(winWidth-imgWidth)/2,leftOffset=150,popoutPos,sliding=false;function preloadPanelImages(keyAttr,scope){$("img["+keyAttr+"]",scope).each(function(i,img){var $img=$(img);$img.attr("src",$img.attr(keyAttr)).removeAttr(keyAttr);});}aspot.anythingSlider({expand:true,resizeContents:false,buildNavigation:false,buildStartStop:false,autoPlay:true,delay:aspotDuration,animationTime:animTime,easing:"easeOutQuart",onInitialized:function(evt,slider){var win=$(slider.$win),panels=aspot.find(".panel"),shadows=slider.$items.find(".panel-shadow-h"),photos=slider.$items.find(".photo"),popouts=slider.$items.not(".cloned").find(".popout"),popoutsCloned=slider.$items.filter(".cloned").find(".popout"),aspotWrap=$("#home-aspot"),arrows=aspotWrap.find(".arrow"),resizeTimer;function adjustSlider(){winWidth=win.width();leftPos=((winWidth-imgWidth)/2);popoutPos=leftPos+leftOffset;photos.add(popoutsCloned).css({left:leftPos});popouts.css({left:popoutPos-leftOffset});}shadows.first().fadeOut("fast");preloadPanelImages("data-original",panels);adjustSlider();win.resize(function(){window.clearTimeout(resizeTimer);resizeTimer=window.setTimeout(adjustSlider,100);});slider.$items.not(slider.$currentPage).css({overflow:"hidden"}).not(".cloned");slider.$currentPage.css({overflow:"visible"}).find(".photo").css({zIndex:2}).end().find(".darken").css({bottom:"0"}).end().find(".popout").css({left:leftPos});slider.$el.css({overflow:"visible"});aspotWrap.hover(function(evt){arrows.addClass("hov");},function(){arrows.removeClass("hov");});},onSlideBegin:function(evt,slider){if(!sliding){sliding=true;var leftPos=(($(window).width()-imgWidth)/2),popoutPos=leftPos+leftOffset,popoutTime=animTime+300,darken=slider.$currentPage.find(".darken"),inPage=slider.$targetPage,outPage=slider.$currentPage,pagesCount=slider.pages,curPage=slider.currentPage,targetPage=slider.targetPage,allPages=slider.$items,leftPosNew=leftPos+(leftOffset*2),toLeftPos=leftPos-(leftOffset/5),inOverflow="visible",inPagePopout;if((slider.$currentPage!==slider.$lastPage)&&(slider.$currentPage!==slider.$firstPage)){if(inPage.hasClass("article-panel")){inOverflow="hidden";}if(curPage==1){allPages.eq(pagesCount+1).css("overflow","hidden");if(targetPage==pagesCount){inPage=inPage.add(allPages.eq(0));}}if(curPage==pagesCount){allPages.eq(0).css("overflow","hidden");if(targetPage==1){inPage=inPage.add(allPages.eq(pagesCount+1));}}inPage.css({"z-index":"0",overflow:inOverflow});inPagePopout=inPage.find(".popout");inPagePopout.css("left",leftPosNew).animate({left:toLeftPos},popoutTime,function(){inPagePopout.not($(this)).stop().css("left",toLeftPos);});outPage.css({"z-index":"1",overflow:"hidden"});if(Modernizr.csstransitions){darken.css({bottom:-67});}else{darken.animate({bottom:-67},250);}}}},onSlideComplete:function(slider){sliding=false;var darken=slider.$currentPage.find(".darken");if(Modernizr.csstransitions){darken.css({bottom:"0"});}else{darken.animate({bottom:"0"},250);}}});},helpFilter:function(){var filterForm=$("form.filters"),filterUrl=filterForm.attr("action"),filterControls=filterForm.find("input:checkbox"),resultsContainer=$("#filteredResults"),template=$("#waysToHelpResultsTemplate");function renderTemplate(data,textStatus,jqXHR){try{var resultsTemplate=template.tmpl(data);resultsContainer.empty().html(resultsTemplate);}catch(e){}}function getFilterParams(){var paramStr="",params=[],i=0;filterControls.filter(":checked").each(function(i,elem){params[i]=encodeURIComponent(elem.name);i+=1;});if(params.length>0){paramStr=params.join("_");}return paramStr;}function getFilteredResults(){var params={filter:getFilterParams()};$.ajax({url:filterUrl,data:params,success:renderTemplate});}filterControls.change(getFilteredResults);},navigationSlider:function(){var slider=$(".navigation-slider"),sliderInner=slider.children(".slider-inner"),panelWrap=sliderInner.find(".slides-list"),panel=panelWrap.children(".panel"),panelLength=panel.length,sliderNav=sliderInner.find(".slider-nav"),navWrapWidth=sliderNav.width(),navList=sliderNav.find("ul"),navItem,navItemLength,navMarkUp='<li><a href="#" class="nav-item"><span></span></a></li>',currentClass="current",currentPanel=panel.eq(0),currentNav,panelSpeed=500,nextArrow=slider.find(".next-arrow"),prevArrow=slider.find(".prev-arrow"),navArray,navLength,navSpeed=200,timer,timeGap=6000,autoRotate=false,inTransform=false;function changeSlide(newNav,realign){if(!inTransform){inTransform=true;var mapping=newNav.children("a").attr("href");currentPanel.fadeOut(panelSpeed,function(){currentNav.removeClass(currentClass);currentNav=newNav;currentNav.addClass(currentClass);currentPanel.removeClass(currentClass);currentPanel=panel.filter(mapping).addClass(currentClass);currentPanel.delay(200).fadeIn(panelSpeed,function(){inTransform=false;if(!!realign){window.clearInterval(timer);moveNav($(navArray).index(newNav),1000);}});});}}function moveNav(toIndex,_moveSpeed){var fromNav,toNav,_moveNav,moveNavClone,newLeft,moveSpeed;if(!inTransform){fromNav=$(navArray[0]);moveSpeed=_moveSpeed||navSpeed;inTransform=true;if(toIndex>0){_moveNav=$(navArray).slice(0,toIndex);moveNavClone=_moveNav.clone().appendTo(navList);toNav=$(navArray).eq(toIndex);newLeft=toNav.position().left;navList.animate({left:-newLeft},moveSpeed,function(){var items=navArray.splice(0,toIndex);navArray=navArray.concat(items);_moveNav.detach().appendTo(navList);moveNavClone.remove();navList.css("left",0);inTransform=false;if(!!autoRotate){timer=window.setInterval(rotate,timeGap);}});}else{if(toIndex<0){_moveNav=$(navArray).slice(navLength+toIndex);moveNavClone=_moveNav.clone().prependTo(navList);navList.css("left",-fromNav.position().left);navList.animate({left:0},moveSpeed,function(){var items=navArray.splice(navLength+toIndex,-(toIndex));navArray=items.concat(navArray);_moveNav.detach().prependTo(navList);moveNavClone.remove();inTransform=false;});}}}}function alignNav(nextNav){var edge=nextNav.position().left+nextNav.width();if(edge>navWrapWidth){return true;}else{return false;}}function rotate(){var nextNav=currentNav.next(),alignNeeded;if(nextNav.length<1){nextNav=$(navArray).eq(0);}alignNeeded=alignNav(nextNav);changeSlide(nextNav,alignNeeded);}function startTimer(){timer=window.setInterval(rotate,timeGap);autoRotate=true;}function stopTimer(){window.clearInterval(timer);autoRotate=false;}function navScrolling(){var navTotalWidth=0;navItem.each(function(){navTotalWidth+=$(this).width();});if(navTotalWidth>navWrapWidth){nextArrow.add(prevArrow).show();nextArrow.bind("click",function(){stopTimer();moveNav(1);return false;});prevArrow.bind("click",function(){stopTimer();moveNav(-1);return false;});}}function createNav(){panel.each(function(i,value){var navPlaceHolder=$(this).find(".nav-text"),navText=navPlaceHolder.text(),thisNav=$(navMarkUp);$(this).attr("id","panel-"+i);thisNav.find("span").text(navText);thisNav.children("a").attr("href","#panel-"+i);navList.append(thisNav);navPlaceHolder.remove();});navItem=navList.children("li");navArray=navItem.toArray();navLength=navArray.length;currentNav=navItem.eq(0);}(function init(){createNav();navItem.bind("click",function(){stopTimer();changeSlide($(this));return false;});navScrolling();currentPanel.fadeIn(panelSpeed).add(currentNav).addClass(currentClass);startTimer();slider.hover(function(){stopTimer();},function(){startTimer();});}());},limitChars:function(){$("[data-limit-chars]").keyup(function(evt){var max=parseInt(this.getAttribute("data-limit-chars"),10);if($(this).val().length>max){$(this).val($(this).val().substr(0,max));}$("span",".characters-left").text(max-$(this).val().length);});},polaroid:function(){var canvas=$(".polaroid-canvas"),canvasHeight=canvas.innerHeight(),image=canvas.find("img"),tries=0;function positionImg(imgHeight){if(imgHeight<canvasHeight){image.css({top:((canvasHeight/2)-(imgHeight/2))});}}function checkHeight(){var imgHeight=image.innerHeight();if(tries>=30){return;}if(imgHeight===0){window.setTimeout(checkHeight,100);tries++;return;}positionImg(imgHeight);}checkHeight();},videoEmbed:function(){$(".video-frame").each(function(i){var videoContainerId=$(this).attr("id"),videoContainer=$("#"+videoContainerId),videoID,videoWidth,videoHeight,params={allowScriptAccess:"always",allowFullScreen:"true"},atts={id:"ytPlayer"+i};videoID=videoContainer.css("background","#ccc").find("input[name=videoID]").attr("value");videoWidth=videoContainer.find("input[name=videoWidth]").attr("value");videoHeight=videoContainer.find("input[name=videoHeight]").attr("value");swfobject.embedSWF("http://www.youtube.com/v/"+videoID+"?version=3&enablejsapi=1&playerapiid=player1",videoContainerId,videoWidth,videoHeight,"9",null,null,params,atts);});},partnerToggle:function(){var wrap=$(".partners-module"),toggles=wrap.find(".partner-toggle"),details=wrap.find(".partner-detail"),hideClass="hide",activeClass="active",toggleDetail=function(){var element=$(this),key=element.attr("title"),target=details.filter("#"+key);toggles.removeClass(activeClass);element.addClass(activeClass);details.addClass(hideClass);target.removeClass(hideClass);target.find("h1").focus();return false;};toggles.click(toggleDetail);}},countryStateDropDown:{init:function(parent){if(parent==null||parent==undefined){parent=$("body");}var countryDropdowns=parent.find("select[country-dd]");if(countryDropdowns.length>0){countryDropdowns.each(function(index,val){var countryDropdown=$(this);var stateId=countryDropdown.attr("state-dd-id");var stateDD=countryDropdown.closest("form").find("#"+stateId);var stateText=countryDropdown.closest("form").find("#"+stateId+"_text");var stateList=JSON.parse($("#stateCountryMap").val());countryDropdown.change(function(event){var country=$(this).val();var module=RCO.exec.countryStateDropDown;if(module.decideIfStateFieldIsDropDown(country)){module.toggleTextAndDropDown(stateDD,stateText,true,true);var statesOfCountry=stateList[country];module.populateCountrySpecificStates(stateDD,statesOfCountry);module.toggleStateValidations(true,stateDD,stateText);}else{module.toggleTextAndDropDown(stateDD,stateText,false,true);module.toggleStateValidations(false,stateDD,stateText);}module.togglePostalAndPhone(countryDropdown);});var showDropdown=RCO.exec.countryStateDropDown.decideIfStateFieldIsDropDown(countryDropdown.val());RCO.exec.countryStateDropDown.toggleTextAndDropDown(stateDD,stateText,showDropdown,false);if(showDropdown){var statesOfCountry=stateList[countryDropdown.val()];RCO.exec.countryStateDropDown.populateCountrySpecificStates(stateDD,statesOfCountry,true);}RCO.exec.countryStateDropDown.toggleStateValidations(showDropdown,stateDD,stateText);RCO.exec.countryStateDropDown.togglePostalAndPhone(countryDropdown);});}},decideIfStateFieldIsDropDown:function(country){if(country=="US"||country=="CA"){return true;}return false;},toggleTextAndDropDown:function(stateDD,stateText,showDD,clearText){var stateDDWrap=stateDD.closest("div.state-wrap");var stateTextWrap=stateText.closest("div.state-wrap");if(showDD){stateText.attr("disabled","disabled");stateDD.removeAttr("disabled");if(stateDDWrap.hasClass("hide")){stateDDWrap.removeClass("hide");}if(!stateTextWrap.hasClass("hide")){stateTextWrap.addClass("hide");}}else{stateDD.attr("disabled","disabled");stateText.removeAttr("disabled");if(!stateDDWrap.hasClass("hide")){stateDDWrap.addClass("hide");}if(stateTextWrap.hasClass("hide")){stateTextWrap.removeClass("hide");}}if(clearText){stateText.val("");stateDD.val("");}},toggleStateValidations:function(isValidationRequired,stateDD,stateText){var labelElement=stateDD.closest("div.field-wrap").find("label[for='state']");var labelText=labelElement.html();if(isValidationRequired){if(labelText.indexOf("*")<0){labelText=labelText+" *";labelElement.html(labelText);}if(stateDD.hasClass("ignore-validations")){stateDD.removeClass("ignore-validations");}}else{labelText=labelText.replace("*","");labelElement.html(labelText);if(!stateDD.hasClass("ignore-validations")){stateDD.addClass("ignore-validations");}}},togglePostalAndPhone:function(countryDD){if(countryDD.length>0){var countryVal=countryDD.val();var postalCodeEl=countryDD.closest("form").find("#postal-code");var phoneLabelEl=countryDD.closest("form").find("#phoneSpanLbl");var postalLabelEl=countryDD.closest("form").find("#postalSpanLbl");if(countryVal=="US"){postalCodeEl.attr("maxlength","5");phoneLabelEl.text("Phone Number: *");postalLabelEl.text("Postal Code: *");$("small.phoneDiff").removeClass("hide");}else{if(countryVal=="CA"){phoneLabelEl.text("Phone Number: ");postalLabelEl.text("Postal Code: *");postalCodeEl.attr("maxlength","7");$("small.phoneDiff").addClass("hide");}else{phoneLabelEl.text("Phone Number: ");postalLabelEl.text("Postal Code: ");postalCodeEl.attr("maxlength","10");$("small.phoneDiff").addClass("hide");}}}},populateCountrySpecificStates:function(statedd,options,setPreselectedValue){statedd.empty();var optionEl=$("<option/>");optionEl.attr("value","");optionEl.text("State");statedd.append(optionEl);for(var cnt=0;cnt<options.length;++cnt){var option=options[cnt];optionEl=$("<option/>");optionEl.attr("value",option.code);optionEl.text(option.displayName);statedd.append(optionEl);}if(setPreselectedValue){var currentState=statedd.closest("form").find("#currentCardsState").val();if(currentState){statedd.val(currentState);}}}}};RCO.init=(function(){function fire(controller,act,args){var module=RCO.exec,action=(act===undef)?["init"]:act,i=0;if(controller!==""&&module[controller]){i=action.length;while(i--){if(typeof module[controller][action[i]]==="function"){module[controller][action[i]](args);}}}}function bootstrap(){var exec=$("[data-controller]"),i=exec.length,magazine={},controller,controllers,cLen;fire("common");while(i--){controller=exec[i].getAttribute("data-controller");magazine[controller]=magazine[controller]||{};magazine[controller][exec[i].getAttribute("data-action")]=1;}for(controllers=Object.keys(magazine),i=0,cLen=controllers.length;i<cLen;i++){fire(controllers[i]);fire(controllers[i],Object.keys(magazine[controllers[i]]));}$(document).trigger("cleanup");return true;}$(document).ready(bootstrap);return true;})();return(window.RCO=RCO);})(this,this.document,this.jQuery);